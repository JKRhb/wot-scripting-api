<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="ReSpec 24.33.3"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><style>/* --- EXAMPLES --- */
span.example-title {
    text-transform: none;
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example span.example-title {
    color: #999;
}
</style><style>/* --- ISSUES/NOTES --- */
.issue-label {
    text-transform: initial;
}

.warning > p:first-child { margin-top: 0 }
.warning {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
span.warning { padding: .1em .5em .15em; }

.issue.closed span.issue-number {
    text-decoration: line-through;
}

.warning {
    border-color: #f11;
    border-width: .2em;
    border-style: solid;
    background: #fbe9e9;
}

.warning-title:before{
    content: "⚠"; /*U+26A0 WARNING SIGN*/
    font-size: 3em;
    float: left;
    height: 100%;
    padding-right: .3em;
    vertical-align: top;
    margin-top: -0.5em;
}

li.task-list-item {
    list-style: none;
}

input.task-list-item-checkbox {
    margin: 0 0.35em 0.25em -1.6em;
    vertical-align: middle;
}

.issue a.respec-gh-label {
  padding: 5px;
  margin: 0 2px 0 2px;
  font-size: 10px;
  text-transform: none;
  text-decoration: none;
  font-weight: bold;
  border-radius: 4px;
  position: relative;
  bottom: 2px;
  border: none;
}

.issue a.respec-label-dark {
  color: #fff;
  background-color: #000;
}

.issue a.respec-label-light {
  color: #000;
  background-color: #fff;
}
</style><style>/* --- WEB IDL --- */

pre.idl {
  padding: 1em;
  position: relative;
}

@media print {
  pre.idl {
    white-space: pre-wrap;
  }
}

pre.idl::before {
  content: "WebIDL";
  display: block;
  width: 150px;
  background: #90b8de;
  color: #fff;
  font-family: sans-serif;
  font-weight: bold;
  margin: -1em 0 1em -1em;
  height: 28px;
  line-height: 28px;  
}

.idlID {
  font-weight: bold;
  color: #005a9c;
}

.idlType {
  color: #005a9c;
}

.idlName {
  color: #ff4500;
}

.idlName a {
  color: #ff4500;
  border-bottom: 1px dotted #ff4500;
  text-decoration: none;
}

a.idlEnumItem {
  color: #000;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
}

.idlSuperclass {
  font-style: italic;
  color: #005a9c;
}


/*.idlParam*/

.idlParamName,
.idlDefaultValue {
  font-style: italic;
}

.extAttr {
  color: #666;
}


/*.idlSectionComment*/

.idlSectionComment {
  color: gray;
}

.idlIncludes a {
  font-weight: bold;
}

.respec-button-copy-paste:focus {
  text-decoration: none;
  border-color: #51a7e8;
  outline: none;
  box-shadow: 0 0 5px rgba(81, 167, 232, 0.5);
}

.respec-button-copy-paste:focus:hover,
.respec-button-copy-paste.selected:focus {
  border-color: #51a7e8;
}

.respec-button-copy-paste:hover,
.respec-button-copy-paste:active,
.respec-button-copy-paste.zeroclipboard-is-hover,
.respec-button-copy-paste.zeroclipboard-is-active {
  text-decoration: none;
  background-color: #ddd;
  background-image: linear-gradient(#eee, #ddd);
  border-color: #ccc;
}

.respec-button-copy-paste:active,
.respec-button-copy-paste.selected,
.respec-button-copy-paste.zeroclipboard-is-active {
  background-color: #dcdcdc;
  background-image: none;
  border-color: #b5b5b5;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15)
}

.respec-button-copy-paste.selected:hover {
  background-color: #cfcfcf;
}

.respec-button-copy-paste:disabled,
.respec-button-copy-paste:disabled:hover,
.respec-button-copy-paste.disabled,
.respec-button-copy-paste.disabled:hover {
  color: rgba(102, 102, 102, 0.5);
  cursor: default;
  background-color: rgba(229, 229, 229, 0.5);
  background-image: none;
  border-color: rgba(197, 197, 197, 0.5);
  box-shadow: none;
}

@media print {
  .respec-button-copy-paste {
    visibility: hidden;
  }
}
</style>
    
    <title>Web of Things (WoT) Scripting API</title>
    <style id="respec-mainstyle">/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

@keyframes pop {
  0% {
    transform: scale(1, 1);
  }
  25% {
    transform: scale(1.25, 1.25);
    opacity: 0.75;
  }
  100% {
    transform: scale(1, 1);
  }
}

/* Override code highlighter background */
.hljs {
  background: transparent !important;
}

/* --- INLINES --- */
h1 abbr,
h2 abbr,
h3 abbr,
h4 abbr,
h5 abbr,
h6 abbr,
a abbr {
  border: none;
}

dfn {
  font-weight: bold;
}

a.internalDFN {
  color: inherit;
  border-bottom: 1px solid #99c;
  text-decoration: none;
}

a.externalDFN {
  color: inherit;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
}

a.bibref {
  text-decoration: none;
}

.respec-offending-element:target {
  animation: pop 0.25s ease-in-out 0s 1;
}

.respec-offending-element,
a[href].respec-offending-element {
  text-decoration: red wavy underline;
}
@supports not (text-decoration: red wavy underline) {
  .respec-offending-element:not(pre) {
    display: inline-block;
  }
  .respec-offending-element {
    /* Red squiggly line */
    background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=)
      bottom repeat-x;
  }
}

#references :target {
  background: #eaf3ff;
  animation: pop 0.4s ease-in-out 0s 1;
}

cite .bibref {
  font-style: normal;
}

code {
  color: #c83500;
}

th code {
  color: inherit;
}

a[href].orcid {
    padding-left: 4px;
    padding-right: 4px;
}

a[href].orcid > svg {
    margin-bottom: -2px;
}

/* --- TOC --- */

.toc a,
.tof a {
  text-decoration: none;
}

a .secno,
a .figno {
  color: #000;
}

ul.tof,
ol.tof {
  list-style: none outside none;
}

.caption {
  margin-top: 0.5em;
  font-style: italic;
}

/* --- TABLE --- */

table.simple {
  border-spacing: 0;
  border-collapse: collapse;
  border-bottom: 3px solid #005a9c;
}

.simple th {
  background: #005a9c;
  color: #fff;
  padding: 3px 5px;
  text-align: left;
}

.simple th[scope="row"] {
  background: inherit;
  color: inherit;
  border-top: 1px solid #ddd;
}

.simple td {
  padding: 3px 10px;
  border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
  background: #f0f6ff;
}

/* --- DL --- */

.section dd > p:first-child {
  margin-top: 0;
}

.section dd > p:last-child {
  margin-bottom: 0;
}

.section dd {
  margin-bottom: 1em;
}

.section dl.attrs dd,
.section dl.eldef dd {
  margin-bottom: 0;
}

#issue-summary > ul,
.respec-dfn-list {
  column-count: 2;
}

#issue-summary li,
.respec-dfn-list li {
  list-style: none;
}

details.respec-tests-details {
  margin-left: 1em;
  display: inline-block;
  vertical-align: top;
}

details.respec-tests-details > * {
  padding-right: 2em;
}

details.respec-tests-details[open] {
  z-index: 999999;
  position: absolute;
  border: thin solid #cad3e2;
  border-radius: 0.3em;
  background-color: white;
  padding-bottom: 0.5em;
}

details.respec-tests-details[open] > summary {
  border-bottom: thin solid #cad3e2;
  padding-left: 1em;
  margin-bottom: 1em;
  line-height: 2em;
}

details.respec-tests-details > ul {
  width: 100%;
  margin-top: -0.3em;
}

details.respec-tests-details > li {
  padding-left: 1em;
}

a[href].self-link:hover {
  opacity: 1;
  text-decoration: none;
  background-color: transparent;
}

h2,
h3,
h4,
h5,
h6 {
  position: relative;
}

aside.example .marker > a.self-link {
  color: inherit;
}

h2 > a.self-link,
h3 > a.self-link,
h4 > a.self-link,
h5 > a.self-link,
h6 > a.self-link {
  border: none;
  color: inherit;
  font-size: 83%;
  height: 2em;
  left: -1.6em;
  opacity: 0.5;
  position: absolute;
  text-align: center;
  text-decoration: none;
  top: 0;
  transition: opacity 0.2s;
  width: 2em;
}

h2 > a.self-link::before,
h3 > a.self-link::before,
h4 > a.self-link::before,
h5 > a.self-link::before,
h6 > a.self-link::before {
  content: "§";
  display: block;
}

@media (max-width: 767px) {
  dd {
    margin-left: 0;
  }

  /* Don't position self-link in headings off-screen */
  h2 > a.self-link,
  h3 > a.self-link,
  h4 > a.self-link,
  h5 > a.self-link,
  h6 > a.self-link {
    left: auto;
    top: auto;
  }
}

@media print {
  .removeOnSave {
    display: none;
  }
}
</style>
    
  <style type="text/css">
.diff-old-a {
  font-size: smaller;
  color: red;
}

.diff-new { background-color: yellow; }
.diff-chg { background-color: lime; }
.diff-new:before,
.diff-new:after
    { content: "\2191" }
.diff-chg:before, .diff-chg:after
    { content: "\2195" }
.diff-old { text-decoration: line-through; background-color: #FBB; }
.diff-old:before,
.diff-old:after
    { content: "\2193" }
</style>
<script src="https://w3c.github.io/htmldiff-nav/index.js"></script><link rel="canonical" href="https://www.w3.org/TR/wot-scripting-api/"><style>/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
}

.hljs-comment,
.hljs-quote {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-subst {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-literal,
.hljs-variable,
.hljs-template-variable,
.hljs-tag .hljs-attr {
  color: #008080;
}

.hljs-string,
.hljs-doctag {
  color: #d14;
}

.hljs-title,
.hljs-section,
.hljs-selector-id {
  color: #900;
  font-weight: bold;
}

.hljs-subst {
  font-weight: normal;
}

.hljs-type,
.hljs-class .hljs-title {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-name,
.hljs-attribute {
  color: #000080;
  font-weight: normal;
}

.hljs-regexp,
.hljs-link {
  color: #009926;
}

.hljs-symbol,
.hljs-bullet {
  color: #990073;
}

.hljs-built_in,
.hljs-builtin-name {
  color: #0086b3;
}

.hljs-meta {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
</style><style>var {
  position: relative;
  cursor: pointer;
}

var[data-type]::before,
var[data-type]::after {
  position: absolute;
  left: 50%;
  top: -6px;
  opacity: 0;
  transition: opacity 0.4s;
  pointer-events: none;
}

/* the triangle or arrow or caret or whatever */
var[data-type]::before {
  content: "";
  transform: translateX(-50%);
  border-width: 4px 6px 0 6px;
  border-style: solid;
  border-color: transparent;
  border-top-color: #000;
}

/* actual text */
var[data-type]::after {
  content: attr(data-type);
  transform: translateX(-50%) translateY(-100%);
  background: #000;
  text-align: center;
  /* additional styling */
  font-family: "Dank Mono", "Fira Code", monospace;
  font-style: normal;
  padding: 6px;
  border-radius: 3px;
  color: #daca88;
  text-indent: 0;
  font-weight: normal;
}

var[data-type]:hover::after,
var[data-type]:hover::before {
  opacity: 1;
}
</style><script id="initialUserConfig" type="application/json">{
  "specStatus": "ED",
  "shortName": "wot-scripting-api",
  "copyrightStart": 2017,
  "noLegacyStyle": true,
  "publishDate": "",
  "previousPublishDate": "",
  "previousMaturity": "",
  "edDraftURI": "https://w3c.github.io/wot-scripting-api/",
  "crEnd": "",
  "inlineCSS": true,
  "noIDLIn": true,
  "format": "markdown",
  "editors": [
    {
      "name": "Zoltan Kis",
      "company": "Intel",
      "companyURL": "https://www.intel.com/"
    },
    {
      "name": "Daniel Peintner",
      "company": "Siemens AG",
      "companyURL": "https://www.siemens.com/"
    },
    {
      "name": "Johannes Hund",
      "note": "Former Editor, when at Siemens AG"
    },
    {
      "name": "Kazuaki Nimura",
      "note": "Former Editor, at Fujitsu Ltd."
    }
  ],
  "wg": "Web of Things Working Group",
  "wgURI": "https://www.w3.org/WoT/WG/",
  "wgPublicList": "public-wot-wg",
  "issueBase": "https://www.github.com/w3c/wot-scripting-api/issues/",
  "githubAPI": "https://api.github.com/repos/w3c/wot-scripting-api",
  "otherLinks": [
    {
      "key": "Repository",
      "data": [
        {
          "value": "On GitHub",
          "href": "https://github.com/w3c/wot-scripting-api"
        },
        {
          "value": "File a bug",
          "href": "https://github.com/w3c/wot-scripting-api/issues"
        }
      ]
    },
    {
      "key": "Contributors",
      "data": [
        {
          "value": "Contributors on GitHub",
          "href": "https://github.com/w3c/wot-scripting-api/graphs/contributors"
        }
      ]
    }
  ],
  "localBiblio": {
    "WOT-ARCHITECTURE": {
      "href": "https://w3c.github.io/wot-architecture/",
      "title": "Web of Things Architecture",
      "publisher": "W3C",
      "date": "20 August 2017",
      "id": "wot-architecture"
    },
    "WOT-TD": {
      "href": "https://w3c.github.io/wot-thing-description/",
      "title": "WoT Thing Description ",
      "publisher": "W3C",
      "date": "20 August 2017",
      "id": "wot-td"
    },
    "WOT-PROTOCOL-BINDINGS": {
      "href": "https://w3c.github.io/wot-binding-templates/",
      "title": "Web of Things Protocol Binding Templates",
      "publisher": "W3C",
      "date": "20 August 2017",
      "id": "wot-protocol-bindings"
    },
    "WOT-PRACTICES": {
      "href": "http://w3c.github.io/wot/current-practices/wot-practices.html",
      "title": "Web of Things Current Practices",
      "publisher": "W3C",
      "date": "6 February 2017"
    },
    "WOT-SECURITY-GUIDELINES": {
      "href": "https://w3c.github.io/wot-security/",
      "title": "Web of Things Security and Privacy Guidelines",
      "publisher": "W3C",
      "date": "28 August 2017",
      "id": "wot-security-guidelines"
    },
    "WOT-SECURITY-BEST-PRACTICES": {
      "href": "https://github.com/w3c/wot-security/blob/master/wot-security-best-practices.md",
      "title": "Web of Things Security and Privacy Best Practices",
      "publisher": "W3C",
      "date": "WIP",
      "id": "wot-security-best-practices"
    },
    "WOT-SECURITY-TESTING": {
      "href": "https://github.com/w3c/wot-security/blob/master/wot-security-testing.md",
      "title": "Web of Things Security Testing and Validation",
      "publisher": "W3C",
      "date": "WIP",
      "id": "wot-security-testing"
    },
    "TYPESCRIPT": {
      "href": "https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md",
      "title": "TypeScript Language Specification",
      "publisher": "Microsoft",
      "date": "1 October 2012",
      "id": "typescript"
    },
    "WEBAPPSEC": {
      "href": "https://w3c.github.io/webappsec/specs/powerfulfeatures",
      "title": "Secure Contexts",
      "publisher": "W3C",
      "date": "17 July 2015",
      "id": "webappsec"
    }
  },
  "doc1": "https://www.w3.org/TR/wot-scripting-api/",
  "doc2": "https://w3c.github.io/wot-scripting-api/",
  "publishISODate": "2019-09-27T00:00:00.000Z",
  "generatedSubtitle": "Editor's Draft 27 September 2019"
}</script><meta name="description" content="The
overall

main

Web
of
Things

(WoT)
concepts
are
described
in
the

WoT
Architecture

document.
The
Web
of
Things
is
made
of
entities
(

Thing

s)
that
can
describe
their
capabilities
in
a
machine-interpretable
format,
the


Thing
Description

(TD)
and
expose
these
capabilities
through
the

WoT
Interface
,
that
is,
network
interactions
modeled
as

Properties

for

(for

reading
and
writing
values,

values),

Action

s
to

(to

execute
remote
procedures
with
or
without
return
values

values)

and

Event

s
for

(for

signaling
notifications.
This
specification
describes
a
programming
interface
representing
the
WoT
Interface
that
allows
scripts
run
on
a
Thing
to
discover
and
consume
(retrieve)
other
Thing
Description
s
and
to
expose
Things
characterized
by
WoT
Interactions
specified
by
a
script.

notifications)."><link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED"></head>
<body class="h-entry" data-cite="WebIDL"><div class="head">
      <a class="logo" href="https://www.w3.org/"><img alt="W3C" width="72" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C"></a> <h1 id="title" class="title p-name">Web of Things (WoT) Scripting API</h1>
      
      <h2>
        W3C Editor's Draft
        <time class="dt-published" datetime="2019-09-27">27 September 2019</time>
      </h2>
      <dl>
        <dt>This version:</dt><dd>
                <a class="u-url" href="https://w3c.github.io/wot-scripting-api/">https://w3c.github.io/wot-scripting-api/</a>
              </dd><dt>Latest published version:</dt><dd>
                <a href="https://www.w3.org/TR/wot-scripting-api/">https://www.w3.org/TR/wot-scripting-api/</a>
              </dd>
        <dt>Latest editor's draft:</dt><dd><a href="https://w3c.github.io/wot-scripting-api/">https://w3c.github.io/wot-scripting-api/</a></dd>
        
        
        
        
        
        
        <dt>Editors:</dt>
        <dd class="p-author h-card vcard"><span class="p-name fn">Zoltan Kis</span>
            (<a class="p-org org h-org h-card" href="https://www.intel.com/">Intel</a>)
          </dd><dd class="p-author h-card vcard"><span class="p-name fn">Daniel Peintner</span>
            (<a class="p-org org h-org h-card" href="https://www.siemens.com/">Siemens AG</a>)
          </dd><dd class="p-author h-card vcard"><span class="p-name fn">Johannes Hund</span> (Former Editor, when at Siemens AG)</dd><dd class="p-author h-card vcard"><span class="p-name fn">Kazuaki Nimura</span> (Former Editor, at Fujitsu Ltd.)</dd>
        
        
        <dt>Repository:</dt><dd>
      <a href="https://github.com/w3c/wot-scripting-api">On GitHub</a>
    </dd><dd>
      <a href="https://github.com/w3c/wot-scripting-api/issues">File a bug</a>
    </dd><dt>Contributors:</dt><dd>
      <a href="https://github.com/w3c/wot-scripting-api/graphs/contributors">Contributors on GitHub</a>
    </dd>
      </dl>
      
      
      
      <p class="copyright">
      <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
      ©
      2017-2019
      
      <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
      <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>,
      <a href="https://ev.buaa.edu.cn/">Beihang</a>). 
      W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
      <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a rel="license" href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">permissive document license</a> rules
      apply.
    </p>
      <hr title="Separator for header">
    </div><p><del class="diff-old">Web
of
Things
(WoT)
Scripting
API
<abbr title="World Wide Web Consortium">W3C</abbr>
Working
Draft
29
November
2018
This
version:
<a href="https://www.w3.org/TR/2018/WD-wot-scripting-api-20181129/">https://www.w3.org/TR/2018/WD-wot-scripting-api-20181129/</a>
Latest
published
version:
<a href="https://www.w3.org/TR/wot-scripting-api/">https://www.w3.org/TR/wot-scripting-api/</a>
Latest
editor's
draft:
<a href="https://w3c.github.io/wot-scripting-api/">https://w3c.github.io/wot-scripting-api/</a>
Previous
version:
<a href="https://www.w3.org/TR/2018/WD-wot-scripting-api-20180405/">https://www.w3.org/TR/2018/WD-wot-scripting-api-20180405/</a>
Editors:
Zoltan
Kis
(
Intel
)
Kazuaki
Nimura
(
Fujitsu
Ltd.
)
Daniel
Peintner
(
Siemens
AG
)
Johannes
Hund
(Former
Editor,
when
at
Siemens
AG)
Contributors:
In
the
GitHub
repository
Repository:
We
are
on
GitHub
File
a
bug
Copyright
©
2017-2018
<abbr title="World Wide Web Consortium">W3C</abbr>
®
(
<abbr title="Massachusetts Institute of Technology">MIT</abbr>
,
<abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr>
,
Keio
,
Beihang
).
<abbr title="World Wide Web Consortium">W3C</abbr>
liability
,
trademark
and
permissive
document
license
rules
apply.
Abstract
</del></p><section id="abstract" class="introductory"><h2>Abstract</h2><p>
The
<del class="diff-old">overall
</del>
<ins class="diff-chg">main
</ins><a href="#dfn-web-of-things" class="internalDFN" data-link-type="dfn">
Web
of
Things
</a>
(WoT)
concepts
are
described
in
the
<a href="https://w3c.github.io/wot-architecture/">
WoT
Architecture
</a>
document.
The
Web
of
Things
is
made
of
entities
(
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
s)
that
can
describe
their
capabilities
in
a
machine-interpretable
<del class="diff-old">format,
the
</del>
<a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
Thing
Description
</a>
(TD)
and
expose
these
capabilities
through
the
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found">
WoT
Interface
</a>,
that
is,
network
interactions
modeled
as
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Properties
</a>
<del class="diff-old">for
</del>
<ins class="diff-chg">(for
</ins>
reading
and
writing
<del class="diff-old">values,
</del>
<ins class="diff-chg">values),
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
s
<del class="diff-old">to
</del>
<ins class="diff-chg">(to
</ins>
execute
remote
procedures
with
or
without
return
<del class="diff-old">values
</del>
<ins class="diff-chg">values)
</ins>
and
<a href="#dfn-events" class="internalDFN" data-link-type="dfn">
Event
</a>
s
<del class="diff-old">for
</del>
<ins class="diff-chg">(for
</ins>
signaling
<del class="diff-old">notifications.
This
specification
describes
a
programming
interface
representing
the
WoT
Interface
that
allows
scripts
run
on
a
Thing
to
discover
and
consume
(retrieve)
other
Thing
Description
s
and
to
expose
Things
characterized
by
WoT
Interactions
specified
by
a
script.
</del>
<ins class="diff-chg">notifications).
</ins>
</p><p>
Scripting
is
an
optional
"convenience"
building
block
in
WoT
and
it
is
typically
used
in
gateways
that
are
able
to
run
a
<a href="#dfn-wot-runtime" class="internalDFN" data-link-type="dfn">
WoT
Runtime
</a>
and
<a href="https://github.com/w3c/wot-scripting-api/tree/master/applications/script-manager">
script
management
</a>,
providing
a
convenient
way
to
extend
WoT
support
to
new
types
of
endpoints
and
implement
WoT
applications
<del class="diff-old">like
</del>
<ins class="diff-chg">such
as
</ins>
<a href="https://github.com/w3c/wot-scripting-api/tree/master/applications/thing-directory">
Thing
Directory
</a>.
</p><del class="diff-old">Status
of
This
Document
</del><p>
This
<del class="diff-old">section
</del>
<ins class="diff-chg">specification
</ins>
describes
<ins class="diff-new">a
programming
interface
representing
</ins>
the
<del class="diff-old">status
of
this
document
at
the
time
of
its
publication.
Other
documents
may
supersede
this
document.
A
list
of
current
<abbr title="World Wide Web Consortium">W3C</abbr>
publications
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-0">
<ins class="diff-chg">WoT
Interface
</ins></a><ins class="diff-chg">
that
allows
scripts
to
discover,
operate
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
</ins>
and
<ins class="diff-new">to
expose
locally
defined
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Things
</ins></a><ins class="diff-new">
characterized
by
</ins><a href="#dfn-wot-interactions" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
WoT
Interactions
</ins></a><ins class="diff-new">
specified
by
a
script.
</ins></p><p><ins class="diff-new">
The
specification
deliberately
follows
</ins>
the
<del class="diff-old">latest
revision
</del>
<a href="https://w3c.github.io/wot-thing-description">
<ins class="diff-chg">WoT
Thing
Description
specification
</ins></a><ins class="diff-chg">
closely.
It
is
possible
to
implement
simpler
APIs
on
top
</ins>
of
this
<del class="diff-old">technical
report
can
be
found
in
</del>
<ins class="diff-chg">API,
or
implementing
directly
</ins>
the
<del class="diff-old"><abbr title="World Wide Web Consortium">W3C</abbr>
technical
reports
index
</del>
<ins class="diff-chg">WoT
network
facing
interface
(i.e.
the
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-1"><ins class="diff-chg">
WoT
Interface
</ins>
</a>
<ins class="diff-new">).
</ins></p><div class="note" id="issue-container-generatedID"><div role="heading" class="ednote-title marker" id="h-ednote" aria-level="3"><span>Editor's note</span></div><p class=""><ins class="diff-new">
This
specification
is
implemented
</ins>
at
<del class="diff-old">https://www.w3.org/TR/.
</del>
<ins class="diff-chg">least
by
the
</ins><a href="http://www.thingweb.io/"><ins class="diff-chg">
Thingweb
</ins></a><ins class="diff-chg">
project
also
known
as
</ins><a href="https://github.com/eclipse/thingweb.node-wot"><ins class="diff-chg">
node-wot
</ins></a>,<ins class="diff-chg">
which
is
considered
the
reference
open
source
implementation
at
the
moment.
Check
its
</ins><a href="https://github.com/eclipse/thingweb.node-wot"><ins class="diff-chg">
source
code
</ins></a>,<ins class="diff-chg">
including
</ins><a href="https://github.com/eclipse/thingweb.node-wot"><ins class="diff-chg">
examples
</ins></a>.<ins class="diff-chg">
Other,
closed
source
implementations
have
been
made
by
WG
member
companies
and
tested
against
</ins><a href="https://github.com/eclipse/thingweb.node-wot"><ins class="diff-chg">
node-wot
</ins></a><ins class="diff-chg">
in
plug-fests.
</ins>
</p></div></section><section id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at https://www.w3.org/TR/.</em></p><p>
Implementers
need
to
be
aware
that
this
specification
is
considered
unstable.
Vendors
interested
in
implementing
this
specification
before
it
eventually
reaches
the
Candidate
Recommendation
phase
should
subscribe
to
the
<a href="https://github.com/w3c/wot-scripting-api">
repository
</a>
and
take
part
in
the
discussions.
</p><del class="diff-old">Editor's
note
:
The
<abbr title="World Wide Web Consortium">W3C</abbr>
WoT
WG
is
asking
for
feedback
</del><div class="note" id="issue-container-generatedID-0"><div role="heading" class="ednote-title marker" id="h-ednote-0" aria-level="3"><span>Editor's note</span><span class="issue-label">: The W3C WoT WG is asking for feedback</span></div><p class="">
Please
contribute
to
this
draft
using
the
<a href="https://github.com/w3c/wot-scripting-api/issues">
GitHub
Issue
</a>
feature
of
the
<a href="https://github.com/w3c/wot-scripting-api/">
WoT
Scripting
API
</a>
repository.
For
feedback
on
security
and
privacy
considerations,
please
use
the
<a href="https://github.com/w3c/wot-security/issues">
WoT
Security
and
Privacy
</a>
Issues.
</p></div><del class="diff-old">This
document
was
published
by
the
Web
of
Things
Working
Group
as
a
Working
Draft.
This
document
is
intended
to
become
a
<abbr title="World Wide Web Consortium">W3C</abbr>
Recommendation.
Comments
regarding
this
document
are
welcome.
Please
send
them
to
public-wot-wg@w3.org
(
subscribe
,
archives
).
Changes
from
the
previous
publication
can
be
found
in
Appendix
A
.
A
diff-marked
version
of
this
document
is
also
available
for
comparison
purposes.
Publication
as
a
Working
Draft
does
not
imply
endorsement
by
the
<abbr title="World Wide Web Consortium">W3C</abbr>
Membership.
This
is
a
draft
document
and
may
be
updated,
replaced
or
obsoleted
by
other
documents
at
any
time.
It
is
inappropriate
to
cite
this
document
as
other
than
work
in
progress.
This
document
was
produced
by
a
group
operating
under
the
<abbr title="World Wide Web Consortium">W3C</abbr>
Patent
Policy
.
<abbr title="World Wide Web Consortium">W3C</abbr>
maintains
a
public
list
of
any
patent
disclosures
made
in
connection
with
the
deliverables
of
the
group;
that
page
also
includes
instructions
for
disclosing
a
patent.
An
individual
who
has
actual
knowledge
of
a
patent
which
the
individual
believes
contains
Essential
Claim(s)
must
disclose
the
information
in
accordance
with
section
6
of
the
<abbr title="World Wide Web Consortium">W3C</abbr>
Patent
Policy
.
This
document
is
governed
by
the
1
February
2018
<abbr title="World Wide Web Consortium">W3C</abbr>
Process
Document
.
</del><p>
      This document was published by the <a href="https://www.w3.org/WoT/WG/">Web of Things Working Group</a> as an
      Editor's Draft.
      
    </p><p>
      
      Comments regarding this document are welcome.
            Please send them to
            <a href="mailto:public-wot-wg@w3.org">public-wot-wg@w3.org</a>
            (<a href="https://lists.w3.org/Archives/Public/public-wot-wg/">archives</a>).
          
    </p><p>
      Publication as an Editor's Draft does not imply endorsement by the
      <abbr title="World Wide Web Consortium">W3C</abbr> Membership. This is a draft document and may be updated, replaced or
      obsoleted by other documents at any time. It is inappropriate to cite this
      document as other than work in progress.
    </p><p>
      
        This document was produced by a group
        operating under the
        <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
       
      
                  <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
                  <a rel="disclosure" href="">public list of any patent disclosures</a>
            made in connection with the deliverables of
            the group; that page also includes
            instructions for disclosing a patent. An individual who has actual
            knowledge of a patent which the individual believes contains
            <a href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a>
            must disclose the information in accordance with
            <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
          
      
    </p><p>
                  This document is governed by the
                  <a id="w3c_process_revision" href="https://www.w3.org/2019/Process-20190301/">1 March 2019 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>
Introduction
</a></li><li class="tocline"><a class="tocxref" href="#use-cases-this-section-is-non-normative"><bdi class="secno">2. </bdi>
Use
Cases
<del class="diff-old">This
section
is
non-normative.
</del>
</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#consuming-a-thing"><bdi class="secno">2.1 </bdi>
Consuming
a
Thing
</a></li><li class="tocline"><a class="tocxref" href="#exposing-a-thing"><bdi class="secno">2.2 </bdi>
Exposing
a
Thing
</a></li><li class="tocline"><a class="tocxref" href="#discovery"><bdi class="secno">2.3 </bdi>
<ins class="diff-new">Discovery
</ins></a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">3. </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#the-thingfilter-thingdescription-dictionary-type"><bdi class="secno">4. </bdi>
The
<del class="diff-old">ThingFilter
</del>
<span data-dfn-type="dfn">
<ins class="diff-chg">ThingDescription
</ins>
</span>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">type
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#fetching-a-thing-description"><bdi class="secno">4.1 </bdi><ins class="diff-chg">
Fetching
a
</ins>
Thing
<ins class="diff-new">Description
</ins></a></li><li class="tocline"><a class="tocxref" href="#expanding-a-thing-description"><bdi class="secno">4.2 </bdi>
<ins class="diff-chg">Expanding
a
Thing
Description
</ins></a></li><li class="tocline"><a class="tocxref" href="#validating-a-thing-description"><bdi class="secno">4.3 </bdi><ins class="diff-chg">
Validating
a
Thing
Description
</ins></a></li></ol></li><li class="tocline"><a class="tocxref" href="#the-query-wot-api-object-property-represents"><bdi class="secno">5. </bdi>
The
<del class="diff-old">query
</del>
<span data-dfn-type="dfn">
<ins class="diff-chg">WoT
API
object
</ins>
</span>
<del class="diff-old">property
represents
</del>
</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#the-wot-interface"><bdi class="secno">5.1 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="dfn" data-idl="interface" data-title="
WOT
"><code><ins class="diff-chg">
WOT
</ins></code></span><ins class="diff-chg">
interface
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-fragment-consume-property-represents-method"><bdi class="secno">5.2 </bdi>
The
<del class="diff-old">fragment
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
consume()

" data-dfn-for="WOT" data-type="Promise" data-lt="WOT.consume()|WOT.consume|consume()|consume"><code>
<ins class="diff-chg">consume()
</ins>
</code></span>
<del class="diff-old">property
represents
</del>
<ins class="diff-chg">method
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-produce-method"><bdi class="secno">5.3 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
produce()
" data-dfn-for="WOT" data-type="Promise" data-lt="WOT.produce()|WOT.produce|produce()|produce"><code><ins class="diff-chg">
produce()
</ins></code></span><ins class="diff-chg">
method
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-discover-method"><bdi class="secno">5.4 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
discover()
" data-dfn-for="WOT" data-type="ThingDiscovery" data-lt="WOT.discover()|WOT.discover|discover()|discover"><code><ins class="diff-chg">
discover()
</ins></code></span><ins class="diff-chg">
method
</ins></a></li></ol></li><li class="tocline"><a class="tocxref" href="#the-underlying-implementation-is-responsible-consumedthing-interface"><bdi class="secno">6. </bdi>
The
<del class="diff-old">underlying
implementation
is
responsible
</del>
<span data-dfn-type="dfn">
<ins class="diff-chg">ConsumedThing
</ins></span><ins class="diff-chg">
interface
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#constructing-consumedthing"><bdi class="secno">6.1 </bdi><ins class="diff-chg">
Constructing
</ins><code><ins class="diff-chg">
ConsumedThing
</ins></code></a></li><li class="tocline"><a class="tocxref" href="#the-getthingdescription-method"><bdi class="secno">6.2 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
getThingDescription()
" data-dfn-for="ConsumedThing" data-type="ThingDescription" data-lt="ConsumedThing.getThingDescription()|ConsumedThing.getThingDescription|getThingDescription()|getThingDescription"><code><ins class="diff-chg">
getThingDescription()
</ins></code></span><ins class="diff-chg">
method
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-interactionoptions-dictionary"><bdi class="secno">6.3 </bdi>
<ins class="diff-chg">The
</ins><span data-dfn-type="dfn"><ins class="diff-chg">
InteractionOptions
</ins></span><ins class="diff-chg">
dictionary
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-propertymap-type"><bdi class="secno">6.4 </bdi><ins class="diff-new">
The
</ins><span data-dfn-type="dfn"><ins class="diff-new">
PropertyMap
</ins></span><ins class="diff-new">
type
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-readproperty-method"><bdi class="secno">6.5 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
readProperty()
" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.readProperty()|ConsumedThing.readProperty|readProperty()|readProperty"><code><ins class="diff-chg">
readProperty()
</ins></code></span><ins class="diff-chg">
method
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-fetch-readmultipleproperties-method"><bdi class="secno">6.6 </bdi>
The
<del class="diff-old">fetch()
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
readMultipleProperties()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.readMultipleProperties()|ConsumedThing.readMultipleProperties|readMultipleProperties()|readMultipleProperties"><code>
<ins class="diff-chg">readMultipleProperties()
</ins>
</code></span>
method
</a></li><li class="tocline"><a class="tocxref" href="#the-consume-readallproperties-method"><bdi class="secno">6.7 </bdi>
The
<del class="diff-old">consume()
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
readAllProperties()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.readAllProperties()|ConsumedThing.readAllProperties|readAllProperties()|readAllProperties"><code>
<ins class="diff-chg">readAllProperties()
</ins>
</code></span>
method
</a></li><li class="tocline"><a class="tocxref" href="#the-writeproperty-method"><bdi class="secno">6.8 </bdi>
<ins class="diff-chg">The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
writeProperty()
" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.writeProperty()|ConsumedThing.writeProperty|writeProperty()|writeProperty"><code><ins class="diff-chg">
writeProperty()
</ins></code></span><ins class="diff-chg">
method
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-produce-writemultipleproperties-method"><bdi class="secno">6.9 </bdi>
The
<del class="diff-old">produce()
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
writeMultipleProperties()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.writeMultipleProperties()|ConsumedThing.writeMultipleProperties|writeMultipleProperties()|writeMultipleProperties"><code>
<ins class="diff-chg">writeMultipleProperties()
</ins>
</code></span>
method
</a></li><li class="tocline"><a class="tocxref" href="#the-wotlistener-callback"><bdi class="secno">6.10 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="dfn"><ins class="diff-chg">
WotListener
</ins></span><ins class="diff-chg">
callback
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-observeproperty-method-is-provided-to-define"><bdi class="secno">6.11 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
observeProperty()
" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.observeProperty()|ConsumedThing.observeProperty|observeProperty()|observeProperty"><code><ins class="diff-chg">
observeProperty()
</ins></code></span>
method
<del class="diff-old">is
provided
to
define
</del>
</a></li><li class="tocline"><a class="tocxref" href="#the-unregister-unobserveproperty-method"><bdi class="secno">6.12 </bdi>
The
<del class="diff-old">unregister()
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
unobserveProperty()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.unobserveProperty()|ConsumedThing.unobserveProperty|unobserveProperty()|unobserveProperty"><code>
<ins class="diff-chg">unobserveProperty()
</ins>
</code></span>
method
</a></li><li class="tocline"><a class="tocxref" href="#the-consumedthing-invokeaction-interface-represents-an-object-that-extends-method"><bdi class="secno">6.13 </bdi>
The
<del class="diff-old">ConsumedThing
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
invokeAction()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.invokeAction()|ConsumedThing.invokeAction|invokeAction()|invokeAction"><code>
<ins class="diff-chg">invokeAction()
</ins>
</code></span>
<del class="diff-old">interface
Represents
an
object
that
extends
</del>
<ins class="diff-chg">method
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-expose-subscribeevent-method"><bdi class="secno">6.14 </bdi>
The
<del class="diff-old">expose()
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
subscribeEvent()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.subscribeEvent()|ConsumedThing.subscribeEvent|subscribeEvent()|subscribeEvent"><code>
<ins class="diff-chg">subscribeEvent()
</ins>
</code></span>
method
</a></li><li class="tocline"><a class="tocxref" href="#the-destroy-unsubscribeevent-method"><bdi class="secno">6.15 </bdi>
The
<del class="diff-old">destroy()
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
unsubscribeEvent()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.unsubscribeEvent()|ConsumedThing.unsubscribeEvent|unsubscribeEvent()|unsubscribeEvent"><code>
<ins class="diff-chg">unsubscribeEvent()
</ins>
</code></span>
method
</a></li><li class="tocline"><a class="tocxref" href="#consumedthing-examples"><bdi class="secno">6.16 </bdi>
<ins class="diff-chg">ConsumedThing
Examples
</ins></a></li></ol></li><li class="tocline"><a class="tocxref" href="#the-removeproperty-exposedthing-method-interface"><bdi class="secno">7. </bdi>
The
<del class="diff-old">removeProperty()
</del>
<span data-dfn-type="dfn">
<ins class="diff-chg">ExposedThing
</ins>
</span>
<del class="diff-old">method
</del>
<ins class="diff-chg">interface
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#constructing-addaction-exposedthing-method"><bdi class="secno">7.1 </bdi><ins class="diff-chg">
Constructing
</ins>
<code>
<del class="diff-old">addAction()
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">method
</del>
</a></li><li class="tocline"><a class="tocxref" href="#methods-inherited-from-consumedthing"><bdi class="secno">7.2 </bdi>
<ins class="diff-chg">Methods
inherited
from
</ins><span class="formerLink" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins>
</span>
</a></li><li class="tocline"><a class="tocxref" href="#the-propertyreadhandler-callback"><bdi class="secno">7.3 </bdi>
The
<span data-dfn-type="dfn">
PropertyReadHandler
</span>
callback
</a></li><li class="tocline"><a class="tocxref" href="#the-setpropertyreadhandler-method"><bdi class="secno">7.4 </bdi>
The
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
setPropertyReadHandler()
" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt="ExposedThing.setPropertyReadHandler()|ExposedThing.setPropertyReadHandler|setPropertyReadHandler()|setPropertyReadHandler"><code>
setPropertyReadHandler()
</code></span>
method
</a></li><li class="tocline"><a class="tocxref" href="#handling-property-read-requests"><bdi class="secno">7.5 </bdi>
<ins class="diff-chg">Handling
</ins><span class="formerLink" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></span><ins class="diff-chg">
read
requests
</ins></a></li><li class="tocline"><a class="tocxref" href="#handling-property-observe-requests"><bdi class="secno">7.6 </bdi><ins class="diff-new">
Handling
</ins><span class="formerLink" data-link-type="dfn"><ins class="diff-new">
Property
</ins></span><ins class="diff-new">
observe
requests
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-propertywritehandler-callback"><bdi class="secno">7.7 </bdi>
The
<span data-dfn-type="dfn">
<ins class="diff-chg">PropertyWriteHandler
</ins></span><ins class="diff-chg">
callback
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-setpropertywritehandler-method"><bdi class="secno">7.8 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
setPropertyWriteHandler()

" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt="ExposedThing.setPropertyWriteHandler()|ExposedThing.setPropertyWriteHandler|setPropertyWriteHandler()|setPropertyWriteHandler"><code><ins class="diff-chg">
setPropertyWriteHandler()
</ins>
</code></span>
method
</a></li><li class="tocline"><a class="tocxref" href="#handling-property-write-requests"><bdi class="secno">7.9 </bdi>
<ins class="diff-chg">Handling
</ins><span class="formerLink" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></span><ins class="diff-chg">
write
requests
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-actionhandler-callback"><bdi class="secno">7.10 </bdi>
The
<span data-dfn-type="dfn">
<ins class="diff-chg">ActionHandler
</ins></span><ins class="diff-chg">
callback
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-setactionhandler-method"><bdi class="secno">7.11 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
setActionHandler()

" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt="ExposedThing.setActionHandler()|ExposedThing.setActionHandler|setActionHandler()|setActionHandler"><code><ins class="diff-chg">
setActionHandler()
</ins>
</code></span>
method
</a></li><li class="tocline"><a class="tocxref" href="#handling-action-requests"><bdi class="secno">7.12 </bdi>
<ins class="diff-chg">Handling
</ins><span class="formerLink" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></span><ins class="diff-chg">
requests
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-emitevent-method"><bdi class="secno">7.13 </bdi>
<ins class="diff-chg">The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
emitEvent()
" data-dfn-for="ExposedThing" data-type="void" data-lt="ExposedThing.emitEvent()|ExposedThing.emitEvent|emitEvent()|emitEvent"><code><ins class="diff-chg">
emitEvent()
</ins></code></span><ins class="diff-chg">
method
</ins>
</a></li><li class="tocline"><a class="tocxref" href="#the-dataschema-expose-dictionary-and-its-subclasses-method"><bdi class="secno">7.14 </bdi>
The
<del class="diff-old">DataSchema
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
expose()

" data-dfn-for="ExposedThing" data-type="Promise" data-lt="ExposedThing.expose()|ExposedThing.expose|expose()|expose"><code>
<ins class="diff-chg">expose()
</ins>
</code></span>
<del class="diff-old">dictionary
and
its
subclasses
</del>
<ins class="diff-chg">method
</ins>
</a></li><li class="tocline"><a class="tocxref" href="#the-thingfragment-destroy-dictionary-method"><bdi class="secno">7.15 </bdi>
The
<del class="diff-old">ThingFragment
</del>
<span data-dfn-type="method" data-export="" data-idl="operation" data-title="
destroy()

" data-dfn-for="ExposedThing" data-type="Promise" data-lt="ExposedThing.destroy()|ExposedThing.destroy|destroy()|destroy"><code>
<ins class="diff-chg">destroy()
</ins>
</code></span>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">method
</ins>
</a></li><li class="tocline"><a class="tocxref" href="#exposedthing-examples"><bdi class="secno">7.16 </bdi><ins class="diff-chg">
ExposedThing
Examples
</ins></a></li></ol></li><li class="tocline"><a class="tocxref" href="#the-forms-thingdiscovery-read-only-property-represents-the-protocol-bindings-initialization-data-and-interface"><bdi class="secno">8. </bdi>
The
<del class="diff-old">forms
</del>
<span data-dfn-type="dfn">
<ins class="diff-chg">ThingDiscovery
</ins>
</span>
<del class="diff-old">read-only
property
represents
the
protocol
bindings
initialization
data
and
</del>
<ins class="diff-chg">interface
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#constructing-write-thingdiscovery-method-will-attempt-to-set-the-value-of"><bdi class="secno">8.1 </bdi>
<ins class="diff-new">Constructing
</ins>
<code>
<del class="diff-old">write()
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
<del class="diff-old">method
will
attempt
to
set
the
value
of
</del>
</a></li><li class="tocline"><a class="tocxref" href="#the-discoverymethod-enumeration"><bdi class="secno">8.2 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="dfn"><ins class="diff-chg">
DiscoveryMethod
</ins></span><ins class="diff-chg">
enumeration
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-exposedevent-thingfilter-interface-dictionary"><bdi class="secno">8.3 </bdi>
The
<del class="diff-old">ExposedEvent
</del>
<span data-dfn-type="dfn">
<ins class="diff-chg">ThingFilter
</ins>
</span>
<del class="diff-old">interface
</del>
<ins class="diff-chg">dictionary
</ins>
</a></li><li class="tocline"><a class="tocxref" href="#the-start-method"><bdi class="secno">8.4 </bdi><ins class="diff-chg">
The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
start()
" data-dfn-for="ThingDiscovery" data-type="void" data-lt="ThingDiscovery.start()|ThingDiscovery.start|start()|start"><code><ins class="diff-chg">
start()
</ins></code></span><ins class="diff-chg">
method
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-next-method"><bdi class="secno">8.5 </bdi>
<ins class="diff-chg">The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
next()
" data-dfn-for="ThingDiscovery" data-type="Promise" data-lt="ThingDiscovery.next()|ThingDiscovery.next|next()|next"><code><ins class="diff-chg">
next()
</ins></code></span><ins class="diff-chg">
method
</ins></a></li><li class="tocline"><a class="tocxref" href="#the-stop-are-proposed-to-method"><bdi class="secno">8.6 </bdi>
<ins class="diff-chg">The
</ins><span data-dfn-type="method" data-export="" data-idl="operation" data-title="
stop()

" data-dfn-for="ThingDiscovery" data-type="void" data-lt="ThingDiscovery.stop()|ThingDiscovery.stop|stop()|stop"><code><ins class="diff-chg">
stop()
</ins>
</code></span>
<del class="diff-old">are
proposed
to
</del>
<ins class="diff-chg">method
</ins></a></li><li class="tocline"><a class="tocxref" href="#discovery-examples"><bdi class="secno">8.7 </bdi><ins class="diff-chg">
Discovery
Examples
</ins>
</a></li></ol></li><li class="tocline"><a class="tocxref" href="#x9-security-and-privacy"><bdi class="secno">9. </bdi>
<del class="diff-old">9.
</del>
Security
and
Privacy
</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#sec-security-consideration-runtime"><bdi class="secno">9.1 </bdi><ins class="diff-chg">
Scripting
Runtime
Security
and
Privacy
Risks
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#sec-security-consideration-input"><bdi class="secno">9.1.1 </bdi><ins class="diff-chg">
Corrupted
Input
Security
</ins>
and
<del class="diff-old">their
data
if
</del>
<ins class="diff-chg">Privacy
Risk
</ins></a></li><li class="tocline"><a class="tocxref" href="#sec-security-consideration-device-direct-access"><bdi class="secno">9.1.2 </bdi><ins class="diff-chg">
Physical
Device
Direct
Access
Security
and
Privacy
Risk
</ins></a></li><li class="tocline"><a class="tocxref" href="#sec-security-consideration-update-provisioning"><bdi class="secno">9.1.3 </bdi>
<ins class="diff-chg">Provisioning
and
Update
Security
Risk
</ins></a></li><li class="tocline"><a class="tocxref" href="#sec-security-consideration-credentials-storage"><bdi class="secno">9.1.4 </bdi><ins class="diff-chg">
Security
Credentials
Storage
Security
and
Privacy
Risk
</ins></a></li></ol></li><li class="tocline"><a class="tocxref" href="#sec-security-consideration-script"><bdi class="secno">9.2 </bdi>
<ins class="diff-chg">Script
Security
and
Privacy
Risks
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#sec-security-consideration-script-input"><bdi class="secno">9.2.1 </bdi>
<ins class="diff-chg">Corrupted
Script
Input
Security
and
Privacy
Risk
</ins></a></li><li class="tocline"><a class="tocxref" href="#sec-security-consideration-script-processing"><bdi class="secno">9.2.2 </bdi><ins class="diff-chg">
Denial
Of
Service
Security
Risk
</ins></a></li><li class="tocline"><a class="tocxref" href="#sec-security-consideration-script-stale-td"><bdi class="secno">9.2.3 </bdi><ins class="diff-chg">
Stale
TD
Security
Risk
</ins></a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#terminology-and-conventions"><bdi class="secno">10. </bdi>
Terminology
and
conventions
</a></li><li class="tocline"><a class="tocxref" href="#api-design-rationale"><bdi class="secno">A. </bdi>
<ins class="diff-chg">API
design
rationale
</ins>
</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#approaches-to-wot-application-development"><bdi class="secno">A.1 </bdi>
<ins class="diff-chg">Approaches
to
WoT
application
development
</ins></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#no-scripting-api"><bdi class="secno">A.1.1 </bdi><ins class="diff-chg">
No
Scripting
API
</ins></a></li><li class="tocline"><a class="tocxref" href="#simple-scripting-api"><bdi class="secno">A.1.2 </bdi><ins class="diff-new">
Simple
Scripting
API
</ins></a></li><li class="tocline"><a class="tocxref" href="#this-api-aligned-with-wot-td"><bdi class="secno">A.1.3 </bdi>
This
<ins class="diff-new">API,
aligned
with
[<cite><span class="formerLink" title="WoT Thing Description " data-link-type="biblio">WOT-TD</span></cite>]
</ins></a></li></ol></li><li class="tocline"><a class="tocxref" href="#fetching-and-validating-a-td"><bdi class="secno">A.2 </bdi><ins class="diff-chg">
Fetching
and
validating
a
TD
</ins></a></li><li class="tocline"><a class="tocxref" href="#factory-vs-constructors"><bdi class="secno">A.3 </bdi>
<ins class="diff-new">Factory
vs
constructors
</ins></a></li><li class="tocline"><a class="tocxref" href="#observers"><bdi class="secno">A.4 </bdi><ins class="diff-chg">
Observers
</ins></a></li><li class="tocline"><a class="tocxref" href="#using-events"><bdi class="secno">A.5 </bdi>
<ins class="diff-chg">Using
Events
</ins></a></li><li class="tocline"><a class="tocxref" href="#polymorphic-functions"><bdi class="secno">A.6 </bdi><ins class="diff-chg">
Polymorphic
functions
</ins></a></li></ol></li><li class="tocline"><a class="tocxref" href="#Changes"><bdi class="secno">B. </bdi>
Changes
</a></li><li class="tocline"><a class="tocxref" href="#open-issues"><bdi class="secno">C. </bdi>
Open
issues
</a></li><li class="tocline"><a class="tocxref" href="#idl-index"><bdi class="secno">D. </bdi>
<ins class="diff-chg">Full
Web
IDL
</ins></a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">E. </bdi><ins class="diff-chg">
Acknowledgements
</ins>
</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">F. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">F.1 </bdi>Normative references</a></li></ol></li></ol></nav><del class="diff-old">Table
of
Contents
1.
Introduction
2.
Use
Cases
2.1
Discovery
2.2
Consuming
a
Thing
2.3
Exposing
a
Thing
3.
The
WoT
object
3.1
The
discover()
method
3.1.1
The
DiscoveryMethod
enumeration
3.1.2
The
ThingFilter
dictionary
3.2
The
fetch()
method
3.3
The
consume()
method
3.4
The
produce()
method
3.5
The
register()
method
3.6
The
unregister()
method
3.7
Examples
4.
The
ConsumedThing
interface
4.1
Examples
5.
The
ExposedThing
interface
5.1
The
expose()
method
5.2
The
destroy()
method
5.3
The
addProperty()
method
5.4
The
removeProperty()
method
5.5
The
addAction()
method
5.6
The
removeAction()
method
5.7
The
addEvent()
method
5.8
The
removeEvent()
method
5.9
The
PropertyReadHandler
callback
5.10
The
PropertyWriteHandler
callback
5.11
The
ActionHandler
callback
5.12
The
setPropertyReadHandler()
method
5.13
The
setPropertyWriteHandler()
method
5.14
The
setActionHandler()
method
5.15
Examples
6.
Data
types
and
structures
6.1
The
DataSchema
dictionary
and
its
subclasses
6.2
The
SecurityScheme
dictionary
and
its
subclasses
6.3
The
Link
dictionary
6.4
The
Form
dictionary
6.5
The
InteractionFragment
dictionary
6.6
The
PropertyFragment
dictionary
6.7
The
ActionFragment
dictionary
6.8
The
EventFragment
dictionary
6.9
The
ThingFragment
dictionary
6.10
The
ThingDescription
type
7.
Interfaces
for
WoT
Interactions
7.1
The
Interaction
interface
7.2
The
ThingProperty
interface
7.3
The
ThingAction
interface
7.4
The
ThingEvent
interface
7.5
The
ExposedEvent
interface
7.5.1
The
emit()
method
7.6
The
value-matching
algorithm
8.
Observables
8.1
The
Subscription
interface
8.2
The
Observable
interface
9.
Security
and
Privacy
10.
Terminology
and
conventions
11.
Conformance
A.
Changes
B.
Open
issues
C.
Acknowledgments
D.
References
D.1
Normative
references
D.2
Informative
references
</del><section id="introduction"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>
Introduction
<a class="self-link" aria-label="§" href="#introduction"></a></h2><p><del class="diff-old">1.
</del></p><p>
WoT
provides
layered
interoperability
based
on
how
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
s
are
<del class="diff-old">modeled:
as
being
</del>
<ins class="diff-chg">used:
</ins>
"consumed"
and
<del class="diff-old">"exposed".
</del>
<ins class="diff-chg">"exposed",
as
</ins><a href="https://w3c.github.io/wot-architecture/#terminology"><ins class="diff-chg">
defined
</ins></a><ins class="diff-chg">
in
[<cite><a class="bibref" href="#bib-wot-architecture" title="Web of Things Architecture" data-link-type="biblio">WOT-ARCHITECTURE</a></cite>].
</ins>
</p><p>
By
<a href="#dfn-consume" class="internalDFN" data-link-type="dfn">
consuming
a
TD
</a>,
a
client
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
creates
a
<ins class="diff-new">local
</ins>
runtime
resource
model
that
allows
accessing
the
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Properties
</a>,
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Actions
</a>
and
<a href="#dfn-events" class="internalDFN" data-link-type="dfn">
Events
</a>
exposed
by
the
server
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
<del class="diff-old">exposed
</del>
on
a
remote
device.
</p><div><p>Exposing
a
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
<del class="diff-old">requires
</del>
<ins class="diff-chg">requires:
</ins></p><ul><li>
defining
a
<a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
Thing
Description
</a>
<del class="diff-old">(TD)
and
</del>
<ins class="diff-chg">(TD),
</ins></li><li><ins class="diff-chg">
then
</ins>
instantiating
a
software
stack
<ins class="diff-new">that
implements
the
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-2"><ins class="diff-new">
WoT
Interface
</ins></a><ins class="diff-new">
specified
by
the
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins></a><ins class="diff-new">
in
order
</ins>
to
serve
requests
for
accessing
the
exposed
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Properties
</a>,
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Actions
</a>
and
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-3">
Events
<del class="diff-old">.
</del>
</a>,
</li>
<li>
<ins class="diff-chg">then
eventually
publishing
the
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a><ins class="diff-chg">
(for
instance
to
a
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Directory
</ins></a><ins class="diff-chg">
directory
for
easier
discovery).
</ins></li></ul>
This
specification
describes
how
to
expose
and
consume
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
s
by
a
script.
<del class="diff-old">Note
</del>
<ins class="diff-chg">Also,
it
defines
a
generic
API
for
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
discovery.
</ins>
</div><div class="note" role="note" id="issue-container-generatedID-1"><div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div><p class="">
Typically
scripts
are
meant
to
be
used
on
<del class="diff-old">devices
able
to
provide
resources
(with
a
WoT
Interface
)
for
managing
(installing,
updating,
running)
scripts,
such
as
</del>
bridges
or
gateways
that
expose
and
control
simpler
devices
as
WoT
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
<del class="diff-old">s.
</del>
<ins class="diff-chg">s
and
have
means
to
handle
(e.g.
install,
uninstall,
update
etc.)
and
run
scripts.
</ins>
</p></div><del class="diff-old">Note
</del><div class="note" role="note" id="issue-container-generatedID-2"><div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>Note</span></div><p class="">
This
specification
does
not
make
assumptions
on
how
the
<a href="#dfn-wot-runtime" class="internalDFN" data-link-type="dfn">
WoT
Runtime
</a>
handles
and
runs
scripts,
including
single
or
multiple
tenancy,
script
deployment
and
lifecycle
management.
The
API
already
supports
the
generic
mechanisms
that
make
it
possible
to
implement
script
management,
for
instance
by
exposing
a
manager
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
whose
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Actions
</a>
(action
handlers)
implement
script
lifecycle
management
operations.
</p></div><del class="diff-old">For
an
introduction
on
how
scripts
could
be
used
in
Web
of
Things
,
check
the
Primer
document.
For
some
background
on
API
design
decisions
check
the
Rationale
document.
</del></section><del class="diff-old">2.
</del><section class="informative" id="use-cases-this-section-is-non-normative"><h2 id="x2-use-cases-this-section-is-non-normative"><bdi class="secno">2. </bdi>
Use
Cases
<del class="diff-old">This
section
is
non-normative.
</del>
<a class="self-link" aria-label="§" href="#use-cases-this-section-is-non-normative"></a></h2><p><em>This section is non-normative.</em></p><p>
The
following
scripting
use
cases
are
supported
in
this
specification:
</p><del class="diff-old">2.1
Discovery
Discover
all
Thing
s
in
the
WoT
network
by
sending
a
broadcast
request.
Discover
Thing
s
running
in
the
local
WoT
Runtime
.
Discover
nearby
Thing
s,
for
instance
connected
by
NFC
or
Bluetooth.
Discover
Thing
s
by
sending
a
discovery
request
to
a
given
registry.
Discover
Thing
s
by
filters
defined
on
Thing
Description
s
Discover
Thing
s
by
semantic
queries.
Stop
or
suppress
an
ongoing
discovery
process.
Optionally
specify
a
timeout
to
the
discovery
process
after
which
it
is
stopped/suppressed.
</del><section id="consuming-a-thing"><h3 id="x2-1-consuming-a-thing"><bdi class="secno">2.1 </bdi>
Consuming
a
Thing
<a class="self-link" aria-label="§" href="#consuming-a-thing"></a></h3><p><del class="diff-old">2.2
</del></p><ul>
<li>
<del class="diff-old">Fetch
a
Thing
Description
of
a
Thing
given
its
URL.
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-4">
Consume
a
TD
<del class="diff-old">of
a
Thing
</del>
</a>,
<del class="diff-old">including
parsing
the
TD
and
generating
the
protocol
bindings
in
order
to
access
lower
level
functionality.
On
</del>
<ins class="diff-chg">i.e.
create
</ins>
a
<del class="diff-old">consumed
</del>
<ins class="diff-chg">programmatic
object
from
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-5">
Thing
<del class="diff-old">,
</del>
<ins class="diff-chg">Description
</ins></a><ins class="diff-chg">
that
exposes
</ins><a href="#dfn-wot-interactions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
Interactions
</ins></a>:
<ul>
<li>
Read
the
value
of
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
or
<ins class="diff-new">a
</ins>
set
of
properties.
</li>
<li>
Set
the
value
of
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
or
a
set
of
properties.
</li>
<li>
Observe
value
changes
of
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>.
</li>
<li>
Invoke
an
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>.
</li>
<li>
Observe
<ins class="diff-chg">WoT
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn">
Events
</a>
emitted
by
the
<del class="diff-old">Thing
.
Observe
changes
to
the
Thing
Description
of
the
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>.
</li>
<li>
<del class="diff-old">Get
</del>
<ins class="diff-chg">Introspect
</ins>
the
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-6">
Thing
Description
<del class="diff-old">.
Get
</del>
</a>,
<ins class="diff-chg">including
</ins>
the
list
of
linked
resources
based
on
the
<a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
Thing
Description
</a>.
</li>
</ul>
</li>
</ul></section><section id="exposing-a-thing"><h3 id="x2-2-exposing-a-thing"><bdi class="secno">2.2 </bdi>
Exposing
a
Thing
<a class="self-link" aria-label="§" href="#exposing-a-thing"></a></h3><p><del class="diff-old">2.3
</del></p><ul>
<li>
Exposing
the
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>
includes
generating
the
protocol
bindings
in
order
to
access
lower
level
functionality.
</li>
<li>
Create
a
local
<del class="diff-old">ExposedThing
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins>
</a>
to
be
exposed,
based
on
a
<a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
Thing
Description
</a>
provided
in
string
serialized
format,
or
out
of
<del class="diff-old">a
template
or
</del>
an
existing
<del class="diff-old">ConsumedThing
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins>
</a>
object.
</li>
<li>
Add
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
definition
to
the
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>.
</li>
<li>
<del class="diff-old">Add
an
Action
</del>
<ins class="diff-chg">Remove
a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
definition
<del class="diff-old">to
</del>
<ins class="diff-chg">from
</ins>
the
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>.
</li>
<li>
Add
an
<del class="diff-old">Event
</del>
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Action
</ins>
</a>
definition
to
the
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>.
</li>
<li>
<del class="diff-old">Attach
semantic
information
to
</del>
<ins class="diff-chg">Remove
an
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a><ins class="diff-chg">
definition
from
</ins>
the
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>.
</li>
<li>
<del class="diff-old">Attach
semantic
information
to
</del>
<ins class="diff-chg">Add
</ins>
a
<del class="diff-old">Property
.
Attach
semantic
information
</del>
<ins class="diff-chg">WoT
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
definition
</ins>
to
<del class="diff-old">an
Action
</del>
<ins class="diff-chg">the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins>
</a>.
</li>
<li>
<del class="diff-old">Attach
semantic
information
to
an
</del>
<ins class="diff-chg">Remove
a
WoT
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn">
Event
</a>
<ins class="diff-new">definition
from
the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins>
</a>.
</li>
<li>
Emit
<del class="diff-old">an
</del>
<ins class="diff-chg">a
WoT
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn">
Event
</a>,
i.e.
notify
all
<del class="diff-old">listeners
subscribed
to
that
Event
.
Provide
notifications
for
TD
changes
to
clients
</del>
subscribed
<del class="diff-old">to
that.
Mark/unmark
the
Thing
to
be
discoverable.
Mark/unmark
the
Thing
to
be
consumable.
Start
the
exposed
Thing
in
order
to
process
external
requests.
Stop
the
exposed
Thing
.
</del>
<ins class="diff-chg">listeners.
</ins>
</li>
<li>
Register
<ins class="diff-new">service
</ins>
handlers
for
external
requests:
<ul>
<li>
to
retrieve
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
value;
</li>
<li>
to
update
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
value;
</li>
<li>
to
<del class="diff-old">run
</del>
<ins class="diff-chg">invoke
</ins>
an
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>:
take
the
parameters
from
the
request,
execute
the
defined
action,
and
return
the
result;
</li>
</ul>
</li>
</ul></section><del class="diff-old">3.
The
WoT
object
</del><section id="discovery"><h3 id="x2-3-discovery"><bdi class="secno">2.3 </bdi>
<ins class="diff-new">Discovery
</ins><a class="self-link" aria-label="§" href="#discovery"></a></h3><ul><li><ins class="diff-new">
Discover
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins>
</a>
<del class="diff-old">The
WoT
object
is
the
API
entry
point
and
it
is
exposed
</del>
<ins class="diff-chg">s
in
a
network
</ins>
by
<del class="diff-old">an
implementation
of
</del>
<ins class="diff-chg">sending
a
broadcast
request.
</ins></li><li><ins class="diff-chg">
Discover
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
running
in
</ins>
the
<ins class="diff-chg">local
</ins><a href="#dfn-wot-runtime" class="internalDFN" data-link-type="dfn">
WoT
Runtime
</a>.
<del class="diff-old">The
WoT
object
does
not
expose
properties,
only
methods
</del>
</li>
<li>
<ins class="diff-chg">Discover
nearby
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s,
</ins>
for
<del class="diff-old">discovering,
consuming
and
exposing
</del>
<ins class="diff-chg">instance
connected
by
NFC
or
Bluetooth.
</ins></li><li><ins class="diff-chg">
Discover
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
by
sending
</ins>
a
<ins class="diff-chg">discovery
request
to
a
given
registry.
</ins></li><li><ins class="diff-chg">
Discover
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-7">
Thing
<del class="diff-old">.
</del>
</a>
<ins class="diff-chg">s
filtered
by
filters
defined
on
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a><ins class="diff-chg">
s
</ins></li><li><ins class="diff-chg">
Discover
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
filtered
by
semantic
queries.
</ins></li><li><ins class="diff-chg">
Stop
or
suppress
an
ongoing
discovery
process.
</ins></li><li><ins class="diff-chg">
Optionally
specify
a
timeout
to
the
discovery
process
after
which
it
is
stopped/suppressed.
</ins></li></ul></section></section><section id="conformance"><h2 id="x3-conformance"><bdi class="secno">3. </bdi>Conformance<a class="self-link" aria-label="§" href="#conformance"></a></h2><p>
      As well as sections marked as non-normative, all authoring guidelines,
      diagrams, examples, and notes in this specification are non-normative.
      Everything else in this specification is normative.
    </p><p>
            The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">SHOULD</em>, and <em class="rfc2119">SHOULD NOT</em> in this document
            are to be interpreted as described in
            <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>
            [<cite><a class="bibref" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels" data-link-type="biblio">RFC2119</a></cite>]
            [<cite><a class="bibref" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words" data-link-type="biblio">RFC8174</a></cite>] when, and only when, they appear
            in all capitals, as shown here.
          </p><p><ins class="diff-chg">
This
specification
describes
the
conformance
criteria
for
the
following
classes
of
</ins><dfn data-dfn-type="dfn" id="dfn-user-agent"><ins class="diff-chg">
user
agent
</ins></dfn><ins class="diff-chg">
(
</ins><dfn data-dfn-type="dfn" id="dfn-ua"><ins class="diff-chg">
UA
</ins></dfn><ins class="diff-chg">
).
</ins>
</p><del class="diff-old">Note
Browser
implementations
<em class="rfc2119" title="SHOULD">SHOULD</em>
use
</del><p>
<ins class="diff-chg">Due
to
requirements
of
small
embedded
implementations,
splitting
WoT
client
and
server
interfaces
was
needed.
Then,
discovery
is
</ins>
a
<del class="diff-old">namespace
object
such
as
navigator.wot
.
Node.js
</del>
<ins class="diff-chg">distributed
application,
but
typical
scenarios
have
been
covered
by
a
generic
discovery
API
in
this
specification.
This
resulted
in
using
3
conformance
classes
for
a
</ins><a href="#dfn-ua" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
UA
</ins>
</a>
<del class="diff-old">-like
runtimes
<em class="rfc2119" title="MAY">MAY</em>
provide
the
</del>
<ins class="diff-chg">that
implements
this
API,
one
for
client,
one
for
server,
and
one
for
discovery.
An
application
that
uses
this
</ins>
API
<del class="diff-old">object
through
</del>
<ins class="diff-chg">can
introspect
for
the
presence
of
</ins>
the
<del class="diff-old">require()
or
import
mechanism.
// [SecureContext]
// [NamespaceObject]
</del></p><p>};
typedef
typedef
typedef
typedef
typedef
typedef
typedef
typedef
typedef
typedef
(

<code>
<del class="diff-old">ThingFragment
or
</del>
<ins class="diff-chg">consume()
</ins></code>,
<code>
<del class="diff-old">ThingDescription
</del>
<ins class="diff-chg">produce()
</ins>
</code>
<del class="diff-old">)
</del>
<ins class="diff-chg">and
</ins>
<code>
<del class="diff-old">ThingModel
</del>
<ins class="diff-chg">discover()
</ins>
</code>
<del class="diff-old">;
Editor's
note
The
algorithms
for
</del>
<ins class="diff-chg">methods
on
</ins>
the
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-8">
WoT
<del class="diff-old">methods
will
be
specified
later,
including
error
handling
and
security
considerations.
</del>
<ins class="diff-chg">API
object
</ins></a><ins class="diff-chg">
in
order
to
determine
which
conformance
class
the
</ins><a href="#dfn-ua" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
UA
</ins></a><ins class="diff-chg">
implements.
</ins>
</p><dl>
<dt>
<dfn data-dfn-type="dfn" id="dfn-wot-consumer">
<ins class="diff-chg">WoT
Consumer
</ins></dfn><a href="#dfn-ua" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
UA
</ins></a></dt><dd>
<p>
<del class="diff-old">The
</del>
<ins class="diff-chg">Implementations
of
this
conformance
class
<em class="rfc2119" title="MUST">MUST</em>
implement
the
</ins>
<code>
<del class="diff-old">ThingModel
</del>
<del class="diff-old">type
represents
either
a
</del>
<a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ConsumedThing
</ins></a>
<del class="diff-old">ThingFragment
</del>
</code>
<del class="diff-old">,
or
a
</del>
<ins class="diff-chg">interface
and
the
</ins>
<code>
<del class="diff-old">ThingDescription
</del>
<ins class="diff-chg">consume()
</ins>
</code>
<ins class="diff-chg">method
on
the
</ins><a href="#dfn-wot-api-object" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
API
object
</ins>
</a>.
</p>
<del class="diff-old">3.1
The
discover()
</del>
</dd>
<dt>
<dfn data-dfn-type="dfn" id="dfn-wot-producer">
<ins class="diff-chg">WoT
Producer
</ins>
</dfn>
<del class="diff-old">method
</del>
<a href="#dfn-ua" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">UA
</ins>
</a>
</dt>
<dd>
<p>
<del class="diff-old">Starts
the
discovery
process
that
will
provide
ThingDescription
s
that
match
the
optional
argument
filter
</del>
<ins class="diff-chg">Implementations
</ins>
of
<del class="diff-old">type
</del>
<ins class="diff-chg">this
conformance
class
<em class="rfc2119" title="MUST">MUST</em>
implement
</ins>
<code>
<del class="diff-old">ThingFilter
</del>
<a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">ExposedThing
</ins>
</a>
<del class="diff-old">.
Returns
an
[
Observable
</del>
</code>
<del class="diff-old">](https://github.com/tc39/proposal-observable)
object
that
can
be
subscribed
to
</del>
<ins class="diff-chg">interface
</ins>
and
<del class="diff-old">unsubscribed
from.
The
handler
function
provided
to
</del>
the
<del class="diff-old">Observable
during
subscription
will
receive
an
argument
of
type
</del>
<code>
<del class="diff-old">USVString
representing
a
ThingDescription
</del>
<ins class="diff-chg">produce()
</ins>
</code>
<ins class="diff-chg">method
on
the
</ins><a href="#dfn-wot-api-object" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
API
object
</ins>
</a>.
</p>
<del class="diff-old">3.1.1
The
DiscoveryMethod
</del>
</dd>
<dt>
<dfn data-dfn-type="dfn" id="dfn-wot-discovery">
<ins class="diff-chg">WoT
Discovery
</ins>
</dfn>
<del class="diff-old">enumeration
typedef
DOMString
</del>
<a href="#dfn-ua" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">UA
</ins>
</a>
</dt>
<dd>
<p>
<ins class="diff-chg">Implementations
of
this
conformance
class
<em class="rfc2119" title="MUST">MUST</em>
implement
the
</ins>
<code>
<del class="diff-old">DiscoveryMethod
</del>
<a href="#dfn-thingdiscovery" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">ThingDiscovery
</ins>
</a>
<del class="diff-old">;
</del>
</code>
<ins class="diff-chg">interface
and
the
</ins>
<code>
<del class="diff-old">DiscoveryMethod
</del>
<ins class="diff-chg">discover()
</ins>
</code>
<del class="diff-old">represents
</del>
<ins class="diff-chg">method
on
</ins>
the
<del class="diff-old">discovery
type
to
</del>
<a href="#dfn-wot-api-object" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
API
object
</ins></a>.</p></dd></dl><p><ins class="diff-chg">
These
conformance
classes
<em class="rfc2119" title="MAY">MAY</em>
</ins>
be
<del class="diff-old">used:
</del>
<ins class="diff-chg">implemented
in
a
single
</ins><a href="#dfn-ua" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
UA
</ins></a>.
</p><del class="diff-old">"any"
does
not
provide
any
restriction
"local"
</del><p>
<ins class="diff-chg">This
specification
can
be
used
</ins>
for
<del class="diff-old">discovering
Thing
</del>
<ins class="diff-chg">implementing
the
WoT
Scripting
API
in
multiple
programming
languages.
The
interface
definitions
are
specified
in
[<cite><a class="bibref" href="#bib-webidl" title="Web IDL" data-link-type="biblio">WEBIDL</a></cite>].
</ins></p><p><ins class="diff-chg">
The
</ins><a href="#dfn-ua" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
UA
</ins>
</a>
<del class="diff-old">s
defined
</del>
<ins class="diff-chg">may
be
implemented
</ins>
in
the
<del class="diff-old">same
device
</del>
<ins class="diff-chg">browser,
</ins>
or
<del class="diff-old">connected
</del>
<ins class="diff-chg">in
a
separate
runtime
environment,
such
as
</ins><a href="https://nodejs.org/en/"><ins class="diff-chg">
Node.js
</ins></a><ins class="diff-chg">
or
in
small
embedded
runtimes.
</ins></p><p><ins class="diff-chg">
Implementations
that
use
ECMAScript
executed
in
a
browser
</ins>
to
<ins class="diff-new">implement
</ins>
the
<del class="diff-old">device
by
wired
</del>
<ins class="diff-chg">APIs
defined
in
this
document
<em class="rfc2119" title="MUST">MUST</em>
implement
them
in
a
manner
consistent
with
the
ECMAScript
Bindings
defined
in
the
Web
IDL
specification
[<cite><a class="bibref" href="#bib-webidl" title="Web IDL" data-link-type="biblio">WEBIDL</a></cite>].
</ins></p><p><ins class="diff-chg">
Implementations
that
use
TypeScript
</ins>
or
<del class="diff-old">wireless
means.
"directory"
for
discovery
based
on
</del>
<ins class="diff-chg">ECMAScript
in
</ins>
a
<del class="diff-old">service
provided
by
</del>
<ins class="diff-chg">runtime
to
implement
the
APIs
defined
in
this
document
<em class="rfc2119" title="MUST">MUST</em>
implement
them
in
</ins>
a
<del class="diff-old">Thing
Directory
.
"multicast"
for
discovering
Thing
s
</del>
<ins class="diff-chg">manner
consistent
with
the
TypeScript
Bindings
defined
</ins>
in
the
<del class="diff-old">device's
network
by
using
a
supported
multicast
protocol.
</del>
<ins class="diff-chg">TypeScript
specification
[<cite><a class="bibref" href="#bib-typescript" title="TypeScript Language Specification" data-link-type="biblio">TYPESCRIPT</a></cite>].
</ins></p></section><del class="diff-old">3.1.2
</del><section id="the-thingfilter-thingdescription-dictionary-type"><h2 id="x4-the-thingfilter-thingdescription-dictionary-type"><bdi class="secno">4. </bdi>
The
<del class="diff-old">ThingFilter
</del>
<dfn data-dfn-type="dfn" id="dfn-thingdescription">
<ins class="diff-chg">ThingDescription
</ins>
</dfn>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">type
</ins><a class="self-link" aria-label="§" href="#the-thingfilter-thingdescription-dictionary-type"></a></h2><pre class="idl def"><span data-idl="" class="idlTypedef" id="idl-def-thingdescription" data-title="ThingDescription">typedef<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-object">object</a></span> <dfn data-export="" data-dfn-type="typedef" id="dom-thingdescription" data-idl="typedef" data-title="ThingDescription" class="idlID" data-dfn-for="ThingDescription"><code>ThingDescription</code></dfn>;</span></pre><p>
<del class="diff-old">The
ThingFilter
</del>
<ins class="diff-chg">Represents
a
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a><ins class="diff-chg">
(
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
)
as
defined
in
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>].
It
is
expected
to
be
a
</ins><a href="https://infra.spec.whatwg.org/#parse-json-from-bytes"><ins class="diff-chg">
parsed
JSON
object
</ins>
</a>
<del class="diff-old">dictionary
</del>
that
<del class="diff-old">represents
the
constraints
for
discovering
</del>
<ins class="diff-chg">is
validated
using
</ins><a href="https://w3c.github.io/wot-thing-description/#json-schema-4-validation"><ins class="diff-chg">
JSON
schema
validation
</ins></a>.</p><section id="fetching-a-thing-description"><h3 id="x4-1-fetching-a-thing-description"><bdi class="secno">4.1 </bdi><ins class="diff-chg">
Fetching
a
</ins>
Thing
<ins class="diff-new">Description
</ins><a class="self-link" aria-label="§" href="#fetching-a-thing-description"></a></h3><p><ins class="diff-new">
Fetching
a
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins>
</a>
<del class="diff-old">s
</del>
<ins class="diff-chg">given
a
URL
should
be
done
with
an
external
method,
such
</ins>
as
<del class="diff-old">key-value
pairs.
</del>
<ins class="diff-chg">the
</ins><a href="https://fetch.spec.whatwg.org/#fetch-api"><ins class="diff-chg">
Fetch
API
</ins></a><ins class="diff-chg">
or
a
HTTP
client
library,
which
offer
already
standardized
options
on
specifying
fetch
details.
</ins>
</p><del class="diff-old">
(



<p>};
</p>
<div class="example" id="example-1-fetching-a-thing-description">
          <div class="marker">
      <a class="self-link" href="#example-1-fetching-a-thing-description">Example<bdi> 1</bdi></a><span class="example-title">: Fetching a Thing Description</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'https://tds.mythings.biz/sensor11'</span>);
          <span class="hljs-comment">// ... additional checks possible on res.headers</span>
          <span class="hljs-keyword">let</span> td = <span class="hljs-keyword">await</span> res.json();
          <span class="hljs-keyword">let</span> thing = <span class="hljs-keyword">new</span> ConsumedThing(td);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Thing name: "</span> + thing.getThingDescription().title);
        } <span class="hljs-keyword">catch</span> (err) {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Fetching TD failed"</span>, err.message);
        }
</code></pre>
        </div>
</del></section><section id="expanding-a-thing-description"><h3 id="x4-2-expanding-a-thing-description"><bdi class="secno">4.2 </bdi>
<ins class="diff-chg">Expanding
a
Thing
Description
</ins><a class="self-link" aria-label="§" href="#expanding-a-thing-description"></a></h3><p>
<del class="diff-old">The
method
property
represents
the
discovery
type
</del>
<ins class="diff-chg">Note
</ins>
that
<del class="diff-old">should
be
used
in
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
allows
using
a
shortened
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a><ins class="diff-chg">
by
</ins>
the
<del class="diff-old">discovery
process.
The
possible
</del>
<ins class="diff-chg">means
of
</ins><a href="https://w3c.github.io/wot-thing-description/#sec-default-values"><ins class="diff-chg">
defaults
</ins></a><ins class="diff-chg">
and
requiring
clients
to
expand
them
with
default
</ins>
values
<ins class="diff-new">specified
in
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
for
the
properties
that
</ins>
are
<ins class="diff-new">not
explicitly
</ins>
defined
<del class="diff-old">by
</del>
<ins class="diff-chg">in
a
given
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a>.</p><div><ins class="diff-chg">
To
</ins><dfn data-dfn-type="dfn" id="dfn-expand-a-td"><ins class="diff-chg">
expand
a
TD
</ins></dfn><ins class="diff-chg">
given
</ins><var><ins class="diff-chg">
td
</ins></var>,<ins class="diff-chg">
run
</ins>
the
<del class="diff-old">DiscoveryMethod
enumeration
that
<em class="rfc2119" title="MAY">MAY</em>
be
extended
by
string
</del>
<ins class="diff-chg">following
steps:
</ins><ol><li><ins class="diff-chg">
For
each
item
in
the
</ins><a href="https://w3c.github.io/wot-thing-description/#sec-default-values"><ins class="diff-chg">
TD
default
</ins>
values
</a>
<ins class="diff-new">table
from
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>],
if
the
term
is
not
</ins>
defined
<del class="diff-old">by
solutions
(with
no
guarantee
of
interoperability).
</del>
<ins class="diff-chg">in
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
td
</ins></a>,<ins class="diff-chg">
add
the
term
definition
with
the
default
value
specified
in
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>].
</ins></li></ol></div></section><section id="validating-a-thing-description"><h3 id="x4-3-validating-a-thing-description"><bdi class="secno">4.3 </bdi><ins class="diff-chg">
Validating
a
Thing
Description
</ins><a class="self-link" aria-label="§" href="#validating-a-thing-description"></a></h3><p>
The
<del class="diff-old">url
property
represents
additional
information
for
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
specification
defines
how
a
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
should
be
validated.
Therefore,
this
API
expects
</ins>
the
<del class="diff-old">discovery
method,
such
</del>
<a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ThingDescription
</ins></a><ins class="diff-chg">
objects
be
validated
before
used
</ins>
as
<ins class="diff-new">parameters.
This
specification
defines
a
basic
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins></a><ins class="diff-new">
validation
as
follows.
</ins></p><div><ins class="diff-new">
To
</ins><dfn data-dfn-type="dfn" id="dfn-validate-a-td"><ins class="diff-new">
validate
a
TD
</ins></dfn><ins class="diff-new">
given
</ins><var><ins class="diff-new">
td
</ins></var>,<ins class="diff-new">
run
</ins>
the
<del class="diff-old">URL
</del>
<ins class="diff-chg">following
steps:
</ins><ol><li><ins class="diff-chg">
If
</ins><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
is
not
an
object,
throw
</ins><code><ins class="diff-chg">
"TypeError"
</ins></code><ins class="diff-chg">
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
If
any
</ins>
of
the
<del class="diff-old">target
entity
serving
the
discovery
request,
</del>
<ins class="diff-chg">mandatory
properties
defined
in
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
</ins>
for
<del class="diff-old">instance
a
</del>
<a href="https://w3c.github.io/wot-thing-description/#thing">
Thing
<del class="diff-old">Directory
</del>
</a>
<del class="diff-old">(if
</del>
<ins class="diff-chg">that
don't
have
</ins><a href="https://w3c.github.io/wot-thing-description/#sec-default-values"><ins class="diff-chg">
default
definitions
</ins></a><ins class="diff-chg">
are
missing
from
</ins><var><ins class="diff-chg">
td
</ins></var>,<ins class="diff-chg">
throw
</ins>
<code>
<del class="diff-old">method
</del>
<ins class="diff-chg">"TypeError"
</ins>
</code>
<del class="diff-old">is
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
If
</ins><a href="https://w3c.github.io/wot-thing-description/#json-schema-4-validation"><ins class="diff-chg">
JSON
schema
validation
</ins></a><ins class="diff-chg">
fails
on
</ins><var><ins class="diff-chg">
td
</ins></var>,<ins class="diff-chg">
throw
</ins>
<code>
<del class="diff-old">"directory"
</del>
<ins class="diff-chg">"TypeError"
</ins>
</code>
<del class="diff-old">)
or
a
Thing
(otherwise).
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li></ol></div></section></section><section data-dfn-for="WOT" id="the-query-wot-api-object-property-represents"><h2 id="x5-the-query-wot-api-object-property-represents"><bdi class="secno">5. </bdi>
The
<del class="diff-old">query
</del>
<dfn data-dfn-type="dfn" id="dfn-wot-api-object">
<ins class="diff-chg">WoT
API
object
</ins>
</dfn>
<del class="diff-old">property
represents
</del>
<a class="self-link" aria-label="§" href="#the-query-wot-api-object-property-represents"></a></h2><p>
<ins class="diff-chg">Defines
the
API
entry
point
exposed
as
</ins>
a
<del class="diff-old">query
string
accepted
by
</del>
<ins class="diff-chg">singleton
and
contains
</ins>
the
<del class="diff-old">implementation,
for
instance
</del>
<ins class="diff-chg">API
methods.
</ins></p><section id="the-wot-interface"><h3 id="x5-1-the-wot-interface"><bdi class="secno">5.1 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="dfn" id="dom-wot" data-idl="interface" data-title="
WOT
"><code><ins class="diff-chg">
WOT
</ins></code></dfn><ins class="diff-chg">
interface
</ins><a class="self-link" aria-label="§" href="#the-wot-interface"></a></h3><pre class="idl def"><span data-idl="" class="idlInterface" id="idl-def-wot" data-title="WOT">      [<span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface" data-cite-path="window-object.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface" data-lt="WorkerGlobalScope" data-cite-path="workers.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
      interface <dfn data-export="" data-dfn-type="interface" id="dom-wot" data-idl="interface" data-title="WOT" class="idlID" data-dfn-for="WOT"><code>WOT</code></dfn> {<span class="idlSectionComment">
        // methods defined in UA conformance classes
      </span>};</span></pre><div class="note" role="note" id="issue-container-generatedID-3"><div role="heading" class="note-title marker" id="h-note-1" aria-level="4"><span>Note</span></div><p class=""><ins class="diff-chg">
Browser
implementations
should
use
</ins>
a
<del class="diff-old">SPARQL
or
JSON
query.
Support
</del>
<ins class="diff-chg">namespace
object
such
as
</ins><code><ins class="diff-chg">
navigator.wot
</ins></code>.<ins class="diff-chg">
Standalone
runtimes
</ins>
may
<del class="diff-old">be
implemented
locally
in
</del>
<ins class="diff-chg">expose
</ins>
the
<del class="diff-old">WoT
Runtime
</del>
<ins class="diff-chg">API
object
through
mechanisms
like
</ins><a href="https://nodejs.org/api/modules.html"><ins class="diff-chg">
require()
</ins>
</a>
or
<del class="diff-old">remotely
as
a
service
in
a
Thing
Directory
</del>
<a href="http://www.ecma-international.org/ecma-262/6.0/#sec-imports">
<ins class="diff-chg">import
</ins>
</a>.
</p></div></section><section id="the-fragment-consume-property-represents-method"><h3 id="x5-2-the-fragment-consume-property-represents-method"><bdi class="secno">5.2 </bdi>
The
<del class="diff-old">fragment
</del>
<dfn data-dfn-type="method" data-export="" id="dom-wot-consume" data-idl="operation" data-title="
consume()

" data-dfn-for="WOT" data-type="Promise" data-lt="WOT.consume()|WOT.consume|consume()|consume"><code>
<ins class="diff-chg">consume()
</ins>
</code></dfn>
<del class="diff-old">property
represents
</del>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href="#the-fragment-consume-property-represents-method"></a></h3><pre class="idl def"><span data-idl="" class="idlInterface" id="idl-def-wot-partial-1" data-title="WOT">      partial interface <a class="internalDFN idlID" data-link-for="" data-link-type="interface" href="#dom-wot"><code>WOT</code></a> {<span data-idl="" class="idlMethod" id="idl-def-wot-consume-td" data-title="consume" data-dfn-for="WOT"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn">ConsumedThing</a>&gt;</span> <a class="internalDFN idlName" data-link-for="WOT" data-link-type="method" href="#dom-wot-consume"><code>consume</code></a>(<span class="idlType"><a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a></span> <span class="idlParamName">td</span>);</span>
      };</span></pre><div><ins class="diff-chg">
Belongs
to
the
</ins><a href="#dfn-wot-consumer" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
Consumer
</ins></a><ins class="diff-chg">
conformance
class.
Expects
an
</ins><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
argument
and
returns
</ins>
a
<del class="diff-old">ThingFragment
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-9">
<ins class="diff-chg">Promise
</ins>
</a>
<del class="diff-old">dictionary
used
for
matching
property
by
property
against
discovered
Thing
</del>
<ins class="diff-chg">that
resolves
with
a
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins>
</a>
<del class="diff-old">s.
</del>
<ins class="diff-chg">object
that
represents
a
client
interface
to
operate
with
the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a>.
The
<del class="diff-old">discover(filter)
</del>
method
<em class="rfc2119" title="MUST">MUST</em>
run
the
following
steps:
<ol>
<li>
<ins class="diff-new">Return
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-10"><ins class="diff-new">
Promise
</ins></a><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
and
execute
the
next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-new">
in
parallel
</ins></a>.</li><li>
If
invoking
<del class="diff-old">discover()
</del>
<ins class="diff-chg">this
method
</ins>
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
<del class="diff-old">throw
</del>
<ins class="diff-chg">reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
SecurityError
</code>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Return
an
Observable
</del>
<ins class="diff-chg">Run
the
</ins><a href="#dfn-validate-a-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
validate
a
TD
</ins>
</a>
<ins class="diff-chg">steps
on
</ins>
<var>
<del class="diff-old">obs
</del>
<ins class="diff-chg">td
</ins></var>.<ins class="diff-chg">
If
that
throws,
reject
</ins><var><ins class="diff-chg">
promise
</ins>
</var>
<ins class="diff-new">with
the
error
</ins>
and
<del class="diff-old">execute
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Let
</ins><var><ins class="diff-chg">
thing
</ins></var><ins class="diff-chg">
be
a
new
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins></a><ins class="diff-chg">
object
constructed
from
</ins><var><ins class="diff-chg">
td
</ins></var>.</li><li><ins class="diff-chg">
Set
up
</ins>
the
<del class="diff-old">next
steps
</del>
<a href="#dfn-wot-interactions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
Interactions
</ins></a><ins class="diff-chg">
based
on
introspecting
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
td
</ins></a><ins class="diff-chg">
as
explained
</ins>
in
<del class="diff-old">parallel
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
and
[<cite><a class="bibref" href="#bib-wot-protocol-bindings" title="Web of Things Protocol Binding Templates" data-link-type="biblio">WOT-PROTOCOL-BINDINGS</a></cite>].
Make
a
request
to
the
underlying
platform
to
initialize
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>.
<ins class="diff-new">The
details
are
private
to
the
implementations
and
out
of
scope
of
this
specification.
</ins>
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Resolve
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins><var><ins class="diff-chg">
thing
</ins></var>.</li></ol></div></section><section id="the-produce-method"><h3 id="x5-3-the-produce-method"><bdi class="secno">5.3 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-wot-produce" data-idl="operation" data-title="
produce()
" data-dfn-for="WOT" data-type="Promise" data-lt="WOT.produce()|WOT.produce|produce()|produce"><code><ins class="diff-chg">
produce()
</ins></code></dfn><ins class="diff-chg">
method
</ins><a class="self-link" aria-label="§" href="#the-produce-method"></a></h3><pre class="idl def"><span data-idl="" class="idlInterface" id="idl-def-wot-partial-2" data-title="WOT">      partial interface <a class="internalDFN idlID" data-link-for="" data-link-type="interface" href="#dom-wot"><code>WOT</code></a> {<span data-idl="" class="idlMethod" id="idl-def-wot-produce-td" data-title="produce" data-dfn-for="WOT"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">ExposedThing</a>&gt;</span> <a class="internalDFN idlName" data-link-for="WOT" data-link-type="method" href="#dom-wot-produce"><code>produce</code></a>(<span class="idlType"><a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a></span> <span class="idlParamName">td</span>);</span>
      };</span></pre><div><ins class="diff-chg">
Belongs
to
the
</ins><a href="#dfn-wot-producer" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
Producer
</ins></a><ins class="diff-chg">
conformance
class.
Expects
a
</ins>
<code>
<del class="diff-old">obs.subscribe(handler,
errorHandler,
complete)
</del>
<ins class="diff-chg">td
</ins>
</code>
<del class="diff-old">is
called,
execute
</del>
<ins class="diff-chg">argument
and
returns
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-12"><ins class="diff-chg">
Promise
</ins></a><ins class="diff-chg">
that
resolves
with
an
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ExposedThing
</ins></a><ins class="diff-chg">
object
that
extends
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins></a><ins class="diff-chg">
with
a
server
interface,
i.e.
the
ability
to
define
request
handlers.
The
method
<em class="rfc2119" title="MUST">MUST</em>
run
</ins>
the
following
<del class="diff-old">sub-steps:
</del>
<ins class="diff-chg">steps:
</ins>
<ol>
<li>
<del class="diff-old">If
the
first
argument
</del>
<ins class="diff-chg">Return
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-13"><ins class="diff-chg">
Promise
</ins></a>
<var>
<del class="diff-old">handler
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">is
not
defined
or
it
is
not
a
function,
throw
TypeError
</del>
and
<del class="diff-old">terminate
</del>
<ins class="diff-chg">execute
</ins>
the
<del class="diff-old">algorithm.
Otherwise
configure
handler
to
be
invoked
when
a
discovery
hit
happens.
</del>
<ins class="diff-chg">next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.
</li>
<li>
If
<del class="diff-old">the
second
argument
errorHandler
is
defined,
but
it
</del>
<ins class="diff-chg">invoking
this
method
</ins>
is
not
<del class="diff-old">a
function,
throw
</del>
<ins class="diff-chg">allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-14"><ins class="diff-chg">
promise
</ins></a><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
and
terminate
these
steps.
<del class="diff-old">Otherwise
if
defined,
save
it
to
</del>
</li>
<li>
<ins class="diff-chg">Let
</ins><var><ins class="diff-chg">
thing
</ins></var>
be
<del class="diff-old">invoked
in
error
conditions.
</del>
<ins class="diff-chg">a
new
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ExposedThing
</ins></a><ins class="diff-chg">
object
constructed
with
</ins><var><ins class="diff-chg">
td
</ins></var>.
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Resolve
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins><var><ins class="diff-chg">
thing
</ins></var>.</li></ol></div></section><section id="the-discover-method"><h3 id="x5-4-the-discover-method"><bdi class="secno">5.4 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-wot-discover" data-idl="operation" data-title="
discover()
" data-dfn-for="WOT" data-type="ThingDiscovery" data-lt="WOT.discover()|WOT.discover|discover()|discover"><code><ins class="diff-chg">
discover()
</ins></code></dfn><ins class="diff-chg">
method
</ins><a class="self-link" aria-label="§" href="#the-discover-method"></a></h3><pre class="idl def"><span data-idl="" class="idlInterface" id="idl-def-wot-partial-3" data-title="WOT">      partial interface <a class="internalDFN idlID" data-link-for="" data-link-type="interface" href="#dom-wot"><code>WOT</code></a> {<span data-idl="" class="idlMethod" id="idl-def-wot-discover-filter" data-title="discover" data-dfn-for="WOT"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-thingdiscovery" class="internalDFN" data-link-type="dfn">ThingDiscovery</a></span> <a class="internalDFN idlName" data-link-for="WOT" data-link-type="method" href="#dom-wot-discover"><code>discover</code></a>(optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-thingfilter" class="internalDFN" data-link-type="dfn">ThingFilter</a></span> <span class="idlParamName">filter</span> = null);</span>
      };</span></pre><div><ins class="diff-chg">
Belongs
to
</ins>
the
<del class="diff-old">third
argument
</del>
<a href="#dfn-wot-discovery" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
Discovery
</ins></a><ins class="diff-chg">
conformance
class.
Starts
the
discovery
process
that
will
provide
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins></a><ins class="diff-chg">
objects
for
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a><ins class="diff-chg">
s
that
match
an
optional
</ins>
<var>
<del class="diff-old">onComplete
</del>
<ins class="diff-chg">filter
</ins>
</var>
<del class="diff-old">is
defined,
but
it
</del>
<ins class="diff-chg">argument.
The
method
<em class="rfc2119" title="MUST">MUST</em>
run
the
following
steps:
</ins><ol><li><ins class="diff-chg">
If
invoking
this
method
</ins>
is
not
<del class="diff-old">a
function,
</del>
<ins class="diff-chg">allowed
for
the
current
scripting
context
for
security
reasons,
</ins>
throw
<code>
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
and
terminate
these
steps.
<del class="diff-old">Otherwise
if
defined,
save
it
to
be
invoked
when
the
discovery
process
finished
for
other
reasons
than
having
been
canceled.
</del>
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Construct
a
</ins><a href="#dfn-thingdiscovery" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDiscovery
</ins></a><ins class="diff-chg">
object
</ins>
<var>
<del class="diff-old">filter.query
</del>
<ins class="diff-chg">discovery
</ins>
</var>
<del class="diff-old">is
defined,
pass
it
as
an
opaque
string
to
</del>
<ins class="diff-chg">with
</ins><var><ins class="diff-chg">
filter
</ins></var>.</li><li><ins class="diff-chg">
Invoke
</ins>
the
<del class="diff-old">underlying
implementation
</del>
<a href="#the-start-method">
<ins class="diff-chg">discovery.start()
</ins></a><ins class="diff-chg">
method.
</ins></li><li><ins class="diff-chg">
Return
</ins><var><ins class="diff-chg">
discovery
</ins></var>.</li></ol></div><p><ins class="diff-chg">
Refer
</ins>
to
<ins class="diff-new">the
</ins><a href="#dfn-thingdiscovery" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
ThingDiscovery
</ins></a><ins class="diff-new">
section
for
how
discovery
should
</ins>
be
<del class="diff-old">matched
against
discovered
items.
</del>
<ins class="diff-chg">implemented.
</ins></p></section></section><section data-dfn-for="ConsumedThing" id="the-underlying-implementation-is-responsible-consumedthing-interface"><h2 id="x6-the-underlying-implementation-is-responsible-consumedthing-interface"><bdi class="secno">6. </bdi>
The
<del class="diff-old">underlying
implementation
is
responsible
</del>
<dfn data-dfn-type="dfn" id="dfn-consumedthing">
<ins class="diff-chg">ConsumedThing
</ins></dfn><ins class="diff-chg">
interface
</ins><a class="self-link" aria-label="§" href="#the-underlying-implementation-is-responsible-consumedthing-interface"></a></h2><p><ins class="diff-chg">
Represents
a
client
API
</ins>
to
<del class="diff-old">parse
it
e.g.
as
</del>
<ins class="diff-chg">operate
</ins>
a
<del class="diff-old">SPARQL
or
JSON
query
and
match
it
against
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins></a>.<ins class="diff-chg">
Belongs
to
</ins>
the
<a href="#dfn-wot-consumer" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
Consumer
</ins></a><ins class="diff-chg">
conformance
class.
</ins></p><pre class="idl def"><span data-idl="" class="idlInterface" id="idl-def-consumedthing" data-title="ConsumedThing">      [<span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface" data-cite-path="window-object.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface" data-lt="WorkerGlobalScope" data-cite-path="workers.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
      interface <dfn data-export="" data-dfn-type="interface" id="dom-consumedthing" data-idl="interface" data-title="ConsumedThing" class="idlID" data-dfn-for="ConsumedThing"><code>ConsumedThing</code></dfn> {<span data-idl="" class="idlConstructor" id="idl-def-consumedthing-constructor-td" data-title="constructor" data-dfn-for="ConsumedThing">
        <dfn data-export="" data-dfn-type="constructor" id="dom-consumedthing-constructor" data-idl="constructor" data-title="constructor" data-dfn-for="ConsumedThing" data-lt="ConsumedThing.constructor()|ConsumedThing.constructor|constructor()|constructor"><code>constructor</code></dfn>(<span class="idlType"><a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a></span> <span class="idlParamName">td</span>);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-readproperty-propertyname-options" data-title="readProperty" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-readproperty"><code>readProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">propertyName</span>,
                                  optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-readallproperties-options" data-title="readAllProperties" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-propertymap" class="internalDFN" data-link-type="dfn">PropertyMap</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-readallproperties"><code>readAllProperties</code></a>(optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-readmultipleproperties-propertynames-options" data-title="readMultipleProperties" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-propertymap" class="internalDFN" data-link-type="dfn">PropertyMap</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-readmultipleproperties"><code>readMultipleProperties</code></a>(<span class="idlType">
                                  <a data-xref-type="dfn" data-cite-path="" data-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence">sequence</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>&gt;</span> <span class="idlParamName">propertyNames</span>,
                                  optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-writeproperty-propertyname-value-options" data-title="writeProperty" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-writeproperty"><code>writeProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">propertyName</span>,<span class="idlType">
                                    <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">value</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-writemultipleproperties-valuemap-options" data-title="writeMultipleProperties" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-writemultipleproperties"><code>writeMultipleProperties</code></a>(<span class="idlType"><a data-xref-type="_IDL_" href="#dfn-propertymap" class="internalDFN" data-link-type="dfn">PropertyMap</a></span> <span class="idlParamName">valueMap</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-invokeaction-actionname-params-options" data-title="invokeAction" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-invokeaction"><code>invokeAction</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">actionName</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">params</span> = null,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-observeproperty-name-listener-options" data-title="observeProperty" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-observeproperty"><code>observeProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType">
                                    <a data-xref-type="_IDL_" href="#dfn-wotlistener" class="internalDFN" data-link-type="dfn">WotListener</a></span> <span class="idlParamName">listener</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-unobserveproperty-name" data-title="unobserveProperty" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-unobserveproperty"><code>unobserveProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-subscribeevent-name-listener-options" data-title="subscribeEvent" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-subscribeevent"><code>subscribeEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType">
                                    <a data-xref-type="_IDL_" href="#dfn-wotlistener" class="internalDFN" data-link-type="dfn">WotListener</a></span> <span class="idlParamName">listener</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-unsubscribeevent-name" data-title="unsubscribeEvent" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-unsubscribeevent"><code>unsubscribeEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>);</span><span data-idl="" class="idlMethod" id="idl-def-consumedthing-getthingdescription" data-title="getThingDescription" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a></span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-getthingdescription"><code>getThingDescription</code></a>();</span>
      };</span><span data-idl="" class="idlDictionary" id="idl-def-interactionoptions" data-title="InteractionOptions">
      dictionary <dfn data-export="" data-dfn-type="dictionary" id="dom-interactionoptions" data-idl="dictionary" data-title="InteractionOptions" class="idlID" data-dfn-for="InteractionOptions"><code>InteractionOptions</code></dfn> {<span data-idl="" class="idlMember" id="idl-def-interactionoptions-urivariables" data-title="uriVariables" data-dfn-for="InteractionOptions"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-object">object</a></span> <dfn data-export="" data-dfn-type="dict-member" id="dom-interactionoptions-urivariables" data-idl="field" data-title="uriVariables" data-dfn-for="InteractionOptions" data-type="object" class="idlName"><code>uriVariables</code></dfn>;</span>
      };</span><span data-idl="" class="idlTypedef" id="idl-def-propertymap" data-title="PropertyMap">
      typedef<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-object">object</a></span> <dfn data-export="" data-dfn-type="typedef" id="dom-propertymap" data-idl="typedef" data-title="PropertyMap" class="idlID" data-dfn-for="PropertyMap"><code>PropertyMap</code></dfn>;</span><span data-idl="" class="idlCallback" id="idl-def-wotlistener" data-title="WotListener">
      callback <dfn data-export="" data-dfn-type="callback" id="dom-wotlistener" data-idl="callback" data-title="WotListener" class="idlID" data-dfn-for="WotListener"><code>WotListener</code></dfn> =<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">data</span>);</span></pre><section id="constructing-consumedthing"><h3 id="x6-1-constructing-consumedthing"><bdi class="secno">6.1 </bdi><ins class="diff-chg">
Constructing
</ins><code><ins class="diff-chg">
ConsumedThing
</ins></code><a class="self-link" aria-label="§" href="#constructing-consumedthing"></a></h3><p><ins class="diff-chg">
After
</ins><a href="#fetching-a-thing-description"><ins class="diff-chg">
fetching
</ins></a><ins class="diff-chg">
a
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
Thing
Description
</a>
<del class="diff-old">s
found
during
</del>
<ins class="diff-chg">as
a
JSON
object,
one
can
create
a
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins></a><ins class="diff-chg">
object.
</ins></p><div><ins class="diff-chg">
To
create
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins></a><ins class="diff-chg">
with
</ins>
the
<del class="diff-old">discovery
process.
If
queries
are
not
supported,
implementations
<em class="rfc2119" title="SHOULD">SHOULD</em>
throw
</del>
<a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ThingDescription
</ins></a><var><ins class="diff-chg">
td
</ins></var>,<ins class="diff-chg">
run
the
following
steps:
</ins><ol><li><ins class="diff-chg">
Run
the
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-32"><ins class="diff-chg">
expand
</ins>
a
<del class="diff-old">NotSupported
</del>
<ins class="diff-chg">TD
</ins></a><ins class="diff-chg">
steps
on
</ins><var><ins class="diff-chg">
td
</ins></var>.<ins class="diff-chg">
If
that
fails,
re-throw
the
</ins>
error
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Let
</ins>
<var>
<del class="diff-old">filter.fragment
</del>
<ins class="diff-chg">thing
</ins></var><ins class="diff-chg">
be
a
new
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins></a><ins class="diff-chg">
object.
</ins></li><li><ins class="diff-chg">
Let
|<var>td</var>|
be
an
internal
slot
of
</ins><var><ins class="diff-chg">
thing
</ins>
</var>
<del class="diff-old">is
defined,
</del>
and
<del class="diff-old">if
it
contains
other
properties
than
</del>
<ins class="diff-chg">let
</ins><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
be
its
value.
</ins></li><li><ins class="diff-chg">
Return
</ins><var><ins class="diff-chg">
thing
</ins></var>.</li></ol></div></section><section id="the-getthingdescription-method"><h3 id="x6-2-the-getthingdescription-method"><bdi class="secno">6.2 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-consumedthing-getthingdescription" data-idl="operation" data-title="
getThingDescription()
" data-dfn-for="ConsumedThing" data-type="ThingDescription" data-lt="ConsumedThing.getThingDescription()|ConsumedThing.getThingDescription|getThingDescription()|getThingDescription"><code><ins class="diff-chg">
getThingDescription()
</ins></code></dfn><ins class="diff-chg">
method
</ins><a class="self-link" aria-label="§" href="#the-getthingdescription-method"></a></h3><p><ins class="diff-chg">
Returns
</ins>
the
<del class="diff-old">ones
defined
in
ThingFragment
,
throw
TypeError
and
terminate
these
steps.
Otherwise
save
</del>
<ins class="diff-chg">internal
slot
|<var>td</var>|
of
</ins>
the
<a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">ConsumedThing
</ins></a>
object
<del class="diff-old">for
matching
</del>
<ins class="diff-chg">that
represents
</ins>
the
<del class="diff-old">discovered
items
against
</del>
<a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
Description
</ins></a><ins class="diff-chg">
of
the
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins></a>.<ins class="diff-chg">
Applications
may
consult
the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
metadata
stored
in
|<var>td</var>|
in
order
to
introspect
its
capabilities
before
interacting
with
</ins>
it.
<del class="diff-old">Request
</del>
</p></section><section id="the-interactionoptions-dictionary"><h3 id="x6-3-the-interactionoptions-dictionary"><bdi class="secno">6.3 </bdi>
<ins class="diff-chg">The
</ins><dfn data-dfn-type="dfn" id="dfn-interactionoptions"><ins class="diff-chg">
InteractionOptions
</ins></dfn><ins class="diff-chg">
dictionary
</ins><a class="self-link" aria-label="§" href="#the-interactionoptions-dictionary"></a></h3><p><ins class="diff-chg">
Holds
</ins>
the
<del class="diff-old">underlying
platform
</del>
<ins class="diff-chg">interaction
options
that
need
to
be
exposed
for
application
scripts
according
</ins>
to
<del class="diff-old">start
</del>
the
<del class="diff-old">discovery
process,
with
</del>
<a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
Description
</ins></a>.<ins class="diff-chg">
In
this
version
of
</ins>
the
<del class="diff-old">following
parameters:
If
filter.method
is
not
</del>
<ins class="diff-chg">specification
only
URI
template
variables
are
used,
represented
as
</ins><a href="https://infra.spec.whatwg.org/#parse-json-from-bytes"><ins class="diff-chg">
parsed
JSON
objects
</ins></a>
defined
<del class="diff-old">or
the
value
is
"any"
,
use
</del>
<ins class="diff-chg">in
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>].
</ins></p><div class="note" id="issue-container-generatedID-4"><div role="heading" class="ednote-title marker" id="h-ednote-1" aria-level="4"><span>Editor's note</span></div><p class=""><ins class="diff-chg">
The
support
for
URI
variables
comes
from
</ins>
the
<del class="diff-old">widest
discovery
method
supported
</del>
<ins class="diff-chg">need
exposed
</ins>
by
<del class="diff-old">the
underlying
platform.
Otherwise
if
filter.method
is
"local"
,
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
to
be
able
to
describe
existing
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
s
that
</ins>
use
<del class="diff-old">the
local
</del>
<ins class="diff-chg">them,
but
it
should
be
possible
to
write
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-33">
Thing
<del class="diff-old">Directory
</del>
<ins class="diff-chg">Description
</ins>
</a>
<del class="diff-old">for
discovery.
Usually
</del>
that
<del class="diff-old">defines
Thing
</del>
<ins class="diff-chg">would
use
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins>
</a>
s
<del class="diff-old">deployed
in
</del>
<ins class="diff-chg">for
representing
</ins>
the
<del class="diff-old">same
device,
or
connected
to
</del>
<ins class="diff-chg">interactions
that
need
URI
variables
and
represent
</ins>
the
<del class="diff-old">device
in
slave
mode
(e.g.
sensors
connected
via
Bluetooth
or
a
serial
connection).
Otherwise
if
filter.method
is
"directory"
,
use
</del>
<ins class="diff-chg">URI
variables
as
parameters
to
</ins>
the
<del class="diff-old">remote
Thing
Directory
</del>
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Action
</ins>
</a>
<del class="diff-old">specified
</del>
<ins class="diff-chg">and
</ins>
in
<ins class="diff-new">that
case
that
could
be
encapsulated
by
the
implementations
and
the
</ins>
<var>
<del class="diff-old">filter.url
.
Otherwise
if
filter.method
</del>
<ins class="diff-chg">options
</ins>
</var>
<del class="diff-old">is
"multicast"
,
use
all
</del>
<ins class="diff-chg">parameter
could
be
dismissed
from
</ins>
the
<del class="diff-old">multicast
discovery
protocols
supported
</del>
<ins class="diff-chg">methods
exposed
</ins>
by
<ins class="diff-new">this
API.
</ins></p></div></section><section id="the-propertymap-type"><h3 id="x6-4-the-propertymap-type"><bdi class="secno">6.4 </bdi><ins class="diff-new">
The
</ins><dfn data-dfn-type="dfn" id="dfn-propertymap"><ins class="diff-new">
PropertyMap
</ins></dfn><ins class="diff-new">
type
</ins><a class="self-link" aria-label="§" href="#the-propertymap-type"></a></h3><p><ins class="diff-new">
Represents
a
map
of
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
names
as
strings
to
a
value
that
</ins>
the
<del class="diff-old">underlying
platform.
Whenever
</del>
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Property
</ins></a><ins class="diff-chg">
can
take.
It
is
used
as
</ins>
a
<del class="diff-old">new
item
</del>
<ins class="diff-chg">property
bag
for
interactions
that
involve
multiple
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Properties
</ins></a><ins class="diff-chg">
at
once.
</ins></p><div class="note" id="issue-container-generatedID-5"><div role="heading" class="ednote-title marker" id="h-ednote-2" aria-level="4"><span>Editor's note</span></div><p class=""><ins class="diff-chg">
It
could
be
defined
in
Web
IDL
(as
well
as
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins></a><ins class="diff-chg">
)
as
a
</ins><a href="https://heycam.github.io/webidl/#idl-maplike"><ins class="diff-chg">
maplike
</ins></a><ins class="diff-chg">
interface
from
</ins><i><ins class="diff-chg">
string
</ins></i><ins class="diff-chg">
to
</ins><i><ins class="diff-chg">
any
</ins></i>.</p></div></section><section id="the-readproperty-method"><h3 id="x6-5-the-readproperty-method"><bdi class="secno">6.5 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-consumedthing-readproperty" data-idl="operation" data-title="
readProperty()
" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.readProperty()|ConsumedThing.readProperty|readProperty()|readProperty"><code><ins class="diff-chg">
readProperty()
</ins></code></dfn><ins class="diff-chg">
method
</ins><a class="self-link" aria-label="§" href="#the-readproperty-method"></a></h3><div><ins class="diff-chg">
Reads
a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
value.
Takes
a
string
argument
</ins>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">propertyName
</ins>
</var>
<del class="diff-old">is
discovered
by
the
underlying
platform,
</del>
<ins class="diff-chg">and
and
an
optional
</ins><a href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
InteractionOptions
</ins></a><var><ins class="diff-chg">
options
</ins></var><ins class="diff-chg">
argument.
It
returns
a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
value
represented
as
</ins><code><ins class="diff-chg">
any
</ins></code><ins class="diff-chg">
type.
The
method
<em class="rfc2119" title="MUST">MUST</em>
</ins>
run
the
following
<del class="diff-old">sub-steps:
</del>
<ins class="diff-chg">steps:
</ins>
<ol>
<li>
<del class="diff-old">If
filter.query
is
defined,
check
if
td
is
</del>
<ins class="diff-chg">Return
</ins>
a
<del class="diff-old">match
for
the
query.
The
matching
algorithm
is
encapsulated
by
implementations.
If
that
returns
false
,
discard
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-15">
<ins class="diff-chg">Promise
</ins></a>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">promise
</ins>
</var>
and
<del class="diff-old">continue
</del>
<ins class="diff-chg">execute
</ins>
the
<del class="diff-old">discovery
process.
</del>
<ins class="diff-chg">next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.
</li>
<li>
If
<del class="diff-old">filter.fragment
</del>
<ins class="diff-chg">invoking
this
method
</ins>
is
<del class="diff-old">defined,
</del>
<ins class="diff-chg">not
allowed
</ins>
for
<del class="diff-old">each
property
defined
in
it,
check
if
that
property
exists
in
</del>
<ins class="diff-chg">the
current
scripting
context
for
security
reasons,
reject
</ins>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">and
has
the
same
value.
If
this
is
</del>
<ins class="diff-chg">with
</ins>
<code>
<del class="diff-old">false
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">in
any
checks,
discard
td
</del>
and
<del class="diff-old">continue
the
discovery
process.
</del>
<ins class="diff-chg">terminate
these
steps.
</ins>
</li>
<li>
<del class="diff-old">Otherwise
if
td
has
not
been
discarded
in
</del>
<ins class="diff-chg">Make
a
request
to
</ins>
the
<del class="diff-old">previous
steps,
invoke
</del>
<ins class="diff-chg">underlying
platform
(via
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
)
to
retrieve
the
value
of
</ins>
the
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">Property
</ins></a><ins class="diff-new">
given
by
</ins>
<var>
<del class="diff-old">handler
</del>
<ins class="diff-chg">propertyName
</ins>
</var>
<del class="diff-old">function
</del>
with
<ins class="diff-new">optional
URI
templates
given
in
</ins>
<var>
<del class="diff-old">td
as
parameter.
</del>
<ins class="diff-chg">options.uriVariables
</ins></var>.
</li>
<li>
<del class="diff-old">Whenever
an
error
occurs
during
</del>
<ins class="diff-chg">If
</ins>
the
<del class="diff-old">discovery
process,
and
if
</del>
<ins class="diff-chg">request
fails,
reject
</ins>
<var>
<del class="diff-old">errorHandler
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">is
defined,
invoke
it
</del>
with
<del class="diff-old">an
argument
of
type
Error
whose
message
property
is
set
to
UnknownError
unless
there
was
an
</del>
<ins class="diff-chg">the
</ins>
error
<del class="diff-old">code
provided
by
</del>
<ins class="diff-chg">received
from
</ins>
the
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-34">
Protocol
Bindings
<del class="diff-old">,
in
which
case
set
it
to
that
value.
</del>
</a>
<ins class="diff-chg">and
terminate
these
steps.
</ins>
</li>
<li>
<del class="diff-old">When
the
discovery
process
is
finished,
and
if
</del>
<ins class="diff-chg">Let
</ins>
<var>
<del class="diff-old">onComplete
</del>
<ins class="diff-chg">value
</ins>
</var>
<del class="diff-old">is
defined,
invoke
it
run
</del>
<ins class="diff-chg">be
</ins>
the
<del class="diff-old">cancel
discovery
steps.
</del>
<ins class="diff-chg">result
of
the
request.
</ins>
</li>
<li>
<del class="diff-old">When
the
obs.unsubscribe()
method
is
called,
run
</del>
<ins class="diff-chg">Run
</ins>
the
<del class="diff-old">following
cancel
discovery
</del>
<dfn data-dfn-type="dfn" id="dfn-validate-property-value">
<ins class="diff-chg">validate
Property
value
</ins>
</dfn>
<del class="diff-old">steps:
</del>
<ins class="diff-chg">sub-steps
on
</ins><var><ins class="diff-chg">
value
</ins></var>:
<ol>
<li>
<del class="diff-old">Request
</del>
<ins class="diff-chg">Based
on
</ins>
the
<del class="diff-old">underlying
platform
</del>
<a href="https://w3c.github.io/wot-thing-description/#dataschema">
<ins class="diff-chg">DataSchema
definition
</ins></a>,<var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
<em class="rfc2119" title="MUST">MUST</em>
be
a
JSON
value
and
comply
</ins>
to
<del class="diff-old">stop
</del>
the
<del class="diff-old">discovery
process.
If
this
returns
an
error,
or
if
it
is
not
possible,
</del>
<ins class="diff-chg">data
schema
defined
</ins>
for
<del class="diff-old">instance
when
discovery
is
based
on
open
ended
multicast
requests,
</del>
the
<del class="diff-old">implementation
<em class="rfc2119" title="SHOULD">SHOULD</em>
discard
subsequent
discovered
items.
Set
</del>
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Property
</ins></a><ins class="diff-chg">
that
is
found
in
</ins><code><ins class="diff-chg">
this.getThingDescription().properties[
</ins></code>
<var>
<del class="diff-old">obs.closed
</del>
<ins class="diff-chg">propertyName
</ins>
</var>
<del class="diff-old">to
</del>
<code>
<del class="diff-old">false
</del>
<ins class="diff-chg">]
</ins>
</code>.
</li>
<li>
<ins class="diff-new">If
this
fails,
throw
</ins><code><ins class="diff-new">
SyntaxError
</ins></code>,<ins class="diff-new">
otherwise
return
</ins><var><ins class="diff-new">
value
</ins></var>.</li>
</ol>
</li><li>
<ins class="diff-new">If
these
above
steps
failed,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins><code><ins class="diff-new">
SyntaxError
</ins></code><ins class="diff-new">
and
terminate
these
steps.
</ins></li><li><ins class="diff-new">
Otherwise
resolve
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins><var><ins class="diff-new">
value
</ins></var>.
</li>
</ol>
</div></section><del class="diff-old">3.2
</del><section id="the-fetch-readmultipleproperties-method"><h3 id="x6-6-the-fetch-readmultipleproperties-method"><bdi class="secno">6.6 </bdi>
The
<del class="diff-old">fetch()
</del>
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-readmultipleproperties" data-idl="operation" data-title="
readMultipleProperties()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.readMultipleProperties()|ConsumedThing.readMultipleProperties|readMultipleProperties()|readMultipleProperties"><code>
<ins class="diff-chg">readMultipleProperties()
</ins>
</code></dfn>
method
<a class="self-link" aria-label="§" href="#the-fetch-readmultipleproperties-method"></a></h3><del class="diff-old">Accepts
an
url
</del><div><p><ins class="diff-chg">Reads
multiple
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
values
with
one
or
multiple
requests.
Takes
the
</ins><var><ins class="diff-chg">
propertyNames
</ins></var>
argument
<del class="diff-old">of
type
USVString
that
represents
</del>
<ins class="diff-chg">as
</ins>
a
<del class="diff-old">URL
(e.g.
"file://..."
or
"https://..."
)
</del>
<ins class="diff-chg">sequence
of
strings
</ins>
and
<del class="diff-old">returns
a
Promise
</del>
<ins class="diff-chg">an
optional
</ins><a href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
InteractionOptions
</ins>
</a>
<del class="diff-old">that
resolves
</del>
<var>
<ins class="diff-chg">options
</ins></var><ins class="diff-chg">
argument.
It
returns
an
object
</ins>
with
<del class="diff-old">a
ThingDescription
(a
serialized
JSON-LD
document
of
type
USVString
).
</del>
<ins class="diff-chg">keys
from
</ins><var><ins class="diff-chg">
propertyNames
</ins></var><ins class="diff-chg">
and
values
returned
by
this
algorithm.
</ins>
The
<del class="diff-old">fetch(url)
</del>
method
<em class="rfc2119" title="MUST">MUST</em>
run
the
following
steps:</p>
<ol>
<li>
Return
a
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-16">
Promise
</a>
<var>
promise
</var>
and
execute
the
next
steps
<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel">
in
parallel
</a>.
</li>
<li>
If
invoking
<del class="diff-old">fetch()
</del>
<ins class="diff-chg">this
method
</ins>
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
<var>
promise
</var>
with
<code>
SecurityError
</code>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">If
the
argument
</del>
<ins class="diff-chg">Let
</ins>
<var>
<del class="diff-old">url
</del>
<ins class="diff-chg">result
</ins>
</var>
<del class="diff-old">is
not
a
URL,
reject
</del>
<ins class="diff-chg">be
an
object
and
for
each
string
</ins>
<var>
<del class="diff-old">promise
</del>
<ins class="diff-chg">name
</ins>
</var>
<ins class="diff-new">in
</ins><var><ins class="diff-new">
propertyNames
</ins></var><ins class="diff-new">
add
a
property
</ins>
with
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">key
</ins><var><ins class="diff-chg">
name
</ins></var>
and
<del class="diff-old">terminate
these
steps.
</del>
<ins class="diff-chg">the
value
</ins><code><ins class="diff-chg">
null
</ins></code>.
</li>
<li>
Make
a
request
to
<del class="diff-old">fetch
</del>
the
<del class="diff-old">content
of
url
as
described
by
</del>
<ins class="diff-chg">underlying
platform
(via
</ins>
the
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
Protocol
Bindings
</a>
<del class="diff-old">and
wait
for
</del>
<ins class="diff-chg">)
to
retrieve
</ins>
the
<del class="diff-old">reply.
Implementations
encapsulate
</del>
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Property
</ins></a><ins class="diff-chg">
values
given
by
</ins><var><ins class="diff-chg">
propertyNames
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.</li><li><ins class="diff-chg">
If
this
cannot
be
done
with
a
single
request
with
</ins>
the
<del class="diff-old">fetching
process
and
</del>
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins></a><ins class="diff-chg">
of
</ins>
the
<del class="diff-old">accepted
media
types
(such
as
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins></a>,<ins class="diff-chg">
then
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">application/td+json
</del>
<ins class="diff-chg">NotSupportedError
</ins>
</code>
<del class="diff-old">),
as
far
as
a
valid
Thing
Description
can
be
obtained
as
defined
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Process
the
reply
and
update
all
properties
</ins>
in
<del class="diff-old">[
WOT-TD
].
Let
</del>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">result
</ins>
</var>
<del class="diff-old">be
the
Thing
Description
string-serialized
from
</del>
<ins class="diff-chg">with
</ins>
the
<del class="diff-old">returned
content,
as
specified
</del>
<ins class="diff-chg">values
obtained
</ins>
in
the
<del class="diff-old">Thing
Description
serialization
.
</del>
<ins class="diff-chg">reply.
</ins>
</li>
<li>
If
<del class="diff-old">there
was
an
error
during
</del>
the
<del class="diff-old">request,
</del>
<ins class="diff-chg">above
step
fails
at
any
point,
</ins>
reject
<var>
promise
</var>
with
<del class="diff-old">an
Error
object
error
with
</del>
<code>
<del class="diff-old">error.message
</del>
<ins class="diff-chg">SyntaxError
</ins>
</code>
<del class="diff-old">set
to
the
error
code
seen
by
the
Protocol
Bindings
</del>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise
resolve
</del>
<ins class="diff-chg">Resolve
</ins>
<var>
promise
</var>
with
<var>
<del class="diff-old">td
and
terminate
these
steps.
</del>
<ins class="diff-chg">result
</ins></var>.
</li>
</ol>
</div></section><del class="diff-old">3.3
</del><section id="the-consume-readallproperties-method"><h3 id="x6-7-the-consume-readallproperties-method"><bdi class="secno">6.7 </bdi>
The
<del class="diff-old">consume()
</del>
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-readallproperties" data-idl="operation" data-title="
readAllProperties()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.readAllProperties()|ConsumedThing.readAllProperties|readAllProperties()|readAllProperties"><code>
<ins class="diff-chg">readAllProperties()
</ins>
</code></dfn>
method
<a class="self-link" aria-label="§" href="#the-consume-readallproperties-method"></a></h3><del class="diff-old">Accepts
an
td
argument
</del><div><p><ins class="diff-chg">Reads
all
properties
</ins>
of
<del class="diff-old">type
ThingDescription
</del>
<ins class="diff-chg">the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins>
</a>
<del class="diff-old">and
returns
a
ConsumedThing
</del>
<ins class="diff-chg">with
one
or
multiple
requests.
Takes
an
optional
</ins><a href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
InteractionOptions
</ins>
</a>
<var>
<ins class="diff-new">options
</ins></var><ins class="diff-new">
argument.
It
returns
an
</ins>
object
<del class="diff-old">instantiated
based
on
parsing
that
description.
</del>
<ins class="diff-chg">with
keys
from
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
names
and
values
returned
by
this
algorithm.
</ins>
The
<del class="diff-old">consume(td)
</del>
method
<del class="diff-old">must
</del>
<ins class="diff-chg"><em class="rfc2119" title="MUST">MUST</em>
</ins>
run
the
following
steps:</p>
<ol>
<li>
<del class="diff-old">If
the
argument
</del>
<ins class="diff-chg">Return
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-17"><ins class="diff-chg">
Promise
</ins></a>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">promise
</ins>
</var>
<ins class="diff-new">and
execute
the
next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-new">
in
parallel
</ins></a>.</li><li><ins class="diff-new">
If
invoking
this
method
</ins>
is
not
<del class="diff-old">a
string,
throw
a
</del>
<ins class="diff-chg">allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
and
terminate
these
steps.
</li>
<li>
Let
<var>
<del class="diff-old">stub
</del>
<ins class="diff-chg">result
</ins>
</var>
be
<ins class="diff-new">an
object
and
for
each
string
</ins><var><ins class="diff-new">
name
</ins></var><ins class="diff-new">
in
</ins><var><ins class="diff-new">
propertyNames
</ins></var><ins class="diff-new">
add
a
property
with
key
</ins><var><ins class="diff-new">
name
</ins></var><ins class="diff-new">
and
</ins>
the
<del class="diff-old">result
</del>
<ins class="diff-chg">value
</ins><code><ins class="diff-chg">
null
</ins></code>.</li><li><ins class="diff-chg">
Make
a
request
to
the
underlying
platform
(via
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
)
to
retrieve
the
value
</ins>
of
<del class="diff-old">running
</del>
the
<ins class="diff-chg">all
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
definitions
from
the
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-35">
TD
<del class="diff-old">parsing
algorithm
</del>
</a>
with
<ins class="diff-new">optional
URI
templates
given
in
</ins>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">options.uriVariables
</ins></var>.</li><li><ins class="diff-chg">
If
this
cannot
be
done
with
a
single
request
with
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
of
the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a>,<ins class="diff-chg">
then
reject
</ins><var><ins class="diff-chg">
promise
</ins>
</var>
<del class="diff-old">as
argument.
</del>
<ins class="diff-chg">with
</ins><code><ins class="diff-chg">
NotSupportedError
</ins></code><ins class="diff-chg">
and
terminate
these
steps.
</ins></li><li>
If
<del class="diff-old">that
throws
an
error,
re-throw
</del>
<ins class="diff-chg">the
request
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
the
error
<ins class="diff-new">received
from
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Process
the
reply
and
update
all
properties
in
</ins>
<var>
<del class="diff-old">stub
</del>
<ins class="diff-chg">result
</ins>
</var>
<del class="diff-old">does
not
have
an
own
property
that
is
defined
</del>
<ins class="diff-chg">with
the
values
obtained
</ins>
in
<del class="diff-old">ThingFragment
</del>
<ins class="diff-chg">the
reply.
</ins></li><li><ins class="diff-chg">
Resolve
</ins><var><ins class="diff-chg">
promise
</ins></var>
with
<del class="diff-old">a
default
value,
add
that
property
and
value
to
</del>
<var>
<del class="diff-old">stub
</del>
<ins class="diff-chg">result
</ins>
</var>.
</li>
<del class="diff-old">Create
</del>
</ol>
</div></section><section id="the-writeproperty-method"><h3 id="x6-8-the-writeproperty-method"><bdi class="secno">6.8 </bdi>
<ins class="diff-chg">The
</ins><dfn data-dfn-type="method" data-export="" id="dom-consumedthing-writeproperty" data-idl="operation" data-title="
writeProperty()
" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.writeProperty()|ConsumedThing.writeProperty|writeProperty()|writeProperty"><code><ins class="diff-chg">
writeProperty()
</ins></code></dfn><ins class="diff-chg">
method
</ins><a class="self-link" aria-label="§" href="#the-writeproperty-method"></a></h3><div><ins class="diff-chg">
Writes
</ins>
a
<del class="diff-old">ConsumedThing
</del>
<ins class="diff-chg">single
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a>.<ins class="diff-chg">
Takes
a
string
argument
</ins><var><ins class="diff-chg">
propertyName
</ins></var>,<ins class="diff-chg">
a
value
argument
</ins><var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
and
an
optional
</ins><a href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
InteractionOptions
</ins>
</a>
<del class="diff-old">object
</del>
<var>
<del class="diff-old">thing
</del>
<ins class="diff-chg">options
</ins>
</var>
<del class="diff-old">initialized
from
</del>
<ins class="diff-chg">argument.
It
returns
success
or
failure.
The
method
<em class="rfc2119" title="MUST">MUST</em>
run
the
following
steps:
</ins><ol><li><ins class="diff-chg">
Return
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-18"><ins class="diff-chg">
Promise
</ins></a>
<var>
<del class="diff-old">stub
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">that
implements
Observable
</del>
<ins class="diff-chg">and
execute
the
next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins>
</a>.
</li>
<li>
<del class="diff-old">Add
</del>
<ins class="diff-chg">If
invoking
this
method
is
not
allowed
for
</ins>
the
<ins class="diff-new">current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins>
<code>
<del class="diff-old">read()
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
and
<del class="diff-old">write()
methods
to
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Run
</ins>
the
<del class="diff-old">ThingProperty
</del>
<a href="#dfn-validate-property-value" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">validate
Property
value
</ins>
</a>
<del class="diff-old">elements
so
</del>
<ins class="diff-chg">steps
on
</ins><var><ins class="diff-chg">
value
</ins></var>.<ins class="diff-chg">
If
</ins>
that
<del class="diff-old">they
make
requests
to
access
the
remote
Thing
s
and
wait
for
the
reply,
as
defined
by
the
Protocol
Bindings
.
Also,
all
ThingProperty
</del>
<ins class="diff-chg">fails,
reject
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-19"><ins class="diff-chg">
promise
</ins>
</a>
<del class="diff-old">elements
<em class="rfc2119" title="SHOULD">SHOULD</em>
implement
</del>
<ins class="diff-chg">with
</ins>
<code>
<del class="diff-old">Observable
</del>
<ins class="diff-chg">SyntaxError
</ins>
</code>
<del class="diff-old">,
i.e.
define
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Make
</ins>
a
<del class="diff-old">subscribe()
method
that
should
make
</del>
request
to
<del class="diff-old">observe
</del>
the
<del class="diff-old">given
Properties
as
defined
by
</del>
<ins class="diff-chg">underlying
platform
(via
</ins>
the
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-36">
Protocol
Bindings
<del class="diff-old">.
Add
the
invoke()
methods
to
the
ThingAction
</del>
</a>
<del class="diff-old">elements
so
that
they
make
requests
</del>
<ins class="diff-chg">)
to
write
</ins><var><ins class="diff-chg">
value
</ins></var>
to
the
<del class="diff-old">remote
Thing
</del>
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Property
</ins>
</a>
<del class="diff-old">to
invoke
its
actions,
as
defined
</del>
<ins class="diff-chg">given
</ins>
by
<del class="diff-old">the
Protocol
Bindings
.
</del>
<var>
<ins class="diff-chg">propertyName
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.
</li>
<li>
<del class="diff-old">Add
the
subscribe()
method
to
all
ThingEvent
elements
so
that
they
make
requests
to
subscribe
to
</del>
<ins class="diff-chg">If
</ins>
the
<del class="diff-old">events
defined
by
</del>
<ins class="diff-chg">request
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
the
<del class="diff-old">remote
Thing
,
as
defined
by
</del>
<ins class="diff-chg">error
received
from
</ins>
the
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-37">
Protocol
Bindings
<del class="diff-old">.
</del>
</a>
<ins class="diff-chg">and
terminate
these
steps.
</ins>
</li>
<li>
<del class="diff-old">Return
</del>
<ins class="diff-chg">Otherwise
resolve
</ins>
<var>
<del class="diff-old">thing
</del>
<ins class="diff-chg">promise
</ins>
</var>.
</li>
</ol>
</div></section><del class="diff-old">3.4
</del><section id="the-produce-writemultipleproperties-method"><h3 id="x6-9-the-produce-writemultipleproperties-method"><bdi class="secno">6.9 </bdi>
The
<del class="diff-old">produce()
</del>
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-writemultipleproperties" data-idl="operation" data-title="
writeMultipleProperties()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.writeMultipleProperties()|ConsumedThing.writeMultipleProperties|writeMultipleProperties()|writeMultipleProperties"><code>
<ins class="diff-chg">writeMultipleProperties()
</ins>
</code></dfn>
method
<a class="self-link" aria-label="§" href="#the-produce-writemultipleproperties-method"></a></h3><del class="diff-old">Accepts
</del><div><p><ins class="diff-chg">Writes
</ins>
a
<del class="diff-old">model
</del>
<ins class="diff-chg">multiple
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
values
with
one
request.
Takes
a
</ins><var><ins class="diff-chg">
properties
</ins></var>
argument
<del class="diff-old">of
type
ThingModel
</del>
<ins class="diff-chg">as
an
object
with
keys
being
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
<ins class="diff-chg">names
and
values
as
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
values
</ins>
and
<del class="diff-old">returns
</del>
an
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">optional
</ins><a href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
InteractionOptions
</ins>
</a>
<del class="diff-old">object.
</del>
<var>
<ins class="diff-chg">options
</ins></var><ins class="diff-chg">
argument.
It
returns
success
or
failure.
</ins>
The
<del class="diff-old">produce(model)
</del>
method
<em class="rfc2119" title="MUST">MUST</em>
run
the
following
steps:</p>
<ol>
<li>
<ins class="diff-new">Return
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-20"><ins class="diff-new">
Promise
</ins></a><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
and
execute
the
next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-new">
in
parallel
</ins></a>.</li><li>
If
invoking
<del class="diff-old">produce()
</del>
<ins class="diff-chg">this
method
</ins>
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
<del class="diff-old">throw
</del>
<ins class="diff-chg">reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
SecurityError
</code>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">If
the
argument
</del>
<ins class="diff-chg">For
each
key
</ins>
<var>
<del class="diff-old">model
</del>
<ins class="diff-chg">name
</ins>
</var>
<del class="diff-old">is
a
string,
then
run
the
TD
parsing
algorithm
with
</del>
<ins class="diff-chg">on
</ins>
<var>
<del class="diff-old">model
passed
</del>
<ins class="diff-chg">properties
</ins></var>,<ins class="diff-chg">
take
its
value
</ins>
as
<del class="diff-old">parameter.
If
it
throws
an
error,
re-throw
that
error
and
terminate
this
algorithm.
Otherwise
let
</del>
<var>
<del class="diff-old">model
</del>
<ins class="diff-chg">value
</ins>
</var>
<del class="diff-old">be
</del>
<ins class="diff-chg">and
run
</ins>
the
<del class="diff-old">returned
value.
</del>
<a href="#dfn-validate-property-value" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">validate
Property
value
</ins></a><ins class="diff-chg">
steps
on
</ins><var><ins class="diff-chg">
value
</ins></var>.
If
<ins class="diff-new">that
fails
in
for
any
</ins>
<var>
<del class="diff-old">model
is
not
an
object,
throw
</del>
<ins class="diff-chg">name
</ins></var>,<ins class="diff-chg">
reject
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-21"><ins class="diff-chg">
promise
</ins></a><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">TypeError
</del>
<ins class="diff-chg">SyntaxError
</ins>
</code>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">If
model
does
not
have
an
own
property
that
is
defined
in
ThingFragment
with
</del>
<ins class="diff-chg">Make
</ins>
a
<del class="diff-old">default
value,
add
that
property
and
value
</del>
<ins class="diff-chg">single
request
</ins>
to
<del class="diff-old">model
.
Create
an
ExposedThing
</del>
<ins class="diff-chg">the
underlying
platform
(via
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">object
</del>
<ins class="diff-chg">)
to
write
the
each
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
provided
in
</ins>
<var>
<del class="diff-old">thing
</del>
<ins class="diff-chg">properties
</ins>
</var>
<del class="diff-old">initialized
from
</del>
<ins class="diff-chg">with
optional
URI
templates
given
in
</ins>
<var>
<del class="diff-old">model
</del>
<ins class="diff-chg">options.uriVariables
</ins>
</var>.
</li>
<li>
<del class="diff-old">For
each
property
of
ExposedThing
defined
in
ThingFragment
,
initialize
the
property
based
on
the
provided
initial
or
default
values
provided
to
the
local
WoT
Runtime
implementation,
for
instance
initialize:
the
id
property
to
</del>
<ins class="diff-chg">If
this
cannot
</ins>
be
<ins class="diff-new">done
with
a
single
request
with
</ins>
the
<del class="diff-old">final
unique
identifier
</del>
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins></a>
of
the
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
Thing
</a>,
<del class="diff-old">the
security
object
of
type
</del>
<ins class="diff-chg">then
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">SecurityScheme
</del>
<ins class="diff-chg">NotSupportedError
</ins>
</code>
<del class="diff-old">to
represent
the
actual
security
scheme
</del>
and
<del class="diff-old">its
properties
as
set
up
by
the
implementation,
</del>
<ins class="diff-chg">terminate
these
steps.
</ins>
</li>
<li>
<ins class="diff-new">If
</ins>
the
<del class="diff-old">properties
property
to
be
an
object
with
all
properties
being
ThingProperty
objects
in
which
</del>
<ins class="diff-chg">request
fails,
return
</ins>
the
<del class="diff-old">read()
and
write()
methods
are
provided
to
define
local
methods
to
get
and
set
</del>
<ins class="diff-chg">error
received
from
</ins>
the
<del class="diff-old">Property
</del>
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins>
</a>
<del class="diff-old">values,
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins>
</li>
<li>
<del class="diff-old">the
</del>
<ins class="diff-chg">Otherwise
resolve
</ins><var><ins class="diff-chg">
promise
</ins></var>.</li></ol></div></section><section id="the-wotlistener-callback"><h3 id="x6-10-the-wotlistener-callback"><bdi class="secno">6.10 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="dfn" id="dfn-wotlistener"><ins class="diff-chg">
WotListener
</ins></dfn><ins class="diff-chg">
callback
</ins><a class="self-link" aria-label="§" href="#the-wotlistener-callback"></a></h3><p><ins class="diff-chg">
User
provided
callback
that
takes
</ins>
<code>
<del class="diff-old">actions
</del>
<ins class="diff-chg">any
</ins>
</code>
<del class="diff-old">property
</del>
<ins class="diff-chg">argument
and
is
used
for
observing
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
changes
and
handling
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
notifications.
Since
subscribing
</ins>
to
<del class="diff-old">be
an
object
</del>
<ins class="diff-chg">these
are
WoT
interactions,
they
are
not
modelled
</ins>
with
<del class="diff-old">all
properties
being
ThingAction
objects
in
which
the
invoke()
</del>
<ins class="diff-chg">software
events.
</ins></p></section><section id="the-observeproperty-method-is-provided-to-define"><h3 id="x6-11-the-observeproperty-method-is-provided-to-define"><bdi class="secno">6.11 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-consumedthing-observeproperty" data-idl="operation" data-title="
observeProperty()
" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.observeProperty()|ConsumedThing.observeProperty|observeProperty()|observeProperty"><code><ins class="diff-chg">
observeProperty()
</ins></code></dfn>
method
<del class="diff-old">is
provided
to
define
</del>
<a class="self-link" aria-label="§" href="#the-observeproperty-method-is-provided-to-define"></a></h3><div><p><ins class="diff-chg">Makes
</ins>
a
<del class="diff-old">local
</del>
<ins class="diff-chg">request
for
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
value
change
notifications.
Takes
a
string
argument
</ins><var><ins class="diff-chg">
propertyName
</ins></var>,<ins class="diff-chg">
a
</ins><a href="#dfn-wotlistener" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WotListener
</ins></a><ins class="diff-chg">
callback
function
</ins><var><ins class="diff-chg">
listener
</ins></var><ins class="diff-chg">
and
an
optional
</ins><a href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
InteractionOptions
</ins></a><var><ins class="diff-chg">
options
</ins></var><ins class="diff-chg">
argument.
It
returns
success
or
failure.
The
</ins>
method
<del class="diff-old">to
</del>
<ins class="diff-chg"><em class="rfc2119" title="MUST">MUST</em>
</ins>
run
the
<del class="diff-old">defined
Action
</del>
<ins class="diff-chg">following
steps:
</ins></p><ol><li><ins class="diff-chg">
Return
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-22"><ins class="diff-chg">
Promise
</ins>
</a>
<del class="diff-old">s,
</del>
<var>
<ins class="diff-chg">promise
</ins></var><ins class="diff-chg">
and
execute
the
next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.
</li>
<li>
<ins class="diff-new">If
invoking
this
method
is
not
allowed
for
</ins>
the
<del class="diff-old">events
property
to
be
an
object
</del>
<ins class="diff-chg">current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var>
with
<del class="diff-old">all
properties
being
</del>
<code>
<del class="diff-old">ExposedEvent
objects
in
which
the
emit()
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">method
is
provided
to
define
a
local
way
to
trigger
sending
notifications
to
all
subscribed
clients,
</del>
and
<del class="diff-old">initialize
the
other
properties
as
initialized
from
model
.
</del>
<ins class="diff-chg">terminate
these
steps.
</ins>
</li>
<li>
<del class="diff-old">Return
</del>
<ins class="diff-chg">If
</ins>
<var>
<del class="diff-old">thing
.
The
TD
parsing
algorithm
takes
</del>
<ins class="diff-chg">listener
</ins></var><ins class="diff-chg">
is
not
</ins>
a
<del class="diff-old">string
</del>
<ins class="diff-chg">function,
reject
</ins>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">as
argument
</del>
<ins class="diff-chg">with
</ins><code><ins class="diff-chg">
"TypeError"
</ins></code>
and
<del class="diff-old">runs
the
following
steps:
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li>
<li>
<del class="diff-old">Parse
td
according
</del>
<ins class="diff-chg">Make
a
request
</ins>
to
the
<del class="diff-old">WoT
Thing
Description
</del>
<ins class="diff-chg">underlying
platform
(via
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">in
order
</del>
<ins class="diff-chg">)
</ins>
to
<del class="diff-old">produce
a
JSON
object
</del>
<ins class="diff-chg">observe
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
<ins class="diff-new">identified
by
</ins>
<var>
<del class="diff-old">json
.
Update
thing
</del>
<ins class="diff-chg">propertyName
</ins>
</var>
with
<del class="diff-old">the
properties
and
values
defined
</del>
<ins class="diff-chg">optional
URI
templates
given
</ins>
in
<var>
<del class="diff-old">json
</del>
<ins class="diff-chg">options.uriVariables
</ins>
</var>.
</li>
<li>
If
<del class="diff-old">there
was
an
error
during
</del>
the
<del class="diff-old">parsing,
throw
that
</del>
<ins class="diff-chg">request
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
the
</ins>
error
<ins class="diff-new">received
from
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>
and
terminate
these
steps.
</li>
<li>
Otherwise
<del class="diff-old">return
</del>
<ins class="diff-chg">resolve
</ins>
<var>
<del class="diff-old">json
</del>
<ins class="diff-chg">promise
</ins>
</var>.
</li>
<del class="diff-old">3.5
The
register()
method
Takes
two
mandatory
arguments:
directory
denoting
a
Thing
Directory
,
and
</del>
<li>
<del class="diff-old">thing
denoting
an
ExposedThing
object.
Generate
</del>
<ins class="diff-chg">Whenever
</ins>
the
<del class="diff-old">Thing
Description
</del>
<ins class="diff-chg">underlying
platform
receives
a
notification
for
this
subscription
with
new
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
<del class="diff-old">as
</del>
<ins class="diff-chg">value
</ins>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">value
</ins>
</var>,
<del class="diff-old">given
</del>
<ins class="diff-chg">run
</ins>
the
<del class="diff-old">Properties
,
Action
s
and
Event
s
defined
for
this
ExposedThing
</del>
<ins class="diff-chg">following
sub-steps:
</ins><ul><li><ins class="diff-chg">
If
running
the
</ins><a href="#dfn-validate-property-value" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
validate
Property
value
</ins>
</a>
<del class="diff-old">object.
Then
make
a
request
to
register
</del>
<ins class="diff-chg">steps
on
</ins>
<var>
<del class="diff-old">td
</del>
<ins class="diff-chg">value
</ins>
</var>
<del class="diff-old">to
the
given
WoT
Thing
Directory
.
</del>
<ins class="diff-chg">fails,
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Invoke
</ins><var><ins class="diff-chg">
listener
</ins></var><ins class="diff-chg">
with
</ins><var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
as
parameter.
</ins></li></ul></li></ol></div></section><del class="diff-old">3.6
</del><section id="the-unregister-unobserveproperty-method"><h3 id="x6-12-the-unregister-unobserveproperty-method"><bdi class="secno">6.12 </bdi>
The
<del class="diff-old">unregister()
</del>
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-unobserveproperty" data-idl="operation" data-title="
unobserveProperty()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.unobserveProperty()|ConsumedThing.unobserveProperty|unobserveProperty()|unobserveProperty"><code>
<ins class="diff-chg">unobserveProperty()
</ins>
</code></dfn>
method
<a class="self-link" aria-label="§" href="#the-unregister-unobserveproperty-method"></a></h3><div><p><ins class="diff-chg">Makes
a
request
for
unsubscribing
from
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
value
change
notifications.
</ins>
Takes
<del class="diff-old">two
mandatory
arguments:
</del>
<ins class="diff-chg">a
string
argument
</ins><var><ins class="diff-chg">
propertyName
</ins></var><ins class="diff-chg">
and
returns
success
or
failure.
The
method
<em class="rfc2119" title="MUST">MUST</em>
run
the
following
steps:
</ins></p><ol>
<li>
<del class="diff-old">directory
denoting
</del>
<ins class="diff-chg">Return
</ins>
a
<del class="diff-old">Thing
Directory
,
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-23">
<ins class="diff-chg">Promise
</ins></a><var><ins class="diff-chg">
promise
</ins></var>
and
<ins class="diff-new">execute
the
next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-new">
in
parallel
</ins></a>.
</li>
<li>
<ins class="diff-new">If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins>
<code>
<del class="diff-old">thing
denoting
an
ExposedThing
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">object.
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins>
</li>
<del class="diff-old">Makes
</del>
<li>
<ins class="diff-chg">Make
</ins>
a
request
to
<del class="diff-old">unregister
</del>
the
<del class="diff-old">thing
from
</del>
<ins class="diff-chg">underlying
platform
(via
</ins>
the
<del class="diff-old">given
WoT
Thing
Directory
.
3.7
Examples
Example
1
</del>
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins>
</a>
<del class="diff-old">:
Discover
Things
via
directory
discoveryFilter = {
,

<p>};
subscription = wot.discover(discoveryFilter).subscribe(
{</p>
<ul>
<li>td.name);</li>
</ul>
<p>thing = wot.consume(td);
},
error =&gt; {  + error.message); },
() =&gt; { );}
);
setTimeout(  {
subscription.unsubscribe();
);
},
5000
);
Example
2
</p><p><ins class="diff-chg">)
to
stop
observing
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
<del class="diff-old">:
Discover
Things
exposed
</del>
<ins class="diff-chg">identified
</ins>
by
<del class="diff-old">local
hardware
}).subscribe(</del></p>

<ul>
<li>td.name); },
error =&gt; {  + error.message); },
() =&gt; { );}
);
Example
3
:
Same
as
above
but
<var>
<ins class="diff-chg">propertyName
</ins></var>.
</li><li><ins class="diff-chg">
If
the
request
fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var>
with
<del class="diff-old">different
Observable
syntax
}).subscribe({
td =&gt; {  + td.name); },</del></li>
<li>err.message); },
);}
});
<ins class="diff-chg">the
error
received
from
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise
resolve
</ins><var><ins class="diff-chg">
promise
</ins></var>.</li>
</ul></del>
</li>
</ol>
</div></section><del class="diff-old">4.
</del><section id="the-consumedthing-invokeaction-interface-represents-an-object-that-extends-method"><h3 id="x6-13-the-consumedthing-invokeaction-interface-represents-an-object-that-extends-method"><bdi class="secno">6.13 </bdi>
The
<del class="diff-old">ConsumedThing
</del>
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-invokeaction" data-idl="operation" data-title="
invokeAction()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.invokeAction()|ConsumedThing.invokeAction|invokeAction()|invokeAction"><code>
<ins class="diff-chg">invokeAction()
</ins>
</code></dfn>
<del class="diff-old">interface
Represents
an
object
that
extends
</del>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href="#the-consumedthing-invokeaction-interface-represents-an-object-that-extends-method"></a></h3><div><ins class="diff-chg">
Makes
</ins>
a
<del class="diff-old">ThingFragment
with
methods
for
client
interactions
(send
</del>
request
for
<del class="diff-old">reading
and
writing
Properties
),
invoke
</del>
<ins class="diff-chg">invoking
an
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
<del class="diff-old">s,
subscribe
</del>
and
<del class="diff-old">unsubscribe
for
Property
changes
and
Event
s.

<p>readonly attribute
readonly attribute
readonly attribute
readonly attribute
readonly attribute
readonly attribute
// getter for ThingFragment properties</p>
<p>};
[]
interface 
readonly maplike&lt;
};
[]
interface 
readonly maplike&lt;
};
[]
interface 
readonly maplike&lt;
};
ConsumedThing
includes
</p><p><ins class="diff-chg">return
the
result.
Takes
a
string
argument
</ins><var><ins class="diff-chg">
actionName
</ins></var>,<ins class="diff-chg">
an
optional
argument
</ins><var><ins class="diff-chg">
params
</ins></var><ins class="diff-chg">
of
type
</ins>
<code>
<del class="diff-old">Observable
</del>
<ins class="diff-chg">any
</ins>
</code>
<ins class="diff-chg">and
an
optional
</ins><a href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
InteractionOptions
</ins>
</a>
<del class="diff-old">;
//
for
TD
changes
The
id
attribute
represents
</del>
<var>
<ins class="diff-chg">options
</ins></var><ins class="diff-chg">
argument.
It
returns
</ins>
the
<del class="diff-old">unique
identifier
</del>
<ins class="diff-chg">result
</ins>
of
the
<del class="diff-old">Thing
</del>
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Action
</ins>
</a>
<del class="diff-old">instance,
typically
a
URI,
IRI,
</del>
or
<del class="diff-old">URN
as
USVString
.
</del>
<ins class="diff-chg">an
error.
</ins>
The
<del class="diff-old">name
attribute
represents
the
name
of
</del>
<ins class="diff-chg">method
<em class="rfc2119" title="MUST">MUST</em>
run
</ins>
the
<del class="diff-old">Thing
</del>
<ins class="diff-chg">following
steps:
</ins></p>
<ol><li><ins class="diff-chg">
Return
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-24"><ins class="diff-chg">
Promise
</ins>
</a>
<del class="diff-old">as
DOMString
.
The
base
attribute
represents
</del>
<var>
<ins class="diff-chg">promise
</ins></var><ins class="diff-chg">
and
execute
</ins>
the
<del class="diff-old">base
URI
that
</del>
<ins class="diff-chg">next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.</li><li><ins class="diff-chg">
If
invoking
this
method
</ins>
is
<del class="diff-old">valid
</del>
<ins class="diff-chg">not
allowed
</ins>
for
<del class="diff-old">all
defined
local
interaction
resources.
The
properties
attribute
represents
a
dictionary
of
ThingProperty
items.
The
PropertyMap
interface
represents
a
maplike
dictionary
where
all
values
are
ThingProperty
objects.
The
</del>
<ins class="diff-chg">the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">read()
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
and
<del class="diff-old">write()
methods
make
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Make
</ins>
a
request
to
<del class="diff-old">access
</del>
the
<del class="diff-old">Properties
on
</del>
<ins class="diff-chg">underlying
platform
(via
</ins>
the
<del class="diff-old">remote
Thing
represented
by
this
ConsumedThing
proxy
object.
The
actions
attribute
represents
a
dictionary
of
ThingAction
items.
The
ActionMap
interface
represents
a
maplike
dictionary
where
all
values
are
ThingAction
</del>
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins>
</a>
<del class="diff-old">objects.
The
invoke()
method
represents
a
request
</del>
<ins class="diff-chg">)
</ins>
to
invoke
the
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
<del class="diff-old">on
the
remote
Thing
.
The
events
attribute
represents
a
dictionary
of
ThingEvent
items.
The
EventMap
interface
represents
a
maplike
dictionary
where
all
values
are
ThingEvent
objects.
Subscribing
to
</del>
<ins class="diff-chg">identified
by
</ins><var><ins class="diff-chg">
actionName
</ins></var><ins class="diff-chg">
with
parameters
provided
in
</ins><var><ins class="diff-chg">
params
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.</li><li><ins class="diff-chg">
If
</ins>
the
<del class="diff-old">events
involves
setting
up
</del>
<ins class="diff-chg">request
fails
locally
or
returns
</ins>
an
<del class="diff-old">observation
(subscription)
mechanism
on
the
remote
object.
4.1
Examples
Below
a
ConsumedThing
interface
example
is
given.
Example
4
:
Consume
a
Thing
{
}).subscribe(
{
thing = wot.consume(td);
);
{
<ul>
<li>value);
});
thing.actions[ })
.then(); })
.catch( {
);
subscription.unsubscribe();
})
},
error =&gt; {  + error.message); },
() =&gt; { );}
);
} (error) {<ul>
<li>error.message);
};</li>
</ul>
5.
The
ExposedThing
interface
The
ExposedThing
interface
is
<ins class="diff-chg">error
over
</ins>
the
<del class="diff-old">server
API
that
allows
defining
request
handlers,
properties,
Actions
,
and
Events
to
a
Thing
.
It
also
implements
</del>
<ins class="diff-chg">network,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
the
<del class="diff-old">Observable
interface.
An
ExposedThing
is
created
by
</del>
<ins class="diff-chg">error
received
from
</ins>
the
<del class="diff-old">produce()
method.
</del></li>
</ul>
<p>readonly attribute
readonly attribute
readonly attribute
// getter for ThingFragment properties</p>
<p>// setter for ThingFragment properties</p>
<p>// methods to expose and destroy the Thing</p>
<p>// define Properties</p>
<p>// define Actions</p>
<p>// define Events</p>
<p>};
[]
interface 
maplike&lt;
};
callback 
callback 
callback
ActionHandler
=
Promise
&lt;
any
</p>
<blockquote>
</blockquote>
<p>(
any
parameters
);
The
properties
attribute
represents
a
dictionary
of
ThingProperty

<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins>
</a>
<del class="diff-old">items
in
which
the
read()
</del>
and
<del class="diff-old">write()
methods
define
local
methods
that
access
the
physical
representations
of
</del>
<ins class="diff-chg">terminate
these
steps.
</ins>
</p>
</del>
</li><li><ins class="diff-chg">
Otherwise
let
</ins><var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
be
</ins>
the
<del class="diff-old">Properties
.
The
actions
attribute
represents
a
dictionary
of
ThingAction
items
</del>
<ins class="diff-chg">result
returned
</ins>
in
<del class="diff-old">which
</del>
the
<del class="diff-old">invoke()
method
represents
a
local
method
to
invoke
</del>
<ins class="diff-chg">reply
and
run
</ins>
the
<del class="diff-old">Action
.
The
events
attribute
represents
a
dictionary
of
ExposedEvent
</del>
<a href="#dfn-validate-property-value" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">validate
Property
value
</ins>
</a>
<del class="diff-old">items
</del>
<ins class="diff-chg">steps
on
it.
If
</ins>
that
<del class="diff-old">add
the
emit()
method
to
the
ThingEvent
definition.
The
ExposedEvents
interface
represents
a
maplike
dictionary
where
all
values
are
</del>
<ins class="diff-chg">fails,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">ExposedEvent
</del>
<ins class="diff-chg">SyntaxError
</ins>
</code>
<del class="diff-old">objects.
5.1
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins><var><ins class="diff-chg">
value
</ins></var>.</li>
</ol>
</del>
</div></section><section id="the-expose-subscribeevent-method"><h3 id="x6-14-the-expose-subscribeevent-method"><bdi class="secno">6.14 </bdi>
The
<del class="diff-old">expose()
</del>
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-subscribeevent" data-idl="operation" data-title="
subscribeEvent()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.subscribeEvent()|ConsumedThing.subscribeEvent|subscribeEvent()|subscribeEvent"><code>
<ins class="diff-chg">subscribeEvent()
</ins>
</code></dfn>
method
<a class="self-link" aria-label="§" href="#the-expose-subscribeevent-method"></a></h3><del class="diff-old">Start
serving
external
requests
</del><div><p><ins class="diff-chg">Makes
a
request
</ins>
for
<del class="diff-old">the
Thing
,
so
that
WoT
Interactions
</del>
<ins class="diff-chg">subscribing
to
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins>
</a>
<del class="diff-old">using
Properties
,
Action
</del>
<ins class="diff-chg">notifications.
Takes
a
string
argument
</ins><var><ins class="diff-chg">
eventName
</ins></var>,<ins class="diff-chg">
a
</ins><a href="#dfn-wotlistener" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WotListener
</ins>
</a>
<del class="diff-old">s
</del>
<ins class="diff-chg">callback
function
</ins><var><ins class="diff-chg">
listener
</ins></var>
and
<del class="diff-old">Event
</del>
<ins class="diff-chg">an
optional
</ins><a href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
InteractionOptions
</ins>
</a>
<del class="diff-old">s
will
be
possible.
</del>
<var>
<ins class="diff-chg">options
</ins></var><ins class="diff-chg">
argument.
It
returns
success
or
failure.
</ins>
The
<del class="diff-old">expose()
</del>
method
<em class="rfc2119" title="MUST">MUST</em>
run
the
following
steps:</p>
<ol>
<li>
Return
a
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-25">
Promise
</a>
<var>
promise
</var>
and
execute
the
next
steps
<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel">
in
parallel
</a>.
</li>
<li>
If
invoking
<del class="diff-old">expose()
</del>
<ins class="diff-chg">this
method
</ins>
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
<var>
promise
</var>
with
<code>
SecurityError
</code>
and
terminate
these
steps.
</li>
<li>
<ins class="diff-new">If
</ins><var><ins class="diff-new">
listener
</ins></var><ins class="diff-new">
is
not
a
function,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins><code><ins class="diff-new">
"TypeError"
</ins></code><ins class="diff-new">
and
terminate
these
steps.
</ins></li><li>
Make
a
request
to
the
underlying
platform
<del class="diff-old">to
attach
protocol
handlers
and
start
serving
external
requests
for
WoT
Interactions
(read,
write
and
observe
Properties
,
invoke
Action
s
and
manage
Event
subscriptions),
based
on
</del>
<ins class="diff-chg">(via
</ins>
the
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-38">
Protocol
Bindings
<del class="diff-old">.
</del>
</a>
<ins class="diff-chg">)
to
subscribe
to
an
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
identified
by
</ins><var><ins class="diff-chg">
eventName
</ins></var><ins class="diff-chg">
with
optional
URI
templates
given
in
</ins><var><ins class="diff-chg">
options.uriVariables
</ins></var>.
</li>
<li>
If
<del class="diff-old">there
was
an
error
during
</del>
the
<del class="diff-old">request,
</del>
<ins class="diff-chg">request
fails,
</ins>
reject
<var>
promise
</var>
with
<del class="diff-old">an
Error
object
error
with
error.message
set
to
</del>
the
error
<del class="diff-old">code
seen
by
</del>
<ins class="diff-chg">received
from
</ins>
the
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
Protocol
Bindings
</a>
and
terminate
these
steps.
</li>
<li>
Otherwise
resolve
<var>
promise
<del class="diff-old">with
</del>
</var>.
</li>
<li>
<ins class="diff-chg">Whenever
the
underlying
platform
receives
a
notification
for
this
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
subscription,
implementations
<em class="rfc2119" title="SHOULD">SHOULD</em>
invoke
</ins>
<var>
<del class="diff-old">td
and
terminate
these
steps.
</del>
<ins class="diff-chg">listener
</ins></var>,<ins class="diff-chg">
giving
the
data
provided
with
the
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
as
parameter.
</ins>
</li>
</ol>
</div></section><del class="diff-old">5.2
</del><section id="the-destroy-unsubscribeevent-method"><h3 id="x6-15-the-destroy-unsubscribeevent-method"><bdi class="secno">6.15 </bdi>
The
<del class="diff-old">destroy()
</del>
<dfn data-dfn-type="method" data-export="" id="dom-consumedthing-unsubscribeevent" data-idl="operation" data-title="
unsubscribeEvent()

" data-dfn-for="ConsumedThing" data-type="Promise" data-lt="ConsumedThing.unsubscribeEvent()|ConsumedThing.unsubscribeEvent|unsubscribeEvent()|unsubscribeEvent"><code>
<ins class="diff-chg">unsubscribeEvent()
</ins>
</code></dfn>
method
<a class="self-link" aria-label="§" href="#the-destroy-unsubscribeevent-method"></a></h3><del class="diff-old">Stop
serving
external
requests
</del><div><p><ins class="diff-chg">Makes
a
request
</ins>
for
<del class="diff-old">the
Thing
</del>
<ins class="diff-chg">unsubscribing
from
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins>
</a>
<ins class="diff-new">notifications.
Takes
a
string
argument
</ins><var><ins class="diff-new">
eventName
</ins></var>
and
<del class="diff-old">destroy
the
object.
Note
that
eventual
unregistering
should
be
done
before
invoking
this
method.
</del>
<ins class="diff-chg">returns
success
or
failure.
</ins>
The
<del class="diff-old">destroy()
</del>
method
<em class="rfc2119" title="MUST">MUST</em>
run
the
following
steps:</p>
<ol>
<li>
Return
a
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-26">
Promise
</a>
<var>
promise
</var>
and
execute
the
next
steps
<a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel">
in
parallel
</a>.
</li>
<li>
If
invoking
<del class="diff-old">destroy()
</del>
<ins class="diff-chg">this
method
</ins>
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
<var>
promise
</var>
with
<code>
SecurityError
</code>
and
terminate
these
steps.
</li>
<li>
Make
a
request
to
the
underlying
platform
<del class="diff-old">to
stop
serving
external
requests
for
WoT
Interactions
,
based
on
</del>
<ins class="diff-chg">(via
</ins>
the
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-39">
Protocol
Bindings
<del class="diff-old">.
</del>
</a>
<ins class="diff-chg">)
to
unsubscribe
from
the
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
identified
by
</ins><var><ins class="diff-chg">
eventName
</ins></var>.
</li>
<li>
If
<del class="diff-old">there
was
an
error
during
</del>
the
<del class="diff-old">request,
</del>
<ins class="diff-chg">request
fails,
</ins>
reject
<var>
promise
</var>
with
<del class="diff-old">an
Error
object
error
with
error.message
set
to
</del>
the
error
<del class="diff-old">code
seen
by
</del>
<ins class="diff-chg">received
from
</ins>
the
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
Protocol
Bindings
</a>
and
terminate
these
steps.
</li>
<li>
Otherwise
resolve
<var>
promise
<del class="diff-old">with
td
and
terminate
these
steps.
</del>
</var>.
</li>
</ol>
</div></section><del class="diff-old">5.3
The
addProperty()
method
</del><section id="consumedthing-examples"><h3 id="x6-16-consumedthing-examples"><bdi class="secno">6.16 </bdi>
<ins class="diff-chg">ConsumedThing
Examples
</ins><a class="self-link" aria-label="§" href="#consumedthing-examples"></a></h3><p>
<del class="diff-old">Adds
</del>
<ins class="diff-chg">The
next
example
illustrates
how
to
fetch
</ins>
a
<del class="diff-old">Property
</del>
<a href="#dfn-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">TD
</ins>
</a>
<del class="diff-old">with
name
defined
by
the
name
argument,
the
data
schema
provided
</del>
by
<del class="diff-old">the
property
argument
of
type
PropertyFragment
</del>
<ins class="diff-chg">URL,
create
a
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins>
</a>,
<del class="diff-old">and
optionally
an
initial
value
provided
in
the
argument
initValue
whose
type
should
match
the
one
defined
in
the
type
</del>
<ins class="diff-chg">read
metadata
(title),
read
</ins>
property
<del class="diff-old">according
</del>
<ins class="diff-chg">value,
subscribe
</ins>
to
<del class="diff-old">the
value-matching
algorithm
.
If
initValue
is
not
provided,
it
<em class="rfc2119" title="SHOULD">SHOULD</em>
be
initialized
as
undefined
.
Implementations
<em class="rfc2119" title="SHOULD">SHOULD</em>
update
the
Thing
Description
.
Throws
on
error.
Returns
a
reference
</del>
<ins class="diff-chg">property
change,
subscribe
</ins>
to
<del class="diff-old">the
same
object
for
supporting
chaining.
</del>
<ins class="diff-chg">a
WoT
event,
unsubscribe.
</ins>
</p><div class="example" id="example-2-thing-client-api-example">
          <div class="marker">
      <a class="self-link" href="#example-2-thing-client-api-example">Example<bdi> 2</bdi></a><span class="example-title">: Thing Client API example</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">"https://tds.mythings.org/sensor11"</span>);
          <span class="hljs-keyword">let</span> td = res.json();
          <span class="hljs-keyword">let</span> thing = <span class="hljs-keyword">new</span> ConsumedThing(td);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Thing "</span> + thing.getThingDescription().title + <span class="hljs-string">" consumed."</span>);
        } <span class="hljs-keyword">catch</span>(e) {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"TD fetch error: "</span> + e.message); },
        };
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// subscribe to property change for “temperature”</span>
          <span class="hljs-keyword">await</span> thing.observeProperty(<span class="hljs-string">"temperature"</span>, value =&gt; {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Temperature changed to: "</span> + value);
          });
          <span class="hljs-comment">// subscribe to the “ready” event defined in the TD</span>
          <span class="hljs-keyword">await</span> thing.subscribeEvent(<span class="hljs-string">"ready"</span>, eventData =&gt; {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Ready; index: "</span> + eventData);
            <span class="hljs-comment">// run the “startMeasurement” action defined by TD</span>
            <span class="hljs-keyword">await</span> thing.invokeAction(<span class="hljs-string">"startMeasurement"</span>, { <span class="hljs-attr">units</span>: <span class="hljs-string">"Celsius"</span> });
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Measurement started."</span>);
          });
        } <span class="hljs-keyword">catch</span>(e) {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Error starting measurement."</span>);
        }
        setTimeout( <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
          <span class="hljs-built_in">console</span>.log(“Temperature: “ + <span class="hljs-keyword">await</span> thing.readProperty(“temperature”));
          <span class="hljs-keyword">await</span> thing.unsubscribe(“ready”);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Unsubscribed from the ‘ready’ event."</span>);
        },
        <span class="hljs-number">10000</span>);
</code></pre>
        </div></section><del class="diff-old">5.4
</del></section><section data-dfn-for="ExposedThing" id="the-removeproperty-exposedthing-method-interface"><h2 id="x7-the-removeproperty-exposedthing-method-interface"><bdi class="secno">7. </bdi>
The
<del class="diff-old">removeProperty()
</del>
<dfn data-dfn-type="dfn" id="dfn-exposedthing">
<ins class="diff-chg">ExposedThing
</ins>
</dfn>
<del class="diff-old">method
</del>
<ins class="diff-chg">interface
</ins><a class="self-link" aria-label="§" href="#the-removeproperty-exposedthing-method-interface"></a></h2><p>
<del class="diff-old">Removes
the
Property
</del>
<ins class="diff-chg">The
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ExposedThing
</ins>
</a>
<del class="diff-old">specified
by
the
name
argument
and
updates
</del>
<ins class="diff-chg">interface
is
</ins>
the
<del class="diff-old">Thing
Description
.
Throws
on
error.
Returns
a
reference
</del>
<ins class="diff-chg">server
API
</ins>
to
<ins class="diff-new">operate
</ins>
the
<del class="diff-old">same
object
for
supporting
chaining.
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins></a><ins class="diff-chg">
that
allows
defining
request
handlers,
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a>,<a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a>,<ins class="diff-chg">
and
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
interactions.
</ins>
</p><del class="diff-old">5.5
The
</del><pre class="idl def"><span data-idl="" class="idlInterface" id="idl-def-exposedthing" data-title="ExposedThing">      [<span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface" data-cite-path="window-object.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface" data-lt="WorkerGlobalScope" data-cite-path="workers.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
      interface <dfn data-export="" data-dfn-type="interface" id="dom-exposedthing" data-idl="interface" data-title="ExposedThing" class="idlID" data-dfn-for="ExposedThing"><code>ExposedThing</code></dfn>: <span class="idlSuperclass"><a data-xref-type="_IDL_" href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn">ConsumedThing</a></span> {<span data-idl="" class="idlMethod" id="idl-def-exposedthing-setpropertyreadhandler-name-readhandler" data-title="setPropertyReadHandler" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">ExposedThing</a></span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-setpropertyreadhandler"><code>setPropertyReadHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType">
                <a data-xref-type="_IDL_" href="#dfn-propertyreadhandler" class="internalDFN" data-link-type="dfn">PropertyReadHandler</a></span> <span class="idlParamName">readHandler</span>);</span><span data-idl="" class="idlMethod" id="idl-def-exposedthing-setpropertywritehandler-name-writehandler" data-title="setPropertyWriteHandler" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">ExposedThing</a></span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-setpropertywritehandler"><code>setPropertyWriteHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType">
                <a data-xref-type="_IDL_" href="#dfn-propertywritehandler" class="internalDFN" data-link-type="dfn">PropertyWriteHandler</a></span> <span class="idlParamName">writeHandler</span>);</span><span data-idl="" class="idlMethod" id="idl-def-exposedthing-setactionhandler-name-action" data-title="setActionHandler" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">ExposedThing</a></span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-setactionhandler"><code>setActionHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-actionhandler" class="internalDFN" data-link-type="dfn">ActionHandler</a></span> <span class="idlParamName">action</span>);</span><span data-idl="" class="idlMethod" id="idl-def-exposedthing-emitevent-name-data" data-title="emitEvent" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-emitevent"><code>emitEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">data</span>);</span><span data-idl="" class="idlMethod" id="idl-def-exposedthing-expose" data-title="expose" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-expose"><code>expose</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-exposedthing-destroy" data-title="destroy" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-destroy"><code>destroy</code></a>();</span>
      };</span><span data-idl="" class="idlCallback" id="idl-def-propertyreadhandler" data-title="PropertyReadHandler">
      callback <dfn data-export="" data-dfn-type="callback" id="dom-propertyreadhandler" data-idl="callback" data-title="PropertyReadHandler" class="idlID" data-dfn-for="PropertyReadHandler"><code>PropertyReadHandler</code></dfn> =<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a>&gt;</span>(
              optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlCallback" id="idl-def-propertywritehandler" data-title="PropertyWriteHandler">
      callback <dfn data-export="" data-dfn-type="callback" id="dom-propertywritehandler" data-idl="callback" data-title="PropertyWriteHandler" class="idlID" data-dfn-for="PropertyWriteHandler"><code>PropertyWriteHandler</code></dfn> =<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">value</span>,
              optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlCallback" id="idl-def-actionhandler" data-title="ActionHandler">
      callback <dfn data-export="" data-dfn-type="callback" id="dom-actionhandler" data-idl="callback" data-title="ActionHandler" class="idlID" data-dfn-for="ActionHandler"><code>ActionHandler</code></dfn> =<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a>&gt;</span>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">params</span>,
              optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span></pre><section id="constructing-addaction-exposedthing-method"><h3 id="x7-1-constructing-addaction-exposedthing-method"><bdi class="secno">7.1 </bdi><ins class="diff-chg">
Constructing
</ins>
<code>
<del class="diff-old">addAction()
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">method
</del>
<a class="self-link" aria-label="§" href="#constructing-addaction-exposedthing-method"></a></h3><p>
<del class="diff-old">Adds
to
the
</del>
<ins class="diff-chg">The
</ins>
<code>
<del class="diff-old">actions
</del>
<ins class="diff-chg">ExposedThing
</ins>
</code>
<del class="diff-old">property
of
</del>
<ins class="diff-chg">interface
extends
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins></a>.<ins class="diff-chg">
It
is
constructed
from
</ins>
a
<del class="diff-old">Thing
</del>
<ins class="diff-chg">full
or
partial
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins>
</a>
<del class="diff-old">object
</del>
<ins class="diff-chg">object.
</ins></p><div class="note" role="note" id="issue-container-generatedID-6"><div role="heading" class="note-title marker" id="h-note-2" aria-level="4"><span>Note</span></div><p class=""><ins class="diff-chg">
Note
that
</ins>
an
<del class="diff-old">Action
</del>
<ins class="diff-chg">existing
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins>
</a>
<del class="diff-old">with
name
defined
</del>
<ins class="diff-chg">object
can
be
optionally
modified
(for
instance
</ins>
by
<del class="diff-old">the
</del>
<ins class="diff-chg">adding
or
removing
elements
on
its
</ins>
<var>
<del class="diff-old">name
</del>
<ins class="diff-chg">properties
</ins></var>,<var><ins class="diff-chg">
actions
</ins>
</var>
<del class="diff-old">argument,
defines
input
</del>
and
<del class="diff-old">output
data
format
by
the
</del>
<var>
<del class="diff-old">init
</del>
<ins class="diff-chg">events
</ins>
</var>
<del class="diff-old">argument
of
type
ActionFragment
,
</del>
<ins class="diff-chg">internal
properties)
</ins>
and
<del class="diff-old">adds
</del>
the
<del class="diff-old">function
provided
in
</del>
<ins class="diff-chg">resulting
object
can
used
for
constructing
an
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ExposedThing
</ins></a><ins class="diff-chg">
object.
This
is
</ins>
the
<del class="diff-old">action
argument
</del>
<ins class="diff-chg">current
way
of
adding
and
removing
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a>,<a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a><ins class="diff-chg">
and
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
definitions,
</ins>
as
<del class="diff-old">a
handler,
then
updates
</del>
<ins class="diff-chg">illustrated
in
</ins>
the
<del class="diff-old">Thing
Description
</del>
<a href="#exposedthing-examples">
<ins class="diff-chg">examples
</ins>
</a>.
<del class="diff-old">Throws
on
error.
Returns
a
reference
to
</del>
</p></div><div class="note" role="note" id="issue-container-generatedID-7"><div role="heading" class="note-title marker" id="h-note-3" aria-level="4"><span>Note</span></div><p class="">
<ins class="diff-chg">Before
invoking
</ins><a href="#dom-exposedthing-expose"><ins class="diff-chg">
expose()
</ins></a>,
the
<del class="diff-old">same
</del>
<a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ExposedThing
</ins></a>
object
<del class="diff-old">for
supporting
chaining.
</del>
<ins class="diff-chg">does
not
serve
any
requests.
This
allows
first
constructing
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ExposedThing
</ins></a><ins class="diff-chg">
and
then
initialize
its
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Properties
</ins></a><ins class="diff-chg">
and
service
handlers
before
starting
serving
requests.
</ins>
</p></div><del class="diff-old">The
provided
action
callback
function
will
implement
invoking
</del><div><p><ins class="diff-chg">To
construct
</ins>
an
<del class="diff-old">Action
</del>
<a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ExposedThing
</ins>
</a>
<del class="diff-old">and
<em class="rfc2119" title="SHOULD">SHOULD</em>
be
called
by
implementations
when
a
request
for
invoking
</del>
<ins class="diff-chg">with
</ins>
the
<del class="diff-old">Action
</del>
<a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ThingDescription
</ins>
</a>
<var>
<ins class="diff-new">td
</ins></var>,<ins class="diff-new">
run
the
following
steps:
</ins></p><ol><li><ins class="diff-new">
If
invoking
this
method
</ins>
is
<del class="diff-old">received
from
</del>
<ins class="diff-chg">not
allowed
for
</ins>
the
<del class="diff-old">underlying
platform.
The
callback
will
receive
a
</del>
<ins class="diff-chg">current
scripting
context
for
security
reasons,
throw
</ins>
<code>
<del class="diff-old">parameters
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">dictionary
argument
according
to
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Run
</ins>
the
<del class="diff-old">definition
in
</del>
<a href="#dfn-expand-a-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">expand
a
TD
</ins></a><ins class="diff-chg">
steps
on
</ins><var><ins class="diff-chg">
td
</ins></var>.<ins class="diff-chg">
If
that
fails,
re-throw
</ins>
the
<ins class="diff-new">error
and
terminate
these
steps.
</ins></li><li><ins class="diff-new">
Let
</ins>
<var>
<del class="diff-old">init.input
</del>
<ins class="diff-chg">thing
</ins>
</var>
<del class="diff-old">argument
and
will
return
</del>
<ins class="diff-chg">be
</ins>
a
<del class="diff-old">value
</del>
<ins class="diff-chg">new
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ExposedThing
</ins></a><ins class="diff-chg">
object.
</ins></li><li><ins class="diff-chg">
Let
|<var>td</var>|
be
an
internal
slot
</ins>
of
<del class="diff-old">type
defined
by
the
</del>
<var>
<del class="diff-old">init.output
</del>
<ins class="diff-chg">thing
</ins></var><ins class="diff-chg">
and
let
</ins><var><ins class="diff-chg">
td
</ins>
</var>
<del class="diff-old">argument
according
to
the
value-matching
algorithm
.
There
<em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
be
<del class="diff-old">exactly
one
handler
for
any
given
Action
.
If
no
handler
is
initialized
for
any
given
Action
,
implementations
<em class="rfc2119" title="SHOULD">SHOULD</em>
throw
a
TypeError
.
</del>
<ins class="diff-chg">its
value.
</ins></li><li><ins class="diff-chg">
Return
</ins><var><ins class="diff-chg">
thing
</ins></var>.</li></ol>
</div></section><del class="diff-old">5.6
The
removeAction()
method
</del><section id="methods-inherited-from-consumedthing"><h3 id="x7-2-methods-inherited-from-consumedthing"><bdi class="secno">7.2 </bdi>
<ins class="diff-chg">Methods
inherited
from
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins>
</a>
<a class="self-link" aria-label="§" href="#methods-inherited-from-consumedthing"></a></h3><p>
<del class="diff-old">Removes
the
Action
specified
by
</del>
<ins class="diff-chg">The
</ins><code><ins class="diff-chg">
readProperty()
</ins></code>,<code><ins class="diff-chg">
readMultipleProperties()
</ins></code>,<code><ins class="diff-chg">
readAllProperties()
</ins></code>,<code><ins class="diff-chg">
writeProperty()
</ins></code>,<code><ins class="diff-chg">
writeMultipleProperties()
</ins></code>,<code><ins class="diff-chg">
writeAllProperties()
</ins></code><ins class="diff-chg">
methods
have
</ins>
the
<ins class="diff-new">same
algorithmic
steps
as
described
in
</ins><a href="#the-consumedthing-interface" class="respec-offending-element" title="Linter (local-refs-exist): Broken local reference found in document. Please fix the links mentioned. See developer console. Occured" id="respec-offender-linter-local-refs-exist-broken-local-reference-found-in-document-please-fix-the-links-mentioned-see-developer-console-occured">
<code>
<del class="diff-old">name
</del>
<ins class="diff-chg">ConsumedThing
</ins>
</code>
<del class="diff-old">argument
and
updates
</del>
</a>,
<ins class="diff-chg">with
</ins>
the
<del class="diff-old">Thing
Description
.
Throws
on
error.
Returns
</del>
<ins class="diff-chg">difference
that
making
</ins>
a
<del class="diff-old">reference
</del>
<ins class="diff-chg">request
</ins>
to
the
<del class="diff-old">same
object
for
supporting
chaining.
</del>
<ins class="diff-chg">underlying
platform
<em class="rfc2119" title="MAY">MAY</em>
be
implemented
with
local
methods
or
libraries
and
don't
necessarily
need
to
involve
network
operations.
</ins>
</p><del class="diff-old">5.7
</del><p>
The
<del class="diff-old">addEvent()
method
</del>
<ins class="diff-chg">implementation
of
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins>
</a>
<del class="diff-old">Adds
</del>
<ins class="diff-chg">interface
in
</ins>
an
<del class="diff-old">event
</del>
<a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ExposedThing
</ins></a><ins class="diff-chg">
provide
the
</ins><i><ins class="diff-chg">
default
</ins></i><ins class="diff-chg">
methods
to
interact
</ins>
with
<del class="diff-old">name
defined
by
</del>
the
<del class="diff-old">name
argument
</del>
<a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ExposedThing
</ins></a>.</p><p><ins class="diff-chg">
After
constructing
an
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ExposedThing
</ins></a>,<ins class="diff-chg">
a
script
can
initialize
its
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Properties
</ins></a>
and
<del class="diff-old">qualifiers
</del>
<ins class="diff-chg">can
set
up
the
optional
read,
write
</ins>
and
<del class="diff-old">initialization
value
</del>
<ins class="diff-chg">action
request
handlers
(the
default
ones
are
</ins>
provided
by
the
<del class="diff-old">event
argument
of
type
EventFragment
to
</del>
<ins class="diff-chg">implementation).
The
script
provided
handlers
<em class="rfc2119" title="MAY">MAY</em>
use
</ins>
the
<del class="diff-old">Thing
object
and
updates
</del>
<ins class="diff-chg">default
handlers,
thereby
extending
</ins>
the
<del class="diff-old">Thing
Description
.
Throws
on
error.
Returns
a
reference
to
</del>
<ins class="diff-chg">default
behavior,
but
they
can
also
bypass
them,
overriding
</ins>
the
<del class="diff-old">same
object
for
supporting
chaining.
</del>
<ins class="diff-chg">default
behavior.
Finally,
the
script
would
call
</ins><a href="#the-expose-method" class="respec-offending-element" title="Linter (local-refs-exist): Broken local reference found in document. Please fix the links mentioned. See developer console. Occured" id="respec-offender-linter-local-refs-exist-broken-local-reference-found-in-document-please-fix-the-links-mentioned-see-developer-console-occured-0">
<del class="diff-old">5.8
The
</del>
<code>
<del class="diff-old">removeEvent()
</del>
<ins class="diff-chg">expose()
</ins>
</code>
<del class="diff-old">method
</del>
</a>
<del class="diff-old">Removes
the
event
specified
by
the
name
argument
and
updates
</del>
<ins class="diff-chg">on
</ins>
the
<del class="diff-old">Thing
Description
.
Returns
a
reference
</del>
<a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ExposedThing
</ins></a><ins class="diff-chg">
in
order
</ins>
to
<del class="diff-old">the
same
object
for
supporting
chaining.
</del>
<ins class="diff-chg">start
serving
external
requests.
</ins>
</p></section><del class="diff-old">5.9
</del><section data-dfn-for="PropertyReadHandler" id="the-propertyreadhandler-callback"><h3 id="x7-3-the-propertyreadhandler-callback"><bdi class="secno">7.3 </bdi>
The
<dfn data-dfn-type="dfn" id="dfn-propertyreadhandler">
PropertyReadHandler
</dfn>
callback
<a class="self-link" aria-label="§" href="#the-propertyreadhandler-callback"></a></h3><p>
A
function
that
is
called
when
an
external
request
for
reading
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
is
<del class="diff-old">received.
</del>
<ins class="diff-chg">received
and
defines
what
to
do
with
such
requests.
</ins>
It
<del class="diff-old">should
return
</del>
<ins class="diff-chg">returns
</ins>
a
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-27">
Promise
</a>
and
resolves
it
<del class="diff-old">with
</del>
<ins class="diff-chg">when
</ins>
the
value
of
the
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
matching
the
<code>
name
</code>
argument
<del class="diff-old">to
the
setPropertyReadHandler
function,
or
rejects
with
an
error
if
the
property
is
not
found
or
the
value
cannot
be
retrieved.
5.10
The
PropertyWriteHandler
callback
A
function
that
is
called
when
an
external
request
for
writing
a
Property
is
received.
It
is
given
the
requested
new
value
as
argument
and
should
return
a
Promise
which
</del>
is
<del class="diff-old">resolved
when
the
value
of
the
Property
that
matches
the
name
argument
has
been
updated
with
value
,
</del>
<ins class="diff-chg">obtained,
</ins>
or
rejects
with
an
error
if
the
property
is
not
found
or
the
value
cannot
be
<del class="diff-old">updated.
Editor's
note
Note
that
this
function
is
invoked
by
implementations
before
the
property
is
updated
and
it
actually
defines
what
to
do
when
a
write
request
is
received.
The
code
in
this
callback
function
can
invoke
the
read()
method
to
find
out
the
old
value
of
the
property,
if
needed.
Therefore
the
old
value
is
not
provided
to
this
function.
5.11
The
ActionHandler
callback
A
function
called
with
a
parameters
dictionary
argument
assembled
by
the
WoT
runtime
based
on
the
Thing
Description
and
the
external
client
request.
It
returns
a
Promise
that
rejects
with
an
error
or
resolves
if
the
action
is
successful
or
ongoing
(may
also
resolve
with
a
control
object
such
as
an
Observable
for
actions
that
need
progress
notifications
or
that
can
be
canceled).
</del>
<ins class="diff-chg">retrieved.
</ins>
</p></section><del class="diff-old">5.12
</del><section id="the-setpropertyreadhandler-method"><h3 id="x7-4-the-setpropertyreadhandler-method"><bdi class="secno">7.4 </bdi>
The
<dfn data-dfn-type="method" data-export="" id="dom-exposedthing-setpropertyreadhandler" data-idl="operation" data-title="
setPropertyReadHandler()
" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt="ExposedThing.setPropertyReadHandler()|ExposedThing.setPropertyReadHandler|setPropertyReadHandler()|setPropertyReadHandler"><code>
setPropertyReadHandler()
</code></dfn>
method
<a class="self-link" aria-label="§" href="#the-setpropertyreadhandler-method"></a></h3><p>
Takes
<code>
name
</code>
as
string
argument
and
<code>
readHandler
</code>
as
argument
of
type
<a href="#dfn-propertyreadhandler" class="internalDFN" data-link-type="dfn">
PropertyReadHandler
</a>.
Sets
the
<ins class="diff-new">service
</ins>
handler
<del class="diff-old">function
</del>
for
reading
the
specified
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
matched
by
<code>
name
</code>.
Throws
on
error.
Returns
a
reference
to
<del class="diff-old">the
same
</del>
<var>
<ins class="diff-chg">this
</ins></var>
object
for
supporting
chaining.
</p><p>
The
<code>
readHandler
</code>
callback
function
<del class="diff-old">will
</del>
<ins class="diff-chg">should
</ins>
implement
reading
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
and
<em class="rfc2119" title="SHOULD">SHOULD</em>
be
called
by
implementations
when
a
request
for
reading
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
is
received
from
the
underlying
platform.
</p><p>
There
<del class="diff-old"><em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
<ins class="diff-chg"><em class="rfc2119" title="MUST">MUST</em>
</ins>
be
at
most
one
handler
for
any
given
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-40">
Property
<del class="diff-old">and
</del>
</a>,
<ins class="diff-chg">so
</ins>
newly
added
handlers
<ins class="diff-new"><em class="rfc2119" title="MUST">MUST</em>
</ins>
replace
the
<del class="diff-old">old
</del>
<ins class="diff-chg">previous
</ins>
handlers.
If
no
handler
is
initialized
for
any
given
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>,
implementations
<em class="rfc2119" title="SHOULD">SHOULD</em>
implement
a
default
property
read
<del class="diff-old">handler.
</del>
<ins class="diff-chg">handler
based
on
the
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a>.
</p></section><section id="handling-property-read-requests"><h3 id="x7-5-handling-property-read-requests"><bdi class="secno">7.5 </bdi>
<ins class="diff-chg">Handling
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
read
requests
</ins><a class="self-link" aria-label="§" href="#handling-property-read-requests"></a></h3><div><p>When
<del class="diff-old">an
external
</del>
<ins class="diff-chg">a
network
</ins>
request
for
reading
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
<var>
propertyName
</var>
is
<del class="diff-old">received,
</del>
<ins class="diff-chg">received
by
</ins>
the
<del class="diff-old">runtime
<em class="rfc2119" title="SHOULD">SHOULD</em>
execute
</del>
<ins class="diff-chg">implementation,
run
</ins>
the
following
steps:</p>
<ol>
<li>
<del class="diff-old">Return
a
Promise
promise
and
execute
the
next
steps
in
parallel
.
</del>
If
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
with
<var>
propertyName
</var>
does
not
exist,
<del class="diff-old">reject
promise
with
a
</del>
<ins class="diff-chg">return
</ins>
<code>
ReferenceError
</code>
<ins class="diff-new">in
the
reply
</ins>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise,
if
no
</del>
<ins class="diff-chg">If
there
is
a
user
provided
</ins>
read
handler
<del class="diff-old">has
been
defined
for
</del>
<ins class="diff-chg">registered
with
</ins><code><ins class="diff-chg">
setPropertyReadHandler()
</ins></code>,<ins class="diff-chg">
invoke
that
wih
</ins>
<var>
propertyName
</var>,
<del class="diff-old">resolve
promise
with
</del>
<ins class="diff-chg">return
</ins>
the
value
<del class="diff-old">of
the
Property
named
propertyName
provided
by
</del>
<ins class="diff-chg">with
</ins>
the
<del class="diff-old">runtime
implementation
</del>
<ins class="diff-chg">reply
</ins>
and
terminate
these
steps.
</li>
<li>
Otherwise,
<ins class="diff-new">if
there
is
a
default
read
handler
provided
by
the
implementation,
</ins>
invoke
<ins class="diff-new">it
with
</ins><var><ins class="diff-new">
propertyName
</ins></var>,<ins class="diff-new">
return
</ins>
the
<del class="diff-old">read
</del>
<ins class="diff-chg">value
with
the
reply
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
if
there
is
no
default
</ins>
handler
<del class="diff-old">associated
</del>
<ins class="diff-chg">defined
by
the
implementation,
return
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-42"><ins class="diff-chg">
NotSupportedError
</ins></a>
with
<ins class="diff-new">the
reply
and
terminate
these
steps.
</ins></li></ol></div></section><section id="handling-property-observe-requests"><h3 id="x7-6-handling-property-observe-requests"><bdi class="secno">7.6 </bdi><ins class="diff-new">
Handling
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a><ins class="diff-new">
observe
requests
</ins><a class="self-link" aria-label="§" href="#handling-property-observe-requests"></a></h3><div><ins class="diff-new">
When
a
network
request
for
observing
a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a>
<var>
propertyName
<del class="diff-old">.
</del>
</var>
<ins class="diff-chg">is
received
by
the
implementation,
run
the
following
steps:
</ins><ol><li>
If
<del class="diff-old">it
rejects,
then
reject
</del>
<ins class="diff-chg">a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
with
</ins>
<var>
<del class="diff-old">promise
</del>
<ins class="diff-chg">propertyName
</ins>
</var>
<del class="diff-old">with
</del>
<ins class="diff-chg">does
not
exist,
return
an
error
in
</ins>
the
<del class="diff-old">same
error,
and
resolve
promise
</del>
<ins class="diff-chg">reply
(as
defined
in
the
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins>
</a>
<del class="diff-old">with
</del>
<ins class="diff-chg">)
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Save
</ins>
the
<del class="diff-old">same
value.
</del>
<ins class="diff-chg">request
sender
information
to
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
's
</ins><a href="#dfn-internal-observer-list" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
internal
observer
list
</ins></a><ins class="diff-chg">
in
order
to
be
able
to
notify
about
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
value
changes.
</ins>
</li>
</ol>
</div></section><del class="diff-old">5.13
</del><section data-dfn-for="PropertyWriteHandler" id="the-propertywritehandler-callback"><h3 id="x7-7-the-propertywritehandler-callback"><bdi class="secno">7.7 </bdi>
The
<dfn data-dfn-type="dfn" id="dfn-propertywritehandler">
<ins class="diff-chg">PropertyWriteHandler
</ins></dfn><ins class="diff-chg">
callback
</ins><a class="self-link" aria-label="§" href="#the-propertywritehandler-callback"></a></h3><p><ins class="diff-chg">
A
function
that
is
called
when
an
external
request
for
writing
a
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
is
received
and
defines
what
to
do
with
such
requests.
It
expects
the
requested
new
</ins>
<code>
<del class="diff-old">setPropertyWriteHandler()
</del>
<ins class="diff-chg">value
</ins>
</code>
<ins class="diff-chg">as
argument
and
returns
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-28"><ins class="diff-chg">
Promise
</ins></a><ins class="diff-chg">
which
is
resolved
when
the
value
of
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
that
matches
the
</ins><code><ins class="diff-chg">
name
</ins></code><ins class="diff-chg">
argument
has
been
updated
with
</ins><code><ins class="diff-chg">
value
</ins></code>,<ins class="diff-chg">
or
rejects
with
an
error
if
the
property
is
not
found
or
the
value
cannot
be
updated.
</ins></p><div class="note" id="issue-container-generatedID-8"><div role="heading" class="ednote-title marker" id="h-ednote-3" aria-level="4"><span>Editor's note</span></div><p class=""><ins class="diff-chg">
Note
that
the
code
in
this
callback
function
can
read
the
property
before
updating
it
in
order
to
find
out
the
old
value,
if
needed.
Therefore
the
old
value
is
not
provided
to
this
function.
</ins></p></div></section><section id="the-setpropertywritehandler-method"><h3 id="x7-8-the-setpropertywritehandler-method"><bdi class="secno">7.8 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-exposedthing-setpropertywritehandler" data-idl="operation" data-title="
setPropertyWriteHandler()

" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt="ExposedThing.setPropertyWriteHandler()|ExposedThing.setPropertyWriteHandler|setPropertyWriteHandler()|setPropertyWriteHandler"><code><ins class="diff-chg">
setPropertyWriteHandler()
</ins>
</code></dfn>
method
<a class="self-link" aria-label="§" href="#the-setpropertywritehandler-method"></a></h3><p>
Takes
<code>
name
</code>
as
string
argument
and
<code>
writeHandler
</code>
as
argument
of
type
<a href="#dfn-propertywritehandler" class="internalDFN" data-link-type="dfn">
PropertyWriteHandler
</a>.
Sets
the
<ins class="diff-new">service
</ins>
handler
<del class="diff-old">function
</del>
for
writing
the
specified
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
matched
by
<code>
name
</code>.
Throws
on
error.
Returns
a
reference
to
<del class="diff-old">the
same
</del>
<var>
<ins class="diff-chg">this
</ins></var>
object
for
supporting
chaining.
</p><p>
There
<del class="diff-old"><em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
<ins class="diff-chg"><em class="rfc2119" title="MUST">MUST</em>
</ins>
be
at
most
one
write
handler
for
any
given
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-41">
Property
<del class="diff-old">and
</del>
</a>,
<ins class="diff-chg">so
</ins>
newly
added
handlers
<ins class="diff-new"><em class="rfc2119" title="MUST">MUST</em>
</ins>
replace
the
<del class="diff-old">old
</del>
<ins class="diff-chg">previous
</ins>
handlers.
If
no
write
handler
is
initialized
for
any
given
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>,
implementations
<em class="rfc2119" title="SHOULD">SHOULD</em>
implement
default
property
update
and
notifying
observers
on
<del class="diff-old">change.
</del>
<ins class="diff-chg">change,
based
on
the
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a>.
</p></section><section id="handling-property-write-requests"><h3 id="x7-9-handling-property-write-requests"><bdi class="secno">7.9 </bdi>
<ins class="diff-chg">Handling
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
write
requests
</ins><a class="self-link" aria-label="§" href="#handling-property-write-requests"></a></h3><div><p>When
<del class="diff-old">an
external
</del>
<ins class="diff-chg">a
network
</ins>
request
for
writing
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
<var>
propertyName
</var>
with
a
new
value
<var>
value
</var>
is
received,
<del class="diff-old">the
runtime
</del>
<ins class="diff-chg">implementations
</ins>
<em class="rfc2119" title="SHOULD">SHOULD</em>
<del class="diff-old">execute
</del>
<ins class="diff-chg">run
</ins>
the
following
<del class="diff-old">steps:
Return
a
Promise
promise
and
execute
the
next
</del>
<dfn data-dfn-type="dfn" id="dfn-update-property-steps-in-parallel">
<ins class="diff-chg">update
property
</ins>
steps
<del class="diff-old">in
parallel
.
</del>
</dfn>,
<ins class="diff-chg">given
</ins><var><ins class="diff-chg">
propertyName
</ins></var>,<var><ins class="diff-chg">
value
</ins></var><ins class="diff-chg">
and
</ins><var><ins class="diff-chg">
mode
</ins></var><ins class="diff-chg">
set
to
</ins><code><ins class="diff-chg">
"single"
</ins></code>:</p><ol>
<li>
If
a
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
with
<var>
propertyName
</var>
does
not
exist,
<del class="diff-old">reject
promise
with
a
</del>
<ins class="diff-chg">return
</ins>
<code>
ReferenceError
</code>
<ins class="diff-new">in
the
reply
</ins>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise,
</del>
<ins class="diff-chg">If
there
is
a
user
provided
write
handler
registered
with
</ins><code><ins class="diff-chg">
setPropertyWriteHandler()
</ins></code>,<ins class="diff-chg">
or
</ins>
if
<del class="diff-old">no
</del>
<ins class="diff-chg">there
is
a
default
</ins>
write
<ins class="diff-new">handler,
</ins><ol><li><ins class="diff-new">
Invoke
the
</ins>
handler
<del class="diff-old">has
been
defined
for
</del>
<ins class="diff-chg">with
</ins>
<var>
propertyName
<del class="diff-old">,
</del>
</var>.
<ins class="diff-chg">If
it
fails,
return
</ins>
the
<del class="diff-old">runtime
implementation
<em class="rfc2119" title="SHOULD">SHOULD</em>
update
</del>
<ins class="diff-chg">error
in
</ins>
the
<ins class="diff-chg">reply
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise,
if
</ins><var><ins class="diff-chg">
mode
</ins></var><ins class="diff-chg">
is
</ins><code><ins class="diff-chg">
"single"
</ins></code>,<ins class="diff-chg">
reply
to
the
request
with
the
new
value,
following
to
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a>.</li><li><ins class="diff-chg">
For
each
item
stored
in
the
</ins><a href="#dfn-internal-observer-list" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
internal
observer
list
</ins></a><ins class="diff-chg">
of
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Property
</a>
<del class="diff-old">value
</del>
with
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">propertyName
</ins>
</var>,
<del class="diff-old">resolve
promise
</del>
<ins class="diff-chg">send
an
observe
reply
with
the
new
value
attached.
</ins></li></ol></li><li><ins class="diff-chg">
If
there
is
no
handler
to
handle
the
request,
return
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-43"><ins class="diff-chg">
NotSupportedError
</ins></a><ins class="diff-chg">
in
the
reply
</ins>
and
terminate
these
steps.
</li>
<del class="diff-old">Otherwise,
invoke
</del>
</ol>
</div><ins class="diff-chg">&gt;
</ins><div><ins class="diff-chg">
When
a
network
request
for
writing
multiple
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Properties
</ins></a><ins class="diff-chg">
given
in
an
object
</ins><var><ins class="diff-chg">
propertyNames
</ins></var><ins class="diff-chg">
is
received,
run
</ins>
the
<del class="diff-old">write
handler
associated
</del>
<ins class="diff-chg">following
steps:
</ins><ol><li><ins class="diff-chg">
For
each
property
</ins>
with
<ins class="diff-new">key
</ins>
<var>
<del class="diff-old">propertyName
</del>
<ins class="diff-chg">name
</ins>
</var>
<del class="diff-old">providing
</del>
<ins class="diff-chg">and
value
</ins>
<var>
value
</var>
<del class="diff-old">as
argument.
If
it
rejects,
then
reject
</del>
<ins class="diff-chg">defined
in
</ins>
<var>
<del class="diff-old">promise
with
</del>
<ins class="diff-chg">propertyNames
</ins></var>,<ins class="diff-chg">
run
</ins>
the
<del class="diff-old">same
error,
and
resolve
promise
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-45">
<ins class="diff-chg">update
property
steps
</ins>
</a>
with
<var>
<ins class="diff-new">name
</ins></var>,<var><ins class="diff-new">
value
</ins></var><ins class="diff-new">
and
</ins><var><ins class="diff-new">
mode
</ins></var><ins class="diff-new">
set
to
</ins><code><ins class="diff-new">
"multiple"
</ins></code>.</li><li><ins class="diff-new">
Reply
to
</ins>
the
<del class="diff-old">same
value.
</del>
<ins class="diff-chg">request
(by
sending
a
single
or
multiple
replies)
according
to
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a><ins class="diff-chg">
defined
for
the
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a>.
</li>
</ol>
</div></section><del class="diff-old">5.14
</del><section data-dfn-for="ActionHandler" id="the-actionhandler-callback"><h3 id="x7-10-the-actionhandler-callback"><bdi class="secno">7.10 </bdi>
The
<dfn data-dfn-type="dfn" id="dfn-actionhandler">
<ins class="diff-chg">ActionHandler
</ins></dfn><ins class="diff-chg">
callback
</ins><a class="self-link" aria-label="§" href="#the-actionhandler-callback"></a></h3><p><ins class="diff-chg">
A
function
that
is
called
when
an
external
request
for
invoking
an
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a><ins class="diff-chg">
is
received
and
defines
what
to
do
with
such
requests.
It
is
invoked
with
a
</ins>
<code>
<del class="diff-old">setActionHandler()
</del>
<ins class="diff-chg">params
</ins>
</code>
<ins class="diff-chg">dictionary
argument.
It
returns
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-29"><ins class="diff-chg">
Promise
</ins></a><ins class="diff-chg">
that
rejects
with
an
error
or
resolves
if
the
action
is
successful.
</ins></p></section><section id="the-setactionhandler-method"><h3 id="x7-11-the-setactionhandler-method"><bdi class="secno">7.11 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-exposedthing-setactionhandler" data-idl="operation" data-title="
setActionHandler()

" data-dfn-for="ExposedThing" data-type="ExposedThing" data-lt="ExposedThing.setActionHandler()|ExposedThing.setActionHandler|setActionHandler()|setActionHandler"><code><ins class="diff-chg">
setActionHandler()
</ins>
</code></dfn>
method
<a class="self-link" aria-label="§" href="#the-setactionhandler-method"></a></h3><p>
Takes
<code>
name
</code>
as
string
argument
and
<code>
action
</code>
as
argument
of
type
<a href="#dfn-actionhandler" class="internalDFN" data-link-type="dfn">
ActionHandler
</a>.
Sets
the
handler
function
for
the
specified
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
matched
by
<code>
name
</code>.
Throws
on
error.
Returns
a
reference
to
<del class="diff-old">the
same
</del>
<var>
<ins class="diff-chg">this
</ins></var>
object
for
supporting
chaining.
</p><p>
The
<code>
action
</code>
callback
function
will
implement
an
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
and
<em class="rfc2119" title="SHOULD">SHOULD</em>
be
called
by
implementations
when
a
request
for
invoking
the
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
is
received
from
the
underlying
platform.
</p><p>
There
<del class="diff-old"><em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
<ins class="diff-chg"><em class="rfc2119" title="MUST">MUST</em>
</ins>
be
at
most
one
handler
for
any
given
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-46">
Action
<del class="diff-old">and
</del>
</a>,
<ins class="diff-chg">so
</ins>
newly
added
handlers
<ins class="diff-new"><em class="rfc2119" title="MUST">MUST</em>
</ins>
replace
the
<del class="diff-old">old
</del>
<ins class="diff-chg">previous
</ins>
handlers.
</p></section><section id="handling-action-requests"><h3 id="x7-12-handling-action-requests"><bdi class="secno">7.12 </bdi>
<ins class="diff-chg">Handling
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a><ins class="diff-chg">
requests
</ins><a class="self-link" aria-label="§" href="#handling-action-requests"></a></h3><div><p>When
<del class="diff-old">an
external
</del>
<ins class="diff-chg">a
network
</ins>
request
for
invoking
the
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
identified
by
<var>
name
</var>
is
received,
the
runtime
<em class="rfc2119" title="SHOULD">SHOULD</em>
execute
the
following
steps:</p>
<ol>
<li>
<del class="diff-old">Return
a
Promise
promise
and
execute
the
next
steps
in
parallel
.
</del>
If
an
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
identified
by
<var>
name
</var>
does
not
exist,
<del class="diff-old">reject
promise
with
a
</del>
<ins class="diff-chg">return
</ins>
<code>
ReferenceError
</code>
<ins class="diff-new">in
the
reply
</ins>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise,
if
no
</del>
<ins class="diff-chg">If
there
is
a
user
provided
</ins>
action
handler
<del class="diff-old">has
been
defined
for
</del>
<ins class="diff-chg">registered
with
</ins><code><ins class="diff-chg">
setActionHandler()
</ins></code>,<ins class="diff-chg">
invoke
that
wih
</ins>
<var>
name
</var>,
<del class="diff-old">reject
promise
</del>
<ins class="diff-chg">return
the
resulting
value
</ins>
with
<del class="diff-old">a
ReferenceError
</del>
<ins class="diff-chg">the
reply
</ins>
and
terminate
these
steps.
</li>
<li>
<del class="diff-old">Otherwise,
invoke
the
Action
handler
associated
with
name
.
If
it
rejects
with
error
,
then
reject
promise
with
the
same
error
,
otherwise
if
it
resolves
with
value
,
then
resolve
promise
</del>
<ins class="diff-chg">Otherwise
return
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-44"><ins class="diff-chg">
NotSupportedError
</ins>
</a>
with
the
<del class="diff-old">same
value
.
</del>
<ins class="diff-chg">reply
and
terminate
these
steps.
</ins>
</li>
</ol>
</div></section><del class="diff-old">5.15
Examples
</del><section id="the-emitevent-method"><h3 id="x7-13-the-emitevent-method"><bdi class="secno">7.13 </bdi>
<ins class="diff-chg">The
</ins><dfn data-dfn-type="method" data-export="" id="dom-exposedthing-emitevent" data-idl="operation" data-title="
emitEvent()
" data-dfn-for="ExposedThing" data-type="void" data-lt="ExposedThing.emitEvent()|ExposedThing.emitEvent|emitEvent()|emitEvent"><code><ins class="diff-chg">
emitEvent()
</ins></code></dfn><ins class="diff-chg">
method
</ins>
<a class="self-link" aria-label="§" href="#the-emitevent-method"></a></h3><del class="diff-old">Below
some
ExposedThing
interface
examples
are
given.
Example
5
:
Create
a
new
exposed
Thing
with
a
simple
property
{
temperatureValueDefinition = {
,
,

<p>};
temperaturePropertyDefinition = temperatureValueDefinition;</p>
<p>temperaturePropertyDefinition.forms = [ ... ];
thing = WoT.produce({
,
: {
: temperaturePropertyDefinition
},
: {
: {
,
: {
: temperatureValueDefinition
},
,
: []
},
},
: {
: temperatureValueDefinition
},
: []
});
thing.expose();
, thing);</p>
<p>setInterval(  () =&gt; {
;
].read();
(old &lt; mock) {
].write(mock);
thing.emitEvent(, mock);
}
}, );
}  (err) {</p>
<ul>
<li>err);
}
Example
6
:
Create
a
new
exposed
Thing
with
object
property
{
statusValueDefinition = {
,
: {
: {
,
,
,</li>
</ul>
<p>},
: {
,
,
,
: {
,
,</p>
<p>}
}
};
statusPropertyDefinition = statusValueDefinition;</p>
<p>statusPropertyDefinition[] = [];
thing = WoT.produce({
,
: {
: {
,
,
,
,
},
: statusPropertyDefinition
},
: {
: {
,
,
: {
: statusValueDefinition;
},
: []
},
},
: {
: statusValueDefinition;
},
: []
});
thing.expose().then( {
thing.register();
});
}  (err) {</p>
<ul>
<li>err);
}
Example
7
:
Create
a
new
exposed
Thing
from
a
Thing
Description
'{ <br>"name": "mySensor", <br>"@context": [ "<a href="http://www.w3.org/ns/td&quot;,%5C">http://www.w3.org/ns/td",\</a>
"<a href="https://w3c.github.io/wot/w3c-wot-common-context.jsonld&quot;">https://w3c.github.io/wot/w3c-wot-common-context.jsonld"</a> ],<br>"@type": [ "Thing", "Sensor" ], <br>"geo:location": "testspace", <br>"properties": { <br>"prop1": { <br>"type": "number",<br>"@type": [ "Property", "Temperature" ], <br>"saref:TemperatureUnit": "degree_Celsius" <br>} } }';
{</li>
</ul>
<p>thing = WoT.produce(thingDescription);</p>
<p>;
thing.setPropertyReadHandler(name, () =&gt; {</p>
<ul>
<li>name);
{
;
resolve(examplePropertyValue);
},
e =&gt; {
);
});
});
thing.expose();
} (err) {</li>
<li>err);
}
Example
8
<div><p><ins class="diff-chg">Takes
</ins><var><ins class="diff-chg">
name
</ins></var><ins class="diff-chg">
as
string
argument
denoting
an
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins>
</a>
<del class="diff-old">:
Create
a
new
exposed
Thing
from
a
TD
URI</del></p>
<p>WoT.fetch( {</p>
<p>thing = WoT.produce(td);</p>
<p>});</p></div></li>
</ul>
<p>6.
Data
types</p>
<p><ins class="diff-chg">name,
</ins>
and
<del class="diff-old">structures
</del>
<ins class="diff-chg">a
</ins><var><ins class="diff-chg">
data
</ins></var><ins class="diff-chg">
argument
of
</ins><code><ins class="diff-chg">
any
</ins></code><ins class="diff-chg">
type.
</ins>
The
<del class="diff-old">[
WOT-TD
]
specification
defines
</del>
<ins class="diff-chg">method
<em class="rfc2119" title="MUST">MUST</em>
run
</ins>
the
<del class="diff-old">WoT
information
model
,
i.e.
</del>
<ins class="diff-chg">following
steps:
</ins></p>
<ol><li><ins class="diff-chg">
If
invoking
this
method
is
not
allowed
for
</ins>
the
<del class="diff-old">data
types
</del>
<ins class="diff-chg">current
scripting
context
for
security
reasons,
throw
</ins><code><ins class="diff-chg">
SecurityError
</ins></code>
and
<del class="diff-old">data
structures
used
in
WoT
Interactions
.
In
this
API
</del>
<ins class="diff-chg">terminate
</ins>
these
<del class="diff-old">definitions
translate
to
dictionary
objects
that
are
extended
</del>
<ins class="diff-chg">steps.
</ins></li><li><ins class="diff-chg">
If
an
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a>
with
<del class="diff-old">methods
by
</del>
the
<del class="diff-old">interfaces
defined
</del>
<ins class="diff-chg">name
</ins><var><ins class="diff-chg">
name
</ins></var><ins class="diff-chg">
is
not
found
</ins>
in
<del class="diff-old">this
specification.
In
order
</del>
<var>
<ins class="diff-chg">this.getThingDescription().events
</ins></var>,<ins class="diff-chg">
throw
</ins><code><ins class="diff-chg">
NotFoundError
</ins></code><ins class="diff-chg">
and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Make
a
request
</ins>
to
<del class="diff-old">avoid
duplication
of
definitions,
references
</del>
<ins class="diff-chg">the
underlying
platform
</ins>
to
<del class="diff-old">these
</del>
<ins class="diff-chg">send
an
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
with
</ins><var>
data
<del class="diff-old">types
and
structures
is
defined
in
this
section,
but
for
their
full
description
please
refer
to
</del>
</var>
<ins class="diff-chg">attached
as
property,
using
</ins>
the
<del class="diff-old">Thing
Description
specification
.
6.1
</del>
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins></a>,<ins class="diff-chg">
then
terminate
these
steps.
</ins></li></ol>
</del></section><section id="the-dataschema-expose-dictionary-and-its-subclasses-method"><h3 id="x7-14-the-dataschema-expose-dictionary-and-its-subclasses-method"><bdi class="secno">7.14 </bdi>
The
<del class="diff-old">DataSchema
</del>
<dfn data-dfn-type="method" data-export="" id="dom-exposedthing-expose" data-idl="operation" data-title="
expose()

" data-dfn-for="ExposedThing" data-type="Promise" data-lt="ExposedThing.expose()|ExposedThing.expose|expose()|expose"><code>
<ins class="diff-chg">expose()
</ins>
</code></dfn>
<del class="diff-old">dictionary
and
its
subclasses
</del>
<ins class="diff-chg">method
</ins>
<a class="self-link" aria-label="§" href="#the-dataschema-expose-dictionary-and-its-subclasses-method"></a></h3><del class="diff-old">Value
types
basically
represent
types
</del><div><p><ins class="diff-chg">Start
serving
external
requests
for
the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a>,<ins class="diff-chg">
so
</ins>
that
<del class="diff-old">may
be
used
in
JSON
object
definitions
and
are
used
in
ThingFragment
</del>
<a href="#dfn-wot-interactions" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
Interactions
</ins>
</a>
<del class="diff-old">to
define
</del>
<ins class="diff-chg">using
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
Properties
</a>,
<del class="diff-old">Event
s
and
</del>
<a href="#dfn-actions" class="internalDFN" data-link-type="dfn">
Action
</a>
<del class="diff-old">parameters.
Value
types
are
represented
as
dictionary
objects
whose
properties
</del>
<ins class="diff-chg">s
</ins>
and
<del class="diff-old">possible
sub-classes
are
defined
in
the
DataSchema
section
of
[
WOT-TD
].
One
property
of
all
DataSchema
</del>
<a href="#dfn-events" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Event
</ins>
</a>
<del class="diff-old">dictionary
is
</del>
<ins class="diff-chg">s
will
be
possible.
The
method
<em class="rfc2119" title="MUST">MUST</em>
run
</ins>
the
<del class="diff-old">type
property
whose
value
is
from
</del>
<ins class="diff-chg">following
steps:
</ins></p><ol><li><ins class="diff-chg">
Return
</ins>
a
<del class="diff-old">set
of
enumerated
strings
defined
in
the
DataSchema
section
of
[
WOT-TD
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-11">
<ins class="diff-chg">Promise
</ins>
</a>
<del class="diff-old">]
</del>
<var>
<ins class="diff-chg">promise
</ins></var>
and
<del class="diff-old">is
referred
as
DataType
in
this
specification.
Based
on
type
,
</del>
<ins class="diff-chg">execute
</ins>
the
<del class="diff-old">following
sub-classes
of
DataSchema
are
defined
</del>
<ins class="diff-chg">next
steps
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-47">
in
<del class="diff-old">[
WOT-TD
]:
BooleanSchema
,
NumberSchema
,
IntegerSchema
,
StringSchema
,
ObjectSchema
,
ArraySchema
</del>
<ins class="diff-chg">parallel
</ins>
</a>.
<del class="diff-old">6.2
The
</del>
</li>
<li>
<ins class="diff-chg">If
invoking
this
method
is
not
allowed
for
the
current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">SecurityScheme
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">dictionary
</del>
and
<del class="diff-old">its
subclasses
Security
metadata
is
represented
as
dictionary
objects
whose
properties
and
sub-classes
are
defined
in
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Run
</ins>
the
<del class="diff-old">SecurityScheme
section
of
[
WOT-TD
</del>
<a href="#dfn-expand-a-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">expand
a
TD
</ins>
</a>
<del class="diff-old">].
One
property
of
</del>
<ins class="diff-chg">steps
on
</ins>
the
<del class="diff-old">SecurityScheme
dictionary
is
</del>
<ins class="diff-chg">internal
slot
|<var>td</var>|.
</ins></li><li><ins class="diff-chg">
Run
</ins>
the
<del class="diff-old">scheme
property
whose
value
is
from
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-48">
<ins class="diff-chg">validate
</ins>
a
<del class="diff-old">set
of
enumerated
strings
defined
in
the
SecurityScheme
section
of
[
WOT-TD
</del>
<ins class="diff-chg">TD
</ins>
</a>
<del class="diff-old">].
Based
</del>
on
<ins class="diff-new">|<var>td</var>|.
If
that
fails,
reject
</ins><var><ins class="diff-new">
promise
</ins></var><ins class="diff-new">
with
</ins>
<code>
<del class="diff-old">type
,
multiple
subclasses
of
SecurityScheme
are
defined.
6.3
The
Link
</del>
<ins class="diff-chg">"TypeError"
</ins>
</code>
<del class="diff-old">dictionary
Represents
a
Web
Link
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
For
each
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins>
</a>
<del class="diff-old">with
properties
defined
</del>
<ins class="diff-chg">definition
</ins>
in
<del class="diff-old">the
Link
section
of
[
WOT-TD
].
6.4
The
Form
</del>
<var>
<ins class="diff-chg">this.instance.properties
</ins></var><ins class="diff-chg">
initialize
an
|
</ins><dfn data-dfn-type="dfn" id="dfn-internal-observer-list"><ins class="diff-chg">
internal
observer
list
</ins>
</dfn>
<del class="diff-old">dictionary
Represents
metadata
describing
service
details,
with
properties
defined
</del>
<ins class="diff-chg">|
internal
slot
</ins>
in
<ins class="diff-new">order
to
store
observe
request
data
needed
to
notify
</ins>
the
<del class="diff-old">Form
section
of
[
WOT-TD
].
6.5
The
InteractionFragment
dictionary
Represents
</del>
<ins class="diff-chg">observers
on
value
changes.
</ins></li><li><ins class="diff-chg">
Set
up
</ins>
the
<del class="diff-old">common
properties
of
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-49">
WoT
Interactions
<del class="diff-old">,
one
of
Property
,
Action
</del>
</a>
<del class="diff-old">or
Event
,
</del>
<ins class="diff-chg">based
on
introspecting
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
td
</ins></a>
as
<del class="diff-old">defined
</del>
<ins class="diff-chg">explained
</ins>
in
<ins class="diff-new">[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
and
[<cite><a class="bibref" href="#bib-wot-protocol-bindings" title="Web of Things Protocol Binding Templates" data-link-type="biblio">WOT-PROTOCOL-BINDINGS</a></cite>].
Make
a
request
to
</ins>
the
<del class="diff-old">InteractionPattern
</del>
<ins class="diff-chg">underlying
platform
to
initialize
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
<del class="diff-old">section
of
[
WOT-TD
</del>
<ins class="diff-chg">and
then
start
serving
external
requests
for
</ins><a href="#dfn-wot-interactions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
Interactions
</ins>
</a>
<del class="diff-old">].
Its
subclasses
are
referred
as
PropertyFragment
</del>
<ins class="diff-chg">(read,
write
and
observe
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Properties
</ins>
</a>,
<del class="diff-old">ActionFragment
</del>
<ins class="diff-chg">invoke
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins>
</a>
<ins class="diff-new">s
</ins>
and
<del class="diff-old">EventFragment
.
6.6
The
PropertyFragment
dictionary
</del>
<ins class="diff-chg">manage
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins>
</a>
<del class="diff-old">Represents
</del>
<ins class="diff-chg">subscriptions),
based
on
</ins>
the
<del class="diff-old">Property
interaction
data
that
initializes
a
ThingProperty
object.
Its
properties
</del>
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins></a>.<ins class="diff-chg">
The
details
</ins>
are
<del class="diff-old">defined
in
</del>
<ins class="diff-chg">private
to
</ins>
the
<del class="diff-old">Property
</del>
<ins class="diff-chg">implementations
</ins>
and
<del class="diff-old">InteractionPattern
sections
</del>
<ins class="diff-chg">out
</ins>
of
<del class="diff-old">[
WOT-TD
].
6.7
The
ActionFragment
dictionary
Represents
</del>
<ins class="diff-chg">scope
of
this
specification.
</ins></li><li><ins class="diff-chg">
If
there
was
an
error
during
</ins>
the
<del class="diff-old">Action
interaction
data
that
initializes
a
</del>
<ins class="diff-chg">request,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
an
</ins>
<code>
<del class="diff-old">ThingAction
</del>
<ins class="diff-chg">Error
</ins>
</code>
<del class="diff-old">object.
Its
properties
are
defined
in
the
Action
and
InteractionPattern
sections
of
[
WOT-TD
].
6.8
The
</del>
<ins class="diff-chg">object
</ins><var><ins class="diff-chg">
error
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">EventFragment
</del>
<ins class="diff-chg">error.message
</ins>
</code>
<del class="diff-old">dictionary
Represents
</del>
<ins class="diff-chg">set
to
</ins>
the
<del class="diff-old">Event
interaction
data
that
initializes
a
ThingEvent
object.
Its
properties
are
defined
in
</del>
<ins class="diff-chg">error
code
seen
by
</ins>
the
<del class="diff-old">Event
section
of
[
WOT-TD
</del>
<a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Protocol
Bindings
</ins>
</a>
<del class="diff-old">].
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise
resolve
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
and
terminate
these
steps.
</ins></li></ol></div></section><del class="diff-old">6.9
</del><section id="the-thingfragment-destroy-dictionary-method"><h3 id="x7-15-the-thingfragment-destroy-dictionary-method"><bdi class="secno">7.15 </bdi>
The
<del class="diff-old">ThingFragment
</del>
<dfn data-dfn-type="method" data-export="" id="dom-exposedthing-destroy" data-idl="operation" data-title="
destroy()

" data-dfn-for="ExposedThing" data-type="Promise" data-lt="ExposedThing.destroy()|ExposedThing.destroy|destroy()|destroy"><code>
<ins class="diff-chg">destroy()
</ins>
</code></dfn>
<del class="diff-old">dictionary
</del>
<ins class="diff-chg">method
</ins>
<a class="self-link" aria-label="§" href="#the-thingfragment-destroy-dictionary-method"></a></h3><del class="diff-old">The
ThingFragment
dictionary
is
defined
as
Thing
in
[
WOT-TD
].
It
is
a
dictionary
that
contains
properties
representing
semantic
metadata
and
interactions
(
Properties
,
Action
s
and
Event
s).
It
is
used
</del><div><p><ins class="diff-chg">Stop
serving
external
requests
</ins>
for
<del class="diff-old">initializing
an
internal
representation
of
a
</del>
<ins class="diff-chg">the
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn">
Thing
<del class="diff-old">Description
</del>
</a>
and
<del class="diff-old">its
properties
may
</del>
<ins class="diff-chg">destroy
the
object.
Note
that
eventual
unregistering
should
</ins>
be
<del class="diff-old">used
in
ThingFilter
.
6.10
</del>
<ins class="diff-chg">done
before
invoking
this
method.
</ins>
The
<del class="diff-old">ThingDescription
type
Serialized
representation
of
</del>
<ins class="diff-chg">method
<em class="rfc2119" title="MUST">MUST</em>
run
</ins>
the
<del class="diff-old">Thing
Description
(a
JSON-LD
</del>
<ins class="diff-chg">following
steps:
</ins></p><ol><li><ins class="diff-chg">
Return
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-30"><ins class="diff-chg">
Promise
</ins>
</a>
<del class="diff-old">document).
Note
In
</del>
<var>
<ins class="diff-chg">promise
</ins></var><ins class="diff-chg">
and
execute
the
next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.</li><li><ins class="diff-chg">
If
invoking
</ins>
this
<del class="diff-old">version
of
</del>
<ins class="diff-chg">method
is
not
allowed
for
</ins>
the
<del class="diff-old">API,
Thing
Description
s
are
represented
as
an
opaque
</del>
<ins class="diff-chg">current
scripting
context
for
security
reasons,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">USVString
</del>
<ins class="diff-chg">SecurityError
</ins>
</code>
<del class="diff-old">that
can
be
transmitted
between
devices.
7.
Interfaces
for
WoT
Interactions
The
data
types
</del>
and
<del class="diff-old">structures
imported
from
[
WOT-TD
]
are
extended
by
this
specification
in
order
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Make
a
request
</ins>
to
<del class="diff-old">provide
</del>
the
<del class="diff-old">interfaces
</del>
<ins class="diff-chg">underlying
platform
to
stop
serving
external
requests
</ins>
for
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-50">
WoT
Interactions
<del class="diff-old">.
Every
Thing
describes
its
metadata
as
defined
in
ThingFragment
,
and
basic
interactions
defined
as
Properties
</del>
</a>,
<del class="diff-old">Action
s
and
Event
s.
The
following
interfaces
are
used
for
representing
these
interactions.
7.1
The
</del>
<ins class="diff-chg">based
on
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins></a>.</li><li><ins class="diff-chg">
If
there
was
an
error
during
the
request,
reject
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
with
an
</ins>
<code>
<del class="diff-old">Interaction
</del>
<ins class="diff-chg">Error
</ins>
</code>
<del class="diff-old">interface
The
</del>
<ins class="diff-chg">object
</ins><var><ins class="diff-chg">
error
</ins></var><ins class="diff-chg">
with
</ins>
<code>
<del class="diff-old">Interaction
</del>
<ins class="diff-chg">error.message
</ins>
</code>
<del class="diff-old">interface
is
an
abstract
class
</del>
<ins class="diff-chg">set
</ins>
to
<del class="diff-old">represent
Thing
interactions:
Properties
,
Actions
</del>
<ins class="diff-chg">the
error
code
seen
by
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Protocol
Bindings
</ins>
</a>
and
<del class="diff-old">Events
.
</del>
<ins class="diff-chg">terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Otherwise
resolve
</ins><var><ins class="diff-chg">
promise
</ins></var><ins class="diff-chg">
and
terminate
these
steps.
</ins></li></ol>
</div></section><section id="exposedthing-examples"><h3 id="x7-16-exposedthing-examples"><bdi class="secno">7.16 </bdi><ins class="diff-chg">
ExposedThing
Examples
</ins><a class="self-link" aria-label="§" href="#exposedthing-examples"></a></h3><p>
The
<del class="diff-old">InteractionFragment
dictionary
holds
the
common
properties
of
PropertyFragment
,
ActionFragment
and
EventFragment
dictionaries
used
for
initializing
ThingProperty
,
</del>
<ins class="diff-chg">next
example
illustrates
how
to
create
an
</ins>
<code>
<del class="diff-old">ThingAction
</del>
<a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">ExposedThing
</ins>
</a>
<del class="diff-old">and
</del>
<del class="diff-old">ThingEvent
</del>
</code>
<ins class="diff-chg">based
on
a
partial
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins>
</a>
<del class="diff-old">objects
in
</del>
<ins class="diff-chg">object
constructed
beforehands.
</ins></p><div class="example" id="example-3-create-exposedthing-with-a-simple-property">
          <div class="marker">
      <a class="self-link" href="#example-3-create-exposedthing-with-a-simple-property">Example<bdi> 3</bdi></a><span class="example-title">: Create ExposedThing with a simple Property</span>
    </div> <pre class="highlight" aria-busy="false"><code class="hljs javascript">        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">let</span> temperaturePropertyDefinition = {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"number"</span>,
            <span class="hljs-attr">minimum</span>: <span class="hljs-number">-50</span>,
            <span class="hljs-attr">maximum</span>: <span class="hljs-number">10000</span>
          };
          <span class="hljs-keyword">let</span> tdFragment = {
            <span class="hljs-attr">properties</span>: {
              <span class="hljs-attr">temperature</span>: temperaturePropertyDefinition
            },
            <span class="hljs-attr">actions</span>: {
              <span class="hljs-attr">reset</span>: {
                <span class="hljs-attr">description</span>: <span class="hljs-string">"Reset the temperature sensor"</span>,
                <span class="hljs-attr">input</span>: {
                  <span class="hljs-attr">temperature</span>: temperatureValueDefinition
                },
                <span class="hljs-attr">output</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">forms</span>: []
              },
            },
            <span class="hljs-attr">events</span>: {
              <span class="hljs-attr">onchange</span>: temperatureValueDefinition
            }
          };
          <span class="hljs-keyword">let</span> thing1 = <span class="hljs-keyword">await</span> WOT.produce(tdFragment);
          <span class="hljs-comment">// initialize Properties</span>
          <span class="hljs-keyword">await</span> thing1.writeProperty(<span class="hljs-string">"temperature"</span>, <span class="hljs-number">0</span>);
          <span class="hljs-comment">// add service handlers</span>
          thing1.setPropertyReadHandler(<span class="hljs-string">"temperature"</span>, () =&gt; {
             <span class="hljs-keyword">return</span> readLocalTemperatureSensor();  <span class="hljs-comment">// Promise</span>
          });
          <span class="hljs-comment">// start serving requests</span>
          <span class="hljs-keyword">await</span> thing1.expose();
        } <span class="hljs-keyword">catch</span> (err) {
           <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Error creating ExposedThing: "</span> + err);
        }
</code></pre>
        </div><p><ins class="diff-chg">
The
next
example
illustrates
how
to
add
or
modify
</ins>
a
<del class="diff-old">ThingFragment
</del>
<a href="#dfn-properties" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Property
</ins>
</a>
<del class="diff-old">dictionary
used
for
creating
</del>
<ins class="diff-chg">definition
on
</ins>
an
<del class="diff-old">ExposedThing
object.
</del></p><p>readonly attribute
};
</p><p><ins class="diff-chg">existing
</ins>
<code>
<del class="diff-old">Interaction
</del>
<a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">ExposedThing
</ins>
</a>
<del class="diff-old">includes
InteractionFragment
</del>
</code>:
<ins class="diff-new">take
its
</ins><var><ins class="diff-new">
td
</ins></var><ins class="diff-new">
property,
add
or
modify
it,
then
create
another
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
ExposedThing
</ins>
</a>
<del class="diff-old">;
</del>
<ins class="diff-chg">with
that.
</ins></p><div class="example" id="example-4-add-an-object-property">
          <div class="marker">
      <a class="self-link" href="#example-4-add-an-object-property">Example<bdi> 4</bdi></a><span class="example-title">: Add an object Property</span>
    </div> <pre class="highlight" aria-busy="false"><code class="hljs javascript">        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// create a deep copy of thing1's TD</span>
          <span class="hljs-keyword">let</span> instance = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(thing1.td));
          <span class="hljs-keyword">const</span> statusValueDefinition = {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
            <span class="hljs-attr">properties</span>: {
              <span class="hljs-attr">brightness</span>: {
                <span class="hljs-attr">type</span>: <span class="hljs-string">"number"</span>,
                <span class="hljs-attr">minimum</span>: <span class="hljs-number">0.0</span>,
                <span class="hljs-attr">maximum</span>: <span class="hljs-number">100.0</span>,
                <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
              },
              <span class="hljs-attr">rgb</span>: {
                <span class="hljs-attr">type</span>: <span class="hljs-string">"array"</span>,
                <span class="hljs-string">"minItems"</span>: <span class="hljs-number">3</span>,
                <span class="hljs-string">"maxItems"</span>: <span class="hljs-number">3</span>,
                <span class="hljs-attr">items</span> : {
                    <span class="hljs-string">"type"</span> : <span class="hljs-string">"number"</span>,
                    <span class="hljs-string">"minimum"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"maximum"</span>: <span class="hljs-number">255</span>
                }
              }
          };
          instance[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"mySensor"</span>;
          instance.properties[<span class="hljs-string">"brightness"</span>] = {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"number"</span>,
            <span class="hljs-attr">minimum</span>: <span class="hljs-number">0.0</span>,
            <span class="hljs-attr">maximum</span>: <span class="hljs-number">100.0</span>,
            <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
          };
          instance.properties[<span class="hljs-string">"status"</span>] = statusValueDefinition;
          instance.actions[<span class="hljs-string">"getStatus"</span>] = {
            <span class="hljs-attr">description</span>: <span class="hljs-string">"Get status object"</span>,
            <span class="hljs-attr">input</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">output</span>: {
              <span class="hljs-attr">status</span> : statusValueDefinition;
            },
            <span class="hljs-attr">forms</span>: [...]
          };
          instance.events[<span class="hljs-string">"onstatuschange"</span>] = statusValueDefinition;
          instance.forms = [...];  <span class="hljs-comment">// update</span>
          <span class="hljs-keyword">var</span> thing2 = <span class="hljs-keyword">new</span> ExposedThing(instance);
          <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> add service handlers</span>
          <span class="hljs-keyword">await</span> thing2.expose();
          });
        } <span class="hljs-keyword">catch</span> (err) {
           <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Error creating ExposedThing: "</span> + err);
        }
</code></pre>
        </div></section></section><section data-dfn-for="ThingDiscovery" id="the-forms-thingdiscovery-read-only-property-represents-the-protocol-bindings-initialization-data-and-interface"><h2 id="x8-the-forms-thingdiscovery-read-only-property-represents-the-protocol-bindings-initialization-data-and-interface"><bdi class="secno">8. </bdi>
The
<del class="diff-old">forms
</del>
<dfn data-dfn-type="dfn" id="dfn-thingdiscovery">
<ins class="diff-chg">ThingDiscovery
</ins>
</dfn>
<del class="diff-old">read-only
property
represents
the
protocol
bindings
initialization
data
and
</del>
<ins class="diff-chg">interface
</ins><a class="self-link" aria-label="§" href="#the-forms-thingdiscovery-read-only-property-represents-the-protocol-bindings-initialization-data-and-interface"></a></h2><p><ins class="diff-chg">
Discovery
</ins>
is
<del class="diff-old">initialized
by
</del>
<ins class="diff-chg">a
distributed
application
that
requires
provisioning
and
support
from
participating
network
nodes
(clients,
servers,
directory
services).
This
API
models
</ins>
the
<del class="diff-old">WoT
Runtime
.
</del>
<ins class="diff-chg">client
side
of
typical
discovery
schemes
supported
by
various
IoT
deployments.
</ins>
</p><del class="diff-old">7.2
</del><p>
The
<del class="diff-old">ThingProperty
interface
</del>
<a href="#dfn-thingdiscovery" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ThingDiscovery
</ins>
</a>
<ins class="diff-chg">object
is
constructed
given
a
filter
and
provides
the
properties
and
methods
controlling
the
discovery
process.
</ins></p><pre class="idl def"><span data-idl="" class="idlInterface" id="idl-def-thingdiscovery" data-title="ThingDiscovery">      [<span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface" data-cite-path="window-object.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface" data-lt="WorkerGlobalScope" data-cite-path="workers.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
      interface <dfn data-export="" data-dfn-type="interface" id="dom-thingdiscovery" data-idl="interface" data-title="ThingDiscovery" class="idlID" data-dfn-for="ThingDiscovery"><code>ThingDiscovery</code></dfn> {<span data-idl="" class="idlConstructor" id="idl-def-thingdiscovery-constructor-filter" data-title="constructor" data-dfn-for="ThingDiscovery">
        <dfn data-export="" data-dfn-type="constructor" id="dom-thingdiscovery-constructor" data-idl="constructor" data-title="constructor" data-dfn-for="ThingDiscovery" data-lt="ThingDiscovery.constructor()|ThingDiscovery.constructor|constructor()|constructor"><code>constructor</code></dfn>(optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-thingfilter" class="internalDFN" data-link-type="dfn">ThingFilter</a></span> <span class="idlParamName">filter</span> = null);</span><span data-idl="" class="idlAttribute" id="idl-def-thingdiscovery-filter" data-title="filter" data-dfn-for="ThingDiscovery">
        readonly attribute<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-thingfilter" class="internalDFN" data-link-type="dfn">ThingFilter</a>?</span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="attribute" href="#dom-thingdiscovery-filter"><code>filter</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-thingdiscovery-active" data-title="active" data-dfn-for="ThingDiscovery">
        readonly attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="attribute" href="#dom-thingdiscovery-active"><code>active</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-thingdiscovery-done" data-title="done" data-dfn-for="ThingDiscovery">
        readonly attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="attribute" href="#dom-thingdiscovery-done"><code>done</code></a>;</span><span data-idl="" class="idlAttribute" id="idl-def-thingdiscovery-error" data-title="error" data-dfn-for="ThingDiscovery">
        readonly attribute<span class="idlType"> <a data-xref-type="_IDL_" data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-error-objects">Error</a>?</span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="attribute" href="#dom-thingdiscovery-error"><code>error</code></a>;</span><span data-idl="" class="idlMethod" id="idl-def-thingdiscovery-start" data-title="start" data-dfn-for="ThingDiscovery"><span class="idlType">
        <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="method" href="#dom-thingdiscovery-start"><code>start</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-thingdiscovery-next" data-title="next" data-dfn-for="ThingDiscovery"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="method" href="#dom-thingdiscovery-next"><code>next</code></a>();</span><span data-idl="" class="idlMethod" id="idl-def-thingdiscovery-stop" data-title="stop" data-dfn-for="ThingDiscovery"><span class="idlType">
        <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="method" href="#dom-thingdiscovery-stop"><code>stop</code></a>();</span>
      };</span></pre><div class="note" id="issue-container-generatedID-9"><div role="heading" class="ednote-title marker" id="h-ednote-4" aria-level="3"><span>Editor's note</span></div><p class="">
The
<del class="diff-old">ThingProperty
</del>
<a href="#dfn-thingdiscovery" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ThingDiscovery
</ins>
</a>
interface
<del class="diff-old">is
used
in
</del>
<ins class="diff-chg">has
a
</ins>
<code>
<del class="diff-old">ConsumedThing
</del>
<ins class="diff-chg">next()
</ins>
</code>
<ins class="diff-chg">method
</ins>
and
<ins class="diff-chg">a
</ins>
<code>
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">done
</ins>
</code>
<del class="diff-old">objects
to
represent
Thing
Property
</del>
<ins class="diff-chg">property,
but
it
is
not
an
</ins><a href=""><ins class="diff-chg">
Iterable
</ins></a>.<ins class="diff-chg">
Look
into
</ins><a href="https://github.com/w3c/wot-scripting-api/issues/177"><ins class="diff-chg">
Issue
177
</ins>
</a>
<del class="diff-old">interactions.
</del>
<ins class="diff-chg">for
rationale.
</ins>
</p></div><p>
The
<del class="diff-old">PropertyFragment
dictionary
</del>
<dfn data-dfn-type="dfn" id="dfn-discovery-results">
<ins class="diff-chg">discovery
results
</ins></dfn><ins class="diff-chg">
internal
slot
</ins>
is
<del class="diff-old">used
</del>
<ins class="diff-chg">an
internal
queue
</ins>
for
<del class="diff-old">initializing
Property
</del>
<ins class="diff-chg">temporarily
storing
the
found
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins>
</a>
objects
<del class="diff-old">in
a
ThingFragment
dictionary
used
for
creating
an
ExposedThing
object.
It
<em class="rfc2119" title="MUST">MUST</em>
implement
one
of
</del>
<ins class="diff-chg">until
they
are
consumed
by
</ins>
the
<del class="diff-old">DataSchema
dictionaries.
</del></p><p>// getter for PropertyFragment properties</p><p>// get and set interface for the Property</p><p>};
ThingProperty
includes
Observable
;
The
ThingProperty

</p><p><ins class="diff-chg">application
using
the
</ins><a href="the-next-method"><ins class="diff-chg">
next()
</ins>
</a>
<del class="diff-old">interface
contains
all
</del>
<ins class="diff-chg">method.
Implementations
<em class="rfc2119" title="MAY">MAY</em>
optimize
</ins>
the
<del class="diff-old">properties
defined
</del>
<ins class="diff-chg">size
of
this
queue
based
</ins>
on
<del class="diff-old">PropertyFragment
</del>
<ins class="diff-chg">e.g.
the
available
resources
and
the
frequency
of
invoking
the
</ins><a href="the-next-method"><ins class="diff-chg">
next()
</ins>
</a>
<del class="diff-old">as
read-only
properties.
</del>
<ins class="diff-chg">method.
</ins></p><p>
The
<del class="diff-old">type
</del>
<dfn data-dfn-type="attribute" data-export="" id="dom-thingdiscovery-filter" data-idl="attribute" data-title="
filter

" data-dfn-for="ThingDiscovery" data-type="ThingFilter" data-lt="ThingDiscovery.filter|filter"><code>
<ins class="diff-chg">filter
</ins>
</code></dfn>
<del class="diff-old">read-only
</del>
property
represents
the
<ins class="diff-new">discovery
filter
of
</ins>
type
<del class="diff-old">definition
</del>
<a href="#dfn-thingfilter" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ThingFilter
</ins></a><ins class="diff-chg">
specified
</ins>
for
the
<del class="diff-old">Property
as
a
DataSchema
dictionary
object.
</del>
<ins class="diff-chg">discovery.
</ins>
</p><p>
The
<del class="diff-old">writable
</del>
<dfn data-dfn-type="attribute" data-export="" id="dom-thingdiscovery-active" data-idl="attribute" data-title="
active

" data-dfn-for="ThingDiscovery" data-type="boolean" data-lt="ThingDiscovery.active|active"><code>
<ins class="diff-chg">active
</ins>
</code></dfn>
<del class="diff-old">read-only
</del>
property
<del class="diff-old">tells
whether
the
Property
value
can
be
updated.
If
it
</del>
is
<code>
<del class="diff-old">false
,
then
the
set(value)
</del>
<ins class="diff-chg">true
</ins>
</code>
<del class="diff-old">method
<em class="rfc2119" title="SHOULD">SHOULD</em>
always
reject.
The
observable
read-only
property
tells
whether
</del>
<ins class="diff-chg">when
</ins>
the
<del class="diff-old">Property
supports
subscribing
to
value
change
notifications.
If
it
</del>
<ins class="diff-chg">discovery
</ins>
is
<ins class="diff-new">actively
ongoing
on
protocol
level
(i.e.
new
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins></a><ins class="diff-new">
s
may
still
arrive)
and
</ins>
<code>
false
<del class="diff-old">,
then
the
subscribe()
</del>
</code>
<del class="diff-old">method
<em class="rfc2119" title="SHOULD">SHOULD</em>
always
fail.
</del>
<ins class="diff-chg">otherwise.
</ins>
</p><p>
The
<del class="diff-old">constant
read-only
</del>
<dfn data-dfn-type="attribute" data-export="" id="dom-thingdiscovery-done" data-idl="attribute" data-title="
done
" data-dfn-for="ThingDiscovery" data-type="boolean" data-lt="ThingDiscovery.done|done"><code>
<ins class="diff-chg">done
</ins></code></dfn>
property
<del class="diff-old">-
defined
in
DataSchema
-
tells
whether
the
Property
value
</del>
is
<del class="diff-old">a
constant.
If
</del>
<code>
true
<del class="diff-old">,
the
set()
and
subscribe()
methods
<em class="rfc2119" title="SHOULD">SHOULD</em>
always
fail.
The
required
read-only
property
-
defined
in
DataSchema
</del>
</code>
<del class="diff-old">-
tells
whether
the
Property
should
be
always
present
on
</del>
<ins class="diff-chg">if
</ins>
the
<del class="diff-old">ExposedThing
</del>
<ins class="diff-chg">discovery
has
been
completed
with
no
more
results
to
report
and
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins>
</a>
<del class="diff-old">object.
</del>
<ins class="diff-chg">is
also
empty.
</ins>
</p><p>
The
<del class="diff-old">read()
</del>
<dfn data-dfn-type="attribute" data-export="" id="dom-thingdiscovery-error" data-idl="attribute" data-title="
error

" data-dfn-for="ThingDiscovery" data-type="Error" data-lt="ThingDiscovery.error|error"><code>
<ins class="diff-chg">error
</ins>
</code></dfn>
<del class="diff-old">method
will
fetch
the
value
of
</del>
<ins class="diff-chg">property
represents
</ins>
the
<del class="diff-old">Property
.
Returns
a
Promise
</del>
<ins class="diff-chg">last
error
</ins>
that
<del class="diff-old">resolves
with
</del>
<ins class="diff-chg">occured
during
</ins>
the
<del class="diff-old">value,
or
rejects
with
an
error.
</del>
<ins class="diff-chg">discovery
process.
Typically
used
for
critical
errors
that
stop
discovery.
</ins>
</p><del class="diff-old">The
</del><section id="constructing-write-thingdiscovery-method-will-attempt-to-set-the-value-of"><h3 id="x8-1-constructing-write-thingdiscovery-method-will-attempt-to-set-the-value-of"><bdi class="secno">8.1 </bdi>
<ins class="diff-new">Constructing
</ins>
<code>
<del class="diff-old">write()
</del>
<ins class="diff-chg">ThingDiscovery
</ins>
</code>
<del class="diff-old">method
will
attempt
to
set
the
value
of
</del>
<a class="self-link" aria-label="§" href="#constructing-write-thingdiscovery-method-will-attempt-to-set-the-value-of"></a></h3><div><p><ins class="diff-chg">To
create
</ins><a href="#dfn-thingdiscovery" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDiscovery
</ins></a><ins class="diff-chg">
with
</ins>
the
<del class="diff-old">Property
</del>
<a href="#dfn-thingfilter" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ThingFilter
</ins>
</a>
<del class="diff-old">specified
in
</del>
<var>
<ins class="diff-chg">filter
</ins></var>,<ins class="diff-chg">
run
</ins>
the
<ins class="diff-new">following
steps:
</ins></p><ol><li><ins class="diff-new">
If
</ins><var><ins class="diff-new">
filter
</ins></var><ins class="diff-new">
is
not
an
object
or
</ins>
<code>
<del class="diff-old">value
argument
whose
type
<em class="rfc2119" title="SHOULD">SHOULD</em>
match
the
one
specified
by
the
</del>
<ins class="diff-chg">null
</ins></code>,<ins class="diff-chg">
throw
</ins>
<code>
<del class="diff-old">type
</del>
<ins class="diff-chg">"TypeError"
</ins>
</code>
<del class="diff-old">property.
Returns
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li><li><ins class="diff-chg">
Let
</ins><var><ins class="diff-chg">
discovery
</ins></var><ins class="diff-chg">
be
</ins>
a
<del class="diff-old">Promise
</del>
<ins class="diff-chg">new
</ins><a href="#dfn-thingdiscovery" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDiscovery
</ins>
</a>
<del class="diff-old">that
resolves
on
success,
or
rejects
on
an
error.
7.3
The
ThingAction
interface
</del>
<ins class="diff-chg">object.
</ins></li><li><ins class="diff-chg">
Set
the
</ins><a href="#dom-thingdiscovery-filter"><ins class="diff-chg">
filter
</ins>
</a>
<del class="diff-old">

<p>};
ThingAction
</p><p><ins class="diff-chg">property
to
</ins><var><ins class="diff-chg">
filter
</ins></var>.</p>

</del>
</li><li><ins class="diff-chg">
Set
</ins><a href="#dom-thingdiscovery-active"><ins class="diff-chg">
active
</ins>
</a>
<del class="diff-old">includes
</del>
<ins class="diff-chg">and
</ins><a href="#dom-thingdiscovery-done"><ins class="diff-chg">
done
</ins></a><ins class="diff-chg">
to
</ins>
<code>
<del class="diff-old">ActionFragment
</del>
<ins class="diff-chg">false
</ins></code>.<ins class="diff-chg">
Set
</ins><a href="#dom-thingdiscovery-error"><ins class="diff-chg">
error
</ins>
</a>
<del class="diff-old">;
</del>
<ins class="diff-chg">to
</ins><code><ins class="diff-chg">
null
</ins></code>.</li><li><ins class="diff-chg">
Return
</ins><var><ins class="diff-chg">
discovery
</ins></var>.</li>
</ol>
</div><p>
The
<a href="the-start-method">
<ins class="diff-chg">start()
</ins></a><ins class="diff-chg">
method
sets
</ins><a href="#dom-thingdiscovery-active"><ins class="diff-chg">
active
</ins></a><ins class="diff-chg">
to
</ins>
<code>
<del class="diff-old">invoke()
</del>
<ins class="diff-chg">true
</ins></code>.<ins class="diff-chg">
The
</ins><a href="the-stop-method"><ins class="diff-chg">
stop()
</ins></a>
method
<del class="diff-old">when
invoked,
starts
the
Action
</del>
<ins class="diff-chg">sets
</ins><a href="#dom-thingdiscovery-active"><ins class="diff-chg">
active
</ins>
</a>
<del class="diff-old">interaction
with
the
input
value
provided
by
the
inputValue
argument.
If
</del>
<ins class="diff-chg">to
</ins>
<var>
<del class="diff-old">inputValue
is
</del>
<ins class="diff-chg">false
</ins></var>,<ins class="diff-chg">
but
</ins><a href="#dom-thingdiscovery-done"><ins class="diff-chg">
done
</ins></a><ins class="diff-chg">
may
be
still
</ins>
<code>
<del class="diff-old">null
,
the
action
does
not
take
any
arguments
and
rejects
</del>
<ins class="diff-chg">false
</ins></code>
if
<del class="diff-old">any
arguments
</del>
<ins class="diff-chg">there
</ins>
are
<del class="diff-old">provided.
If
the
value
is
undefined
,
the
action
will
ignore
any
arguments
provided.
Otherwise
the
type
of
inputValue
<em class="rfc2119" title="SHOULD">SHOULD</em>
match
the
DataSchema
</del>
<a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">ThingDescription
</ins>
</a>
<del class="diff-old">definition
</del>
<ins class="diff-chg">objects
</ins>
in
the
<del class="diff-old">input
property.
Returns
a
Promise
</del>
<a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">discovery
results
</ins>
</a>
<del class="diff-old">that
will
reject
with
an
error
or
will
resolve
</del>
<ins class="diff-chg">not
yet
consumed
</ins>
with
<del class="diff-old">a
value
</del>
<a href="the-next-method">
<ins class="diff-chg">next()
</ins></a>.</p><p><ins class="diff-chg">
During
successive
calls
</ins>
of
<del class="diff-old">type
defined
by
the
</del>
<a href="the-next-method">
<ins class="diff-chg">next()
</ins></a>,<a href="#dom-thingdiscovery-active"><ins class="diff-chg">
active
</ins></a><ins class="diff-chg">
may
be
</ins>
<code>
<del class="diff-old">output
</del>
<ins class="diff-chg">true
</ins>
</code>
<del class="diff-old">property.
7.4
The
</del>
<ins class="diff-chg">or
</ins>
<code>
<del class="diff-old">ThingEvent
interface
</del>
<ins class="diff-chg">false
</ins></code>,<ins class="diff-chg">
but
</ins><a href="#dom-thingdiscovery-done"><ins class="diff-chg">
done
</ins>
</a>
<del class="diff-old">{
};
</del>
<ins class="diff-chg">is
set
to
</ins>
<code>
<del class="diff-old">ThingEvent
</del>
<ins class="diff-chg">false
</ins>
</code>
<ins class="diff-chg">by
</ins><a href="the-next-method"><ins class="diff-chg">
next()
</ins>
</a>
<del class="diff-old">includes
</del>
<ins class="diff-chg">only
when
both
</ins><a href="#dom-thingdiscovery-active"><ins class="diff-chg">
active
</ins></a><ins class="diff-chg">
is
</ins>
<code>
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">false
</ins>
</code>
<ins class="diff-chg">and
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins>
</a>
<del class="diff-old">;
</del>
<ins class="diff-chg">is
empty.
</ins></p></section><section data-dfn-for="DiscoveryMethod" id="the-discoverymethod-enumeration"><h3 id="x8-2-the-discoverymethod-enumeration"><bdi class="secno">8.2 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="dfn" id="dfn-discoverymethod"><ins class="diff-chg">
DiscoveryMethod
</ins></dfn><ins class="diff-chg">
enumeration
</ins><a class="self-link" aria-label="§" href="#the-discoverymethod-enumeration"></a></h3><pre class="idl def"><span data-idl="" class="idlTypedef" id="idl-def-discoverymethod" data-title="DiscoveryMethod">typedef<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <dfn data-export="" data-dfn-type="typedef" id="dom-discoverymethod" data-idl="typedef" data-title="DiscoveryMethod" class="idlID" data-dfn-for="DiscoveryMethod"><code>DiscoveryMethod</code></dfn>;</span></pre><p>
<del class="diff-old">Since
ThingEvent
implements
Observable
through
</del>
<ins class="diff-chg">Represents
</ins>
the
<del class="diff-old">ThingProperty
</del>
<ins class="diff-chg">discovery
type
to
be
used:
</ins></p><ul><li>
<dfn data-dfn-type="dfn" id="dfn-any">
<ins class="diff-new">"any"
</ins></dfn><ins class="diff-new">
does
not
provide
any
restriction
</ins></li><li><dfn data-dfn-type="dfn" id="dfn-local"><ins class="diff-new">
"local"
</ins></dfn><ins class="diff-new">
for
discovering
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins>
</a>
<del class="diff-old">interface,
event
subscription
is
done
by
invoking
</del>
<ins class="diff-chg">s
defined
in
</ins>
the
<del class="diff-old">subscribe()
method
on
</del>
<ins class="diff-chg">same
device
or
connected
to
</ins>
the
<del class="diff-old">event
object
that
returns
</del>
<ins class="diff-chg">device
by
wired
or
wireless
means.
</ins></li><li><dfn data-dfn-type="dfn" id="dfn-directory"><ins class="diff-chg">
"directory"
</ins></dfn><ins class="diff-chg">
for
discovery
based
on
</ins>
a
<del class="diff-old">cancelable
Subscription
</del>
<ins class="diff-chg">service
provided
by
a
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Directory
</ins>
</a>.
</li>
<li>
<dfn data-dfn-type="dfn" id="dfn-multicast">
<ins class="diff-chg">"multicast"
</ins></dfn><ins class="diff-chg">
for
discovering
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
in
the
device's
network
by
using
a
supported
multicast
protocol.
</ins></li></ul></section><del class="diff-old">7.5
</del><section data-dfn-for="ThingFilter" id="the-exposedevent-thingfilter-interface-dictionary"><h3 id="x8-3-the-exposedevent-thingfilter-interface-dictionary"><bdi class="secno">8.3 </bdi>
The
<del class="diff-old">ExposedEvent
</del>
<dfn data-dfn-type="dfn" id="dfn-thingfilter">
<ins class="diff-chg">ThingFilter
</ins>
</dfn>
<del class="diff-old">interface
</del>
<ins class="diff-chg">dictionary
</ins>
<a class="self-link" aria-label="§" href="#the-exposedevent-thingfilter-interface-dictionary"></a></h3><del class="diff-old">      
void
};
</del><p>
<ins class="diff-chg">Represents
an
object
containing
the
constraints
for
discovering
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
as
key-value
pairs.
</ins></p><pre class="idl def"><span data-idl="" class="idlDictionary" id="idl-def-thingfilter" data-title="ThingFilter">        dictionary <dfn data-export="" data-dfn-type="dictionary" id="dom-thingfilter" data-idl="dictionary" data-title="ThingFilter" class="idlID" data-dfn-for="ThingFilter"><code>ThingFilter</code></dfn> {<span data-idl="" class="idlMember" id="idl-def-thingfilter-method" data-title="method" data-dfn-for="ThingFilter"><span class="idlType">
          (<a data-xref-type="_IDL_" href="#dfn-discoverymethod" class="internalDFN" data-link-type="dfn">DiscoveryMethod</a> or <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>)</span> <dfn data-export="" data-dfn-type="dict-member" id="dom-thingfilter-method" data-idl="field" data-title="method" data-dfn-for="ThingFilter" data-type="DiscoveryMethod|DOMString" class="idlName"><code>method</code></dfn> = "any";</span><span data-idl="" class="idlMember" id="idl-def-thingfilter-url" data-title="url" data-dfn-for="ThingFilter"><span class="idlType">
          <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>?</span> <a class="internalDFN idlName" data-link-for="ThingFilter" data-link-type="dict-member" href="#dom-thingfilter-url"><code>url</code></a>;</span><span data-idl="" class="idlMember" id="idl-def-thingfilter-query" data-title="query" data-dfn-for="ThingFilter"><span class="idlType">
          <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>?</span> <a class="internalDFN idlName" data-link-for="ThingFilter" data-link-type="dict-member" href="#dom-thingfilter-query"><code>query</code></a>;</span><span data-idl="" class="idlMember" id="idl-def-thingfilter-fragment" data-title="fragment" data-dfn-for="ThingFilter"><span class="idlType">
          <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-object">object</a>?</span> <a class="internalDFN idlName" data-link-for="ThingFilter" data-link-type="dict-member" href="#dom-thingfilter-fragment"><code>fragment</code></a>;</span>
        };</span></pre><del class="diff-old">7.5.1
</del><p>
The
<del class="diff-old">emit()
</del>
<dfn data-dfn-type="dfn" id="dfn-method-emits-an-event">
method
<del class="diff-old">Emits
an
event
</del>
</dfn>
<ins class="diff-chg">property
represents
the
discovery
type
</ins>
that
<del class="diff-old">carries
data
specified
</del>
<ins class="diff-chg">should
be
used
in
the
discovery
process.
The
possible
values
are
defined
</ins>
by
the
<code>
<del class="diff-old">payload
argument.
7.6
The
value-matching
algorithm
</del>
<a href="#dfn-discoverymethod" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">DiscoveryMethod
</ins>
</a>
</code>
<ins class="diff-chg">enumeration
that
<em class="rfc2119" title="MAY">MAY</em>
be
extended
by
string
values
defined
by
solutions
(with
no
guarantee
of
interoperability).
</ins></p><p>
The
<del class="diff-old">value-matching
algorithm
is
applied
to
a
value
input
in
relation
to
a
valueType
</del>
<dfn data-dfn-type="dict-member" data-export="" id="dom-thingfilter-url" data-idl="field" data-title="
url
" data-dfn-for="ThingFilter" data-type="USVString"><code>
<ins class="diff-chg">url
</ins></code></dfn>
property
<ins class="diff-new">represents
additional
information
for
the
discovery
method,
such
as
the
URL
</ins>
of
<del class="diff-old">type
DataSchema
,
</del>
<ins class="diff-chg">the
target
entity
serving
the
discovery
request,
</ins>
for
instance
the
<ins class="diff-new">URL
of
a
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
Directory
</ins></a><ins class="diff-new">
(if
</ins>
<code>
<del class="diff-old">value
</del>
<ins class="diff-chg">method
</ins>
</code>
<del class="diff-old">and
</del>
<ins class="diff-chg">is
</ins>
<code>
<del class="diff-old">type
</del>
<ins class="diff-chg">"directory"
</ins>
</code>
<del class="diff-old">properties
</del>
<ins class="diff-chg">)
or
that
</ins>
of
a
<del class="diff-old">PropertyFragment
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins>
</a>
<del class="diff-old">object,
or
the
inputValue
parameter
to
</del>
<ins class="diff-chg">(otherwise).
</ins></p><p><ins class="diff-chg">
The
</ins><dfn data-dfn-type="dict-member" data-export="" id="dom-thingfilter-query" data-idl="field" data-title="
query
" data-dfn-for="ThingFilter" data-type="USVString"><code><ins class="diff-chg">
query
</ins></code></dfn><ins class="diff-chg">
property
represents
a
query
string
accepted
by
</ins>
the
<del class="diff-old">invoke()
method
of
</del>
<ins class="diff-chg">implementation,
for
instance
</ins>
a
<del class="diff-old">ThingAction
</del>
<ins class="diff-chg">SPARQL
or
JSON
query.
Support
may
be
implemented
locally
in
the
</ins><a href="#dfn-wot-runtime" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
Runtime
</ins>
</a>
<del class="diff-old">object
</del>
<ins class="diff-chg">or
remotely
as
a
service
</ins>
in
<del class="diff-old">relation
to
</del>
<ins class="diff-chg">a
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Directory
</ins></a>.</p><p><ins class="diff-chg">
The
</ins><dfn data-dfn-type="dict-member" data-export="" id="dom-thingfilter-fragment" data-idl="field" data-title="
fragment
" data-dfn-for="ThingFilter" data-type="object"><code><ins class="diff-chg">
fragment
</ins></code></dfn><ins class="diff-chg">
property
represents
a
template
object
used
for
matching
property
by
property
against
discovered
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s.
</ins></p></section><section id="the-start-method"><h3 id="x8-4-the-start-method"><bdi class="secno">8.4 </bdi><ins class="diff-chg">
The
</ins><dfn data-dfn-type="method" data-export="" id="dom-thingdiscovery-start" data-idl="operation" data-title="
start()
" data-dfn-for="ThingDiscovery" data-type="void" data-lt="ThingDiscovery.start()|ThingDiscovery.start|start()|start"><code><ins class="diff-chg">
start()
</ins></code></dfn><ins class="diff-chg">
method
</ins><a class="self-link" aria-label="§" href="#the-start-method"></a></h3><div><ins class="diff-chg">
Starts
</ins>
the
<del class="diff-old">same
object.
It
executes
</del>
<ins class="diff-chg">discovery
process.
The
method
<em class="rfc2119" title="MUST">MUST</em>
run
</ins>
the
following
steps:
<ol>
<li>
If
<del class="diff-old">valueType.type
</del>
<ins class="diff-chg">invoking
this
method
</ins>
is
not
<del class="diff-old">defined,
or
does
not
fully
match
a
string
enumerated
in
DataType
,
return
</del>
<ins class="diff-chg">allowed
for
the
current
scripting
context
for
security
reasons,
set
</ins><var><ins class="diff-chg">
this.error
</ins></var><ins class="diff-chg">
to
</ins>
<code>
<del class="diff-old">false
.
</del>
<ins class="diff-chg">SecurityError
</ins></code><ins class="diff-chg">
and
terminate
these
steps.
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
if
valueType.type
</del>
<ins class="diff-chg">If
discovery
</ins>
is
<del class="diff-old">"null"
:
if
</del>
<ins class="diff-chg">not
supported
by
the
implementation,
set
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">this.error
</ins>
</var>
<del class="diff-old">is
null
,
return
true
,
otherwise
return
</del>
<ins class="diff-chg">to
</ins>
<code>
<del class="diff-old">false
.
</del>
<ins class="diff-chg">NotSupportedError
</ins></code><ins class="diff-chg">
and
terminate
these
steps.
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
if
</del>
<ins class="diff-chg">If
</ins>
<var>
<del class="diff-old">valueType.type
</del>
<ins class="diff-chg">this.filter
</ins>
</var>
is
<del class="diff-old">"boolean"
:
if
</del>
<ins class="diff-chg">defined,
</ins><ul><li><ins class="diff-chg">
Let
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">filter
</ins>
</var>
<del class="diff-old">is
either
true
or
false
,
then
return
true
,
otherwise
return
false
.
</del>
<ins class="diff-chg">denote
</ins><var><ins class="diff-chg">
this.filter
</ins></var>.
</li>
<li>
<del class="diff-old">Otherwise,
if
valueType.type
is
"integer"
:
if
</del>
<ins class="diff-chg">If
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">filter.query
</ins>
</var>
is
<del class="diff-old">not
</del>
<ins class="diff-chg">defined,
pass
it
as
</ins>
an
<del class="diff-old">integer
type
defined
by
</del>
<ins class="diff-chg">opaque
string
to
</ins>
the
underlying
<del class="diff-old">platform
(such
</del>
<ins class="diff-chg">implementation
to
be
matched
against
discovered
items.
The
underlying
implementation
is
responsible
to
parse
it
e.g.
</ins>
as
<del class="diff-old">long
</del>
<ins class="diff-chg">a
SPARQL
</ins>
or
<ins class="diff-new">JSON
query
and
match
it
against
the
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
Description
</ins></a><ins class="diff-new">
s
found
during
the
discovery
process.
If
queries
are
not
supported,
set
</ins><var><ins class="diff-new">
this.error
</ins></var><ins class="diff-new">
to
</ins>
<code>
<del class="diff-old">long
long
</del>
<ins class="diff-chg">NotSupportedError
</ins>
</code>
<del class="diff-old">),
then
return
false
,
otherwise
execute
</del>
<ins class="diff-chg">and
terminate
these
steps.
</ins></li></ul></li><li><ins class="diff-chg">
Create
the
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins></a><ins class="diff-chg">
internal
slot
for
storing
discovered
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins></a><ins class="diff-chg">
objects.
</ins></li><li><ins class="diff-chg">
Request
the
underlying
platform
to
start
the
discovery
process,
with
</ins>
the
following
<del class="diff-old">sub-steps:
</del>
<ins class="diff-chg">parameters:
</ins><ul>
<li>
If
<var>
<del class="diff-old">valueType.minimum
</del>
<ins class="diff-chg">filter.method
</ins>
</var>
is
<ins class="diff-new">not
</ins>
defined
<del class="diff-old">and
</del>
<ins class="diff-chg">or
the
</ins>
value
is
<del class="diff-old">not
greater
or
equal
than
that
value,
return
false
.
</del>
<code>
<ins class="diff-chg">"any"
</ins></code>,<ins class="diff-chg">
use
the
widest
discovery
method
supported
by
the
underlying
platform.
</ins>
</li>
<li>
<del class="diff-old">If
valueType.maximum
is
defined
and
</del>
<ins class="diff-chg">Otherwise
if
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">filter.method
</ins>
</var>
is
<del class="diff-old">not
less
or
equal
than
that
value,
return
false
.
Return
</del>
<code>
<del class="diff-old">true
.
</del>
<ins class="diff-chg">"local"
</ins></code>,<ins class="diff-chg">
use
the
local
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Directory
</ins></a><ins class="diff-chg">
for
discovery.
Usually
that
defines
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
deployed
in
the
same
device,
or
connected
to
the
device
in
slave
mode
(e.g.
sensors
connected
via
Bluetooth
or
a
serial
connection).
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
</del>
<ins class="diff-chg">Otherwise
</ins>
if
<var>
<del class="diff-old">valueType.type
</del>
<ins class="diff-chg">filter.method
</ins>
</var>
is
<code>
<del class="diff-old">"number"
</del>
<ins class="diff-chg">"directory"
</ins>
</code>,
<ins class="diff-new">use
the
remote
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
Directory
</ins></a><ins class="diff-new">
specified
in
</ins><var><ins class="diff-new">
filter.url
</ins></var>.</li><li><ins class="diff-new">
Otherwise
</ins>
if
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">filter.method
</ins>
</var>
is
<del class="diff-old">not
an
integer
or
floating
point
type
defined
</del>
<code>
<ins class="diff-chg">"multicast"
</ins></code>,<ins class="diff-chg">
use
all
the
multicast
discovery
protocols
supported
</ins>
by
the
underlying
<ins class="diff-new">platform.
</ins></li></ul></li><li><ins class="diff-new">
When
the
underlying
</ins>
platform
<del class="diff-old">(such
as
long
or
long
long
or
</del>
<ins class="diff-chg">has
started
the
discovery
process,
set
the
</ins>
<code>
<del class="diff-old">double
</del>
<ins class="diff-chg">active
</ins>
</code>
<del class="diff-old">),
then
return
</del>
<ins class="diff-chg">property
to
</ins>
<code>
<del class="diff-old">false
,
otherwise
otherwise
execute
</del>
<ins class="diff-chg">true
</ins></code>.</li><li><ins class="diff-chg">
Whenever
a
new
</ins><a href="#dfn-thing-descriptions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Description
</ins></a><var><ins class="diff-chg">
td
</ins></var><ins class="diff-chg">
is
discovered
by
the
underlying
platform,
run
</ins>
the
following
sub-steps:
<ol>
<li>
<del class="diff-old">If
valueType.minimum
is
defined
and
</del>
<a href="https://fetch.spec.whatwg.org/#fetch-api">
<ins class="diff-chg">Fetch
</ins></a>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">td
</ins>
</var>
<del class="diff-old">is
not
greater
or
equal
than
that
value,
return
</del>
<ins class="diff-chg">as
a
JSON
object
</ins>
<var>
<del class="diff-old">false
</del>
<ins class="diff-chg">json
</ins>
</var>.
If
<ins class="diff-new">that
fails,
set
</ins>
<var>
<del class="diff-old">valueType.maximum
</del>
<ins class="diff-chg">this.error
</ins>
</var>
<del class="diff-old">is
defined
and
</del>
<ins class="diff-chg">to
</ins><code><ins class="diff-chg">
SyntaxError
</ins></code>,<ins class="diff-chg">
discard
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">td
</ins>
</var>
<del class="diff-old">is
not
less
or
equal
than
that
value,
return
false
.
Return
true
.
</del>
<ins class="diff-chg">and
continue
the
discovery
process.
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
if
</del>
<ins class="diff-chg">If
</ins>
<var>
<del class="diff-old">valueType.type
</del>
<ins class="diff-chg">filter.query
</ins>
</var>
is
<del class="diff-old">"string"
:
</del>
<ins class="diff-chg">defined,
check
</ins>
if
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">json
</ins>
</var>
is
<del class="diff-old">not
</del>
a
<del class="diff-old">string
type
defined
by
</del>
<ins class="diff-chg">match
for
</ins>
the
<del class="diff-old">underlying
platform,
then
return
</del>
<ins class="diff-chg">query.
The
matching
algorithm
is
encapsulated
by
implementations.
If
that
returns
</ins>
<code>
false
</code>,
<del class="diff-old">otherwise
return
true
.
In
this
case
the
algorithm
expects
a
third
parameter
</del>
<ins class="diff-chg">discard
</ins>
<var>
<del class="diff-old">valueType.enum
</del>
<ins class="diff-chg">td
</ins>
</var>
and
<del class="diff-old">runs
</del>
<ins class="diff-chg">continue
</ins>
the
<del class="diff-old">following
sub-steps:
</del>
<ins class="diff-chg">discovery
process.
</ins></li>
<li>
If
<var>
<del class="diff-old">valueType.enum
</del>
<ins class="diff-chg">filter.fragment
</ins>
</var>
is
<del class="diff-old">an
array
of
strings,
then
</del>
<ins class="diff-chg">defined,
for
each
property
defined
in
it,
check
</ins>
if
<ins class="diff-new">that
property
exists
in
</ins>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">json.properties
</ins>
</var>
<del class="diff-old">fully
matches
one
of
</del>
<ins class="diff-chg">and
has
</ins>
the
<del class="diff-old">strings
defined
</del>
<ins class="diff-chg">same
value.
If
this
is
</ins><code><ins class="diff-chg">
false
</ins></code>
in
<del class="diff-old">the
array,
return
</del>
<ins class="diff-chg">any
checks,
discard
</ins>
<var>
<del class="diff-old">true
.
</del>
<ins class="diff-chg">td
</ins></var><ins class="diff-chg">
and
continue
the
discovery
process.
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
return
</del>
<ins class="diff-chg">Otherwise
add
</ins>
<var>
<del class="diff-old">false
.
</del>
<ins class="diff-chg">td
</ins></var><ins class="diff-chg">
to
the
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins></a>.
</li>
<li>
<del class="diff-old">Otherwise,
</del>
<ins class="diff-chg">At
this
point
implementations
<em class="rfc2119" title="MAY">MAY</em>
control
the
flow
of
the
discovery
process
(depending
on
memory
constraints,
for
instance
temporarily
stop
discovery
</ins>
if
<del class="diff-old">valueType.type
</del>
<ins class="diff-chg">the
queue
</ins>
is
<del class="diff-old">"array"
,
execute
</del>
<ins class="diff-chg">getting
too
large,
or
resume
discovery
when
</ins>
the
<del class="diff-old">following
sub-steps:
If
value
</del>
<ins class="diff-chg">queue
</ins>
is
<del class="diff-old">not
an
array,
return
false
.
</del>
<ins class="diff-chg">emptied
sufficiently).
</ins></li></ol>
</li>
<li>
<del class="diff-old">If
</del>
<ins class="diff-chg">Whenever
an
error
occurs
during
the
discovery
process,
</ins><ol><li><ins class="diff-chg">
Set
</ins>
<var>
<del class="diff-old">valueType.minItems
</del>
<ins class="diff-chg">this.error
</ins>
</var>
<del class="diff-old">is
defined,
and
</del>
<ins class="diff-chg">to
a
new
</ins><code><ins class="diff-chg">
Error
</ins></code><ins class="diff-chg">
object
</ins>
<var>
<del class="diff-old">value
does
not
contain
at
least
</del>
<ins class="diff-chg">error
</ins></var>.<ins class="diff-chg">
Set
</ins>
<var>
<del class="diff-old">valueType.minItems
</del>
<ins class="diff-chg">error.name
</ins>
</var>
<del class="diff-old">elements,
return
false
.
</del>
<ins class="diff-chg">to
</ins><code><ins class="diff-chg">
'DiscoveryError'
</ins></code>.
</li>
<li>
If
<ins class="diff-new">there
was
an
error
code
or
message
provided
by
the
</ins><a href="#dfn-protocol-bindings" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Protocol
Bindings
</ins></a>,<ins class="diff-new">
set
</ins>
<var>
<del class="diff-old">valueType.maxItems
</del>
<ins class="diff-chg">error.message
</ins>
</var>
<del class="diff-old">is
defined,
and
</del>
<ins class="diff-chg">to
that
</ins>
value
<del class="diff-old">contains
more
than
valueType.maxItems
elements,
return
false
.
</del>
<ins class="diff-chg">as
string.
</ins>
</li>
<li>
<del class="diff-old">Otherwise,
if
valueType.items
</del>
<ins class="diff-chg">If
the
error
</ins>
is
<ins class="diff-new">irrecoverable
and
discovery
has
been
stopped
by
the
underlying
platform,
set
</ins>
<code>
<del class="diff-old">undefined
,
return
</del>
<ins class="diff-chg">this.active
</ins></code><ins class="diff-chg">
to
</ins>
<code>
false
</code>.
</li>
<del class="diff-old">Otherwise,
if
valueType.items
is
null
,
return
true
(i.e.
any
type
is
accepted
as
array
element,
including
heterogenous
arrays).
</del>
</ol>
</li>
<li>
<del class="diff-old">Otherwise,
for
each
element
of
the
array
value
run
</del>
<ins class="diff-chg">When
</ins>
the
<del class="diff-old">value-matching
algorithm
against
</del>
<ins class="diff-chg">underlying
platform
reports
</ins>
the
<ins class="diff-new">discovery
process
has
completed,
set
</ins>
<var>
<del class="diff-old">valueType.items
</del>
<ins class="diff-chg">this.active
</ins>
</var>
<del class="diff-old">object.
If
any
of
these
runs
returns
false
,
then
return
</del>
<ins class="diff-chg">to
</ins>
<code>
false
</code>.
</li>
<del class="diff-old">Otherwise,
return
true
.
</del>
</ol>
</div></section><section id="the-next-method"><h3 id="x8-5-the-next-method"><bdi class="secno">8.5 </bdi>
<ins class="diff-chg">The
</ins><dfn data-dfn-type="method" data-export="" id="dom-thingdiscovery-next" data-idl="operation" data-title="
next()
" data-dfn-for="ThingDiscovery" data-type="Promise" data-lt="ThingDiscovery.next()|ThingDiscovery.next|next()|next"><code><ins class="diff-chg">
next()
</ins></code></dfn><ins class="diff-chg">
method
</ins><a class="self-link" aria-label="§" href="#the-next-method"></a></h3><div><ins class="diff-chg">
Provides
the
next
discovered
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins></a><ins class="diff-chg">
object.
The
method
<em class="rfc2119" title="MUST">MUST</em>
run
the
following
steps:
</ins><ol>
<li>
<del class="diff-old">Otherwise,
if
</del>
<ins class="diff-chg">Return
a
</ins><a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-31"><ins class="diff-chg">
Promise
</ins></a>
<var>
<del class="diff-old">type
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">is
"object"
,
</del>
<ins class="diff-chg">and
</ins>
execute
the
<del class="diff-old">following
sub-steps:
</del>
<ins class="diff-chg">next
steps
</ins><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/#in-parallel"><ins class="diff-chg">
in
parallel
</ins></a>.</li>
<li>
If
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">this.active
</ins>
</var>
is
<del class="diff-old">not
an
</del>
<code>
<del class="diff-old">Object
</del>
<ins class="diff-chg">true
</ins>
</code>,
<del class="diff-old">return
false
.
If
valueType.properties
</del>
<ins class="diff-chg">wait
until
the
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins></a><ins class="diff-chg">
internal
slot
</ins>
is
not
<del class="diff-old">defined,
return
false
.
</del>
<ins class="diff-chg">empty.
</ins>
</li>
<li>
If
<a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn">
<ins class="diff-new">discovery
results
</ins></a><ins class="diff-new">
is
empty
and
</ins>
<var>
<del class="diff-old">valueType.properties
</del>
<ins class="diff-chg">this.active
</ins>
</var>
is
<code>
<del class="diff-old">null
</del>
<ins class="diff-chg">false
</ins>
</code>,
<del class="diff-old">return
</del>
<ins class="diff-chg">set
</ins><var><ins class="diff-chg">
this.done
</ins></var><ins class="diff-chg">
to
</ins>
<code>
true
</code>
<del class="diff-old">(i.e.
accept
any
object
value).
</del>
<ins class="diff-chg">and
reject
</ins><var><ins class="diff-chg">
promise
</ins></var>.
</li>
<li>
<del class="diff-old">For
each
string
in
the
valueType.required
array,
if
it
does
not
match
a
property
name
in
</del>
<ins class="diff-chg">Remove
</ins>
the
<del class="diff-old">value.properties
</del>
<ins class="diff-chg">first
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins></a>
object
<del class="diff-old">or
in
the
</del>
<var>
<del class="diff-old">value
</del>
<ins class="diff-chg">td
</ins>
</var>
<del class="diff-old">object,
then
return
false
.
</del>
<ins class="diff-chg">from
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins></a>.
</li>
<li>
<del class="diff-old">For
each
property
with
name
propName
and
value
</del>
<ins class="diff-chg">Resolve
</ins>
<var>
<del class="diff-old">propDataSchema
</del>
<ins class="diff-chg">promise
</ins>
</var>
<del class="diff-old">found
in
valueType.properties
,
run
the
following
sub-steps:
If
the
result
of
applying
the
value-matching
algorithm
on
the
value
</del>
<ins class="diff-chg">with
</ins>
<var>
<del class="diff-old">value[propName]
</del>
<ins class="diff-chg">td
</ins>
</var>
and
<del class="diff-old">propDataSchema
is
false
,
then
return
false
.
Return
true
.
</del>
<ins class="diff-chg">terminate
these
steps.
</ins>
</li>
</ol>
</div></section><del class="diff-old">8.
Observables
This
section
is
non-normative.
Observables
</del><section id="the-stop-are-proposed-to-method"><h3 id="x8-6-the-stop-are-proposed-to-method"><bdi class="secno">8.6 </bdi>
<ins class="diff-chg">The
</ins><dfn data-dfn-type="method" data-export="" id="dom-thingdiscovery-stop" data-idl="operation" data-title="
stop()

" data-dfn-for="ThingDiscovery" data-type="void" data-lt="ThingDiscovery.stop()|ThingDiscovery.stop|stop()|stop"><code><ins class="diff-chg">
stop()
</ins>
</code></dfn>
<del class="diff-old">are
proposed
to
</del>
<ins class="diff-chg">method
</ins><a class="self-link" aria-label="§" href="#the-stop-are-proposed-to-method"></a></h3><div><ins class="diff-chg">
Stops
or
suppresses
the
discovery
process.
It
might
not
</ins>
be
<del class="diff-old">included
in
ECMAScript
</del>
<ins class="diff-chg">supported
by
all
discovery
methods
</ins>
and
<del class="diff-old">are
used
for
handling
pushed
data
associated
with
various
possible
sources,
for
instance
events,
timers,
streams,
etc.
A
minimal
required
implementation
is
described
here.
Editor's
note
This
section
is
informal
</del>
<ins class="diff-chg">endpoints,
however,
any
further
discovery
results
or
errors
will
be
discarded
</ins>
and
<del class="diff-old">contains
rather
laconic
information
for
implementations
on
what
to
support
for
interoperability.


<pre><code aria-busy="false" class="hljs">               optional
               optional</code></pre><p>};
</p><p>interface 
void
readonly attribute
};
callback 
callback 
callback
OnComplete
=
void
();
</p>
<p><ins class="diff-chg">the
discovery
is
marked
inactive.
</ins>
The
<ins class="diff-new">method
<em class="rfc2119" title="MUST">MUST</em>
run
the
</ins>
following
<del class="diff-old">callbacks
can
be
provided
when
subscribing
to
an
Observable
:
</del>
<ins class="diff-chg">steps:
</ins></p>
<ol>
<li>
<del class="diff-old">The
EventHandler
callback
takes
the
next
sample
for
</del>
<ins class="diff-chg">Request
</ins>
the
<del class="diff-old">data
in
</del>
<ins class="diff-chg">underlying
platform
to
stop
</ins>
the
<del class="diff-old">value
argument.
The
ErrorHandler
callback
takes
</del>
<ins class="diff-chg">discovery
process.
If
this
returns
</ins>
an
<del class="diff-old">error
in
the
value
argument.
It
</del>
<ins class="diff-chg">error,
or
if
it
</ins>
is
<del class="diff-old">called
</del>
<ins class="diff-chg">not
possible,
for
instance
</ins>
when
<del class="diff-old">an
error
occurred
in
producing
the
data
</del>
<ins class="diff-chg">discovery
is
based
on
open
ended
multicast
requests,
</ins>
the
<del class="diff-old">client
should
know
about.
</del>
<ins class="diff-chg">implementation
<em class="rfc2119" title="SHOULD">SHOULD</em>
discard
subsequent
discovered
items.
</ins>
</li>
<li>
<del class="diff-old">The
</del>
<ins class="diff-chg">Set
</ins>
<code>
<del class="diff-old">OnComplete
</del>
<ins class="diff-chg">this.active
</ins>
</code>
<del class="diff-old">callback
is
called
when
the
data
source
has
finished
sending
values.
8.1
The
</del>
<ins class="diff-chg">to
</ins>
<code>
<del class="diff-old">Subscription
interface
</del>
<ins class="diff-chg">false
</ins></code>.</li></ol>
</del>
</div></section><section id="discovery-examples"><h3 id="x8-7-discovery-examples"><bdi class="secno">8.7 </bdi><ins class="diff-chg">
Discovery
Examples
</ins>
<a class="self-link" aria-label="§" href="#discovery-examples"></a></h3><p>
<del class="diff-old">Contains
the
closed
property
</del>
<ins class="diff-chg">The
following
example
finds
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins></a><ins class="diff-chg">
objects
</ins>
of
<del class="diff-old">type
boolean
</del>
<a href="#dfn-things" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Thing
</ins></a><ins class="diff-chg">
s
</ins>
that
<del class="diff-old">tells
if
the
subscription
</del>
<ins class="diff-chg">are
exposed
by
local
hardware,
regardless
how
many
instances
of
</ins><a href="#dfn-wot-runtime" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
WoT
Runtime
</ins></a><ins class="diff-chg">
it
</ins>
is
<del class="diff-old">closed
or
active.
Also,
contains
the
unsubscribe
()
method
</del>
<ins class="diff-chg">running.
Note
</ins>
that
<del class="diff-old">cancels
</del>
the
<del class="diff-old">subscription,
i.e.
makes
a
request
to
</del>
<ins class="diff-chg">discovery
can
end
(become
inactive)
before
</ins>
the
<del class="diff-old">underlying
platform
</del>
<ins class="diff-chg">internal
</ins><a href="#dfn-discovery-results" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
discovery
results
</ins></a><ins class="diff-chg">
queue
is
emptied,
so
we
need
</ins>
to
<del class="diff-old">stop
receiving
data
from
the
source,
</del>
<ins class="diff-chg">continue
reading
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins></a><ins class="diff-chg">
objects
until
done.
This
is
typical
with
local
</ins>
and
<del class="diff-old">sets
the
closed
property
to
false
.
</del>
<ins class="diff-chg">directory
type
discoveries.
</ins>
</p><del class="diff-old">8.2
The
Observable
interface
</del><div class="example" id="example-5-discover-things-exposed-by-local-hardware">
          <div class="marker">
      <a class="self-link" href="#example-5-discover-things-exposed-by-local-hardware">Example<bdi> 5</bdi></a><span class="example-title">: Discover Things exposed by local hardware</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">        <span class="hljs-keyword">let</span> discovery = <span class="hljs-keyword">new</span> ThingDiscovery({ <span class="hljs-attr">method</span>: <span class="hljs-string">"local"</span> });
        <span class="hljs-keyword">do</span> {
          <span class="hljs-keyword">let</span> td = <span class="hljs-keyword">await</span> discovery.next();
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Found Thing Description for "</span> + td.title);
          <span class="hljs-keyword">let</span> thing = <span class="hljs-keyword">new</span> ConsumedThing(td);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Thing name: "</span> + thing.getThingDescription().title);
        } <span class="hljs-keyword">while</span> (!discovery.done);
</code></pre>
        </div><p>
The
<del class="diff-old">Observable
</del>
<ins class="diff-chg">next
example
finds
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ThingDescription
</ins>
</a>
<del class="diff-old">interface
enabled
subscribing
to
pushed
data
notifications
by
the
subscribe
()
method:
</del>
<ins class="diff-chg">objects
of
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
listed
in
a
</ins><a href="#dfn-thing-directory" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
Directory
</ins></a><ins class="diff-chg">
service.
We
set
a
timeout
for
safety.
</ins>
</p><del class="diff-old">Initialize
the
data
handler
callback
with
the
first
function
argument.
If
the
</del><div class="example" id="example-6-discover-things-via-directory">
          <div class="marker">
      <a class="self-link" href="#example-6-discover-things-via-directory">Example<bdi> 6</bdi></a><span class="example-title">: Discover Things via directory</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">        <span class="hljs-keyword">let</span> discoveryFilter = {
          <span class="hljs-attr">method</span>: <span class="hljs-string">"directory"</span>,
          <span class="hljs-attr">url</span>: <span class="hljs-string">"http://directory.wotservice.org"</span>
        };
        <span class="hljs-keyword">let</span> discovery = <span class="hljs-keyword">new</span> ThingDiscovery(discoveryFilter);
        setTimeout( <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            discovery.stop();
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Discovery stopped after timeout."</span>);
          },
          <span class="hljs-number">3000</span>);
        <span class="hljs-keyword">do</span> {
          <span class="hljs-keyword">let</span> td = <span class="hljs-keyword">await</span> discovery.next();
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Found Thing Description for "</span> + td.title);
          <span class="hljs-keyword">let</span> thing = <span class="hljs-keyword">new</span> ConsumedThing(td);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Thing name: "</span> + thing.getThingDescription().title);
        } <span class="hljs-keyword">while</span> (!discovery.done);
        <span class="hljs-keyword">if</span> (discovery.error) {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Discovery stopped because of an error: "</span> + error.message);
        }
</code></pre>
        </div><p><ins class="diff-chg">
The
</ins>
next
<del class="diff-old">argument
is
provided
and
</del>
<ins class="diff-chg">example
</ins>
is
<del class="diff-old">a
function,
initialize
the
error
handling
callback
with
that
function,
or
throw
</del>
<ins class="diff-chg">for
an
open-ended
multicast
discovery,
which
likely
won't
complete
soon
(depending
</ins>
on
<del class="diff-old">error.
If
</del>
the
<del class="diff-old">third
argument
is
provided
and
</del>
<ins class="diff-chg">underlying
protocol),
so
stopping
it
with
a
timeout
</ins>
is
a
<del class="diff-old">function,
initialize
the
completion
handler
with
that
function,
or
throw
on
error.
After
callback
initializations,
the
implementation
should
request
the
underlying
platform
to
provide
data,
error
and
completion
notifications
for
the
supported
data
source.
</del>
<ins class="diff-chg">good
idea.
It
will
likely
deliver
results
one
by
one.
</ins></p><div class="example" id="example-7-discover-things-in-a-network">
          <div class="marker">
      <a class="self-link" href="#example-7-discover-things-in-a-network">Example<bdi> 7</bdi></a><span class="example-title">: Discover Things in a network</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">        <span class="hljs-keyword">let</span> discovery = <span class="hljs-keyword">new</span> ThingDiscovery({ <span class="hljs-attr">method</span>: <span class="hljs-string">"multicast"</span> });
        setTimeout( <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            discovery.stop();
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Stopped open-ended discovery"</span>);
          },
          <span class="hljs-number">10000</span>);
        <span class="hljs-keyword">do</span> {
          <span class="hljs-keyword">let</span> td = <span class="hljs-keyword">await</span> discovery.next();
          <span class="hljs-keyword">let</span> thing = <span class="hljs-keyword">new</span> ConsumedThing(td);
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Thing name: "</span> + thing.getThingDescription().title);
        } <span class="hljs-keyword">while</span> (!discovery.done);
</code></pre>
        </div></section></section><section id="x9-security-and-privacy"><h2 id="security"><bdi class="secno">9. </bdi>
<del class="diff-old">9.
</del>
Security
and
Privacy
<a class="self-link" aria-label="§" href="#x9-security-and-privacy"></a></h2><p>
<del class="diff-old">In
general
the
security
measures
taken
to
protect
a
WoT
system
will
depend
on
the
threats
and
attackers
that
system
may
face
and
the
value
of
the
assets
needs
to
protect.
</del>
A
detailed
discussion
of
security
and
privacy
considerations
for
the
Web
of
Things,
including
a
threat
model
that
can
be
adapted
to
various
circumstances,
is
presented
in
the
informative
document
<del class="diff-old">[
WOT-SECURITY-CONSIDERATIONS
].
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-security-guidelines" title="Web of Things Security and Privacy Guidelines" data-link-type="biblio">WOT-SECURITY-GUIDELINES</a></cite>].
</ins>
This
section
<del class="diff-old">includes
</del>
<ins class="diff-chg">discusses
</ins>
only
<del class="diff-old">normative
recommendations
</del>
<ins class="diff-chg">security
and
privacy
risks
and
possible
mitigations
directly
</ins>
relevant
to
the
<ins class="diff-new">scripts
and
</ins>
WoT
<del class="diff-old">Thing
Description.
</del>
<ins class="diff-chg">Scripting
API.
</ins>
</p><p>
<del class="diff-old">When
designing
new
devices
and
services
for
use
with
the
WoT,
we
have
documented
a
</del>
<ins class="diff-chg">A
suggested
</ins>
set
of
best
practices
<ins class="diff-new">to
improve
security
for
WoT
devices
and
services
has
been
documented
</ins>
in
<del class="diff-old">[
WOT-SECURITY-BEST-PRACTICES
]
that
<em class="rfc2119" title="SHOULD">SHOULD</em>
be
followed.
This
best-practices
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-security-best-practices" title="Web of Things Security and Privacy Best Practices" data-link-type="biblio">WOT-SECURITY-BEST-PRACTICES</a></cite>].
That
</ins>
document
may
be
updated
as
security
measures
evolve.
Following
these
practices
does
not
guarantee
security,
but
it
<del class="diff-old">at
least
will
</del>
<ins class="diff-chg">might
</ins>
help
<del class="diff-old">to
</del>
avoid
common
known
<del class="diff-old">vulnerabilities
and
pitfalls.
</del>
<ins class="diff-chg">vulnerabilities.
</ins>
</p><del class="diff-old">Below
are
specific
recommendations
related
to
</del><div><p><ins class="diff-chg">The
</ins>
WoT
<del class="diff-old">runtime
implementations:
</del>
<ins class="diff-chg">security
risks
and
possible
mitigations
are
concerning
the
following
groups:
</ins></p>
<ul>
<li>
<del class="diff-old">In
basic
WoT
setups,
all
scripts
running
inside
the
</del>
<ins class="diff-chg">Implementors
of
</ins>
WoT
<del class="diff-old">runtime
are
considered
trusted,
and
therefore
there
is
no
strong
need
to
perform
strict
isolation
between
each
running
script
instance.
However,
depending
on
device
capabilities
and
deployment
use
case
scenario
risk
level
it
might
be
desirable
to
</del>
<ins class="diff-chg">Runtimes
that
</ins>
do
<del class="diff-old">so.
</del>
<ins class="diff-chg">not
implement
a
Scripting
Runtime.
The
[<cite><a class="bibref" href="#bib-wot-architecture" title="Web of Things Architecture" data-link-type="biblio">WOT-ARCHITECTURE</a></cite>]
document
provides
generic
security
guidelines
for
this
group.
</ins></li>
<li>
<del class="diff-old">For
example,
if
one
script
handles
sensitive
privacy-related
data
and
well-audited,
it
might
be
desirable
to
separate
it
from
the
rest
</del>
<ins class="diff-chg">Implementors
</ins>
of
the
<del class="diff-old">script
instances
to
minimize
the
risk
of
data
exposure
</del>
<ins class="diff-chg">WoT
Scripting
API
</ins>
in
<del class="diff-old">case
some
other
script
inside
</del>
<ins class="diff-chg">a
</ins>
WoT
<del class="diff-old">gets
compromised
during
the
runtime.
Therefore
</del>
<ins class="diff-chg">Scripting
Runtime.
This
is
</ins>
the
<del class="diff-old">WoT
runtime
<em class="rfc2119" title="SHOULD">SHOULD</em>
perform
isolation
of
script
instances
</del>
<ins class="diff-chg">main
scope
</ins>
and
<del class="diff-old">their
data
</del>
<ins class="diff-chg">is
covered
</ins>
in
<del class="diff-old">cases
when
scripts
handle
privacy-related
or
other
critical
security
data.
</del>
<ins class="diff-chg">the
</ins><a href="#sec-security-consideration-runtime"><ins class="diff-chg">
Scripting
Runtime
Security
and
Privacy
Risks
</ins></a><ins class="diff-chg">
sub-section
that
contains
normative
text
regarding
security.
</ins>
</li>
<li>
<del class="diff-old">Another
example
is
mutual
co-existence
of
different
tenants
on
a
single
WoT
device.
In
this
case
each
</del>
WoT
<del class="diff-old">runtime
instance
will
be
hosting
a
different
tenant,
</del>
<ins class="diff-chg">script
developers,
covered
in
the
</ins><a href="#sec-security-consideration-script"><ins class="diff-chg">
Script
Security
</ins>
and
<del class="diff-old">isolation
between
them
</del>
<ins class="diff-chg">Privacy
Risks
</ins></a><ins class="diff-chg">
sub-section
that
contains
informative
recommendations
concerning
security.
</ins></li></ul></div><section id="sec-security-consideration-runtime"><h3 id="x9-1-scripting-runtime-security-and-privacy-risks"><bdi class="secno">9.1 </bdi><ins class="diff-chg">
Scripting
Runtime
Security
and
Privacy
Risks
</ins><a class="self-link" aria-label="§" href="#sec-security-consideration-runtime"></a></h3><p><ins class="diff-chg">
This
section
</ins>
is
<del class="diff-old">required.
Therefore
</del>
<ins class="diff-chg">normative
and
contains
specific
risks
relevant
for
</ins>
the
WoT
<del class="diff-old">runtime
<em class="rfc2119" title="SHOULD">SHOULD</em>
perform
isolation
of
WoT
runtime
instances
</del>
<ins class="diff-chg">Scripting
Runtime.
</ins></p><section id="sec-security-consideration-input"><h4 id="x9-1-1-corrupted-input-security-and-their-data-if-privacy-risk"><bdi class="secno">9.1.1 </bdi><ins class="diff-chg">
Corrupted
Input
Security
</ins>
and
<del class="diff-old">their
data
if
</del>
<ins class="diff-chg">Privacy
Risk
</ins><a class="self-link" aria-label="§" href="#sec-security-consideration-input"></a></h4><p><ins class="diff-chg">
A
typical
way
to
compromise
any
process
is
to
send
it
</ins>
a
<del class="diff-old">WoT
device
has
more
than
</del>
<ins class="diff-chg">corrupted
input
via
</ins>
one
<del class="diff-old">tenant.
Such
isolation
</del>
<ins class="diff-chg">of
the
exposed
interfaces.
This
</ins>
can
be
<del class="diff-old">performed
within
the
WoT
Runtime
using
platform
security
mechanisms
available
on
the
device.
For
more
information
see
Section
"WoT
Servient
Single-Tenant"
and
"WoT
Servient
Multi-Tenant"
of
[
WOT-SECURITY-CONSIDERATIONS
].
WoT
scripts
are
</del>
<ins class="diff-chg">done
to
a
script
instance
</ins>
using
WoT
<del class="diff-old">Scripting
</del>
<ins class="diff-chg">interface
it
exposes.
</ins></p><dl><dt><ins class="diff-chg">
Mitigation:
</ins></dt><dd><ins class="diff-chg">
Implementors
of
this
</ins>
API
<del class="diff-old">to
implement
the
functionality
and
logic
for
WoT
Things.
</del>
<ins class="diff-chg"><em class="rfc2119" title="SHOULD">SHOULD</em>
perform
validation
on
all
script
inputs.
</ins>
In
addition
to
<del class="diff-old">providing
</del>
<ins class="diff-chg">input
validation,
</ins><a href="https://en.wikipedia.org/wiki/Fuzzing"><ins class="diff-chg">
fuzzing
</ins></a><ins class="diff-chg">
should
be
used
to
verify
that
</ins>
the
<del class="diff-old">isolation
between
script
</del>
<ins class="diff-chg">input
processing
is
done
correctly.
There
are
many
tools
</ins>
and
<del class="diff-old">runtime
instances,
the
WoT
runtime
needs
</del>
<ins class="diff-chg">techniques
in
existence
</ins>
to
<del class="diff-old">protect
</del>
<ins class="diff-chg">do
such
validation.
More
details
can
be
found
in
[<cite><a class="bibref" href="#bib-wot-security-testing" title="Web of Things Security Testing and Validation" data-link-type="biblio">WOT-SECURITY-TESTING</a></cite>].
</ins></dd></dl></section><section id="sec-security-consideration-device-direct-access"><h4 id="x9-1-2-physical-device-direct-access-security-and-privacy-risk"><bdi class="secno">9.1.2 </bdi><ins class="diff-chg">
Physical
Device
Direct
Access
Security
and
Privacy
Risk
</ins><a class="self-link" aria-label="§" href="#sec-security-consideration-device-direct-access"></a></h4><p><ins class="diff-chg">
In
case
a
script
is
compromised
or
misbehaving,
</ins>
the
underlying
physical
device
<del class="diff-old">from
</del>
<ins class="diff-chg">(and
</ins>
potentially
<del class="diff-old">misbehaving
WoT
scripts.
Therefore
</del>
<ins class="diff-chg">surrounded
environment)
can
be
damaged
if
a
script
can
use
directly
exposed
native
device
interfaces.
If
such
interfaces
lack
safety
checks
on
their
inputs,
they
might
bring
</ins>
the
<ins class="diff-new">underlying
physical
device
(or
environment)
to
an
unsafe
state
(i.e.
device
overheats
and
explodes).
</ins></p><dl><dt><ins class="diff-new">
Mitigation:
</ins></dt><dd><ins class="diff-new">
The
</ins>
WoT
<ins class="diff-new">Scripting
</ins>
Runtime
<em class="rfc2119" title="SHOULD">SHOULD</em>
avoid
directly
exposing
the
native
device
interfaces
to
the
script
developers.
<del class="diff-old">Instead
</del>
<ins class="diff-chg">Instead,
</ins>
a
WoT
<ins class="diff-new">Scripting
</ins>
Runtime
should
provide
a
hardware
abstraction
layer
for
accessing
the
native
device
interfaces.
<ins class="diff-new">Such
hardware
abstraction
layer
should
refuse
to
execute
commands
that
might
put
the
device
(or
environment)
to
an
unsafe
state.
</ins>
Additionally,
in
order
to
reduce
the
damage
to
a
physical
WoT
device
in
cases
a
<del class="diff-old">WoT
</del>
script
gets
compromised,
it
is
important
to
minimize
the
number
of
interfaces
that
are
exposed
or
accessible
to
a
particular
<del class="diff-old">WoT
</del>
script
based
on
its
functionality.
<del class="diff-old">Therefore
the
WoT
Runtime
<em class="rfc2119" title="SHOULD">SHOULD</em>
only
expose
a
minimal
set
of
interfaces
to
a
WoT
script
based
on
its
intended
functionality.
</del>
</dd></dl></section><section id="sec-security-consideration-update-provisioning"><h4 id="x9-1-3-provisioning-and-update-security-risk"><bdi class="secno">9.1.3 </bdi>
<ins class="diff-chg">Provisioning
and
Update
Security
Risk
</ins><a class="self-link" aria-label="§" href="#sec-security-consideration-update-provisioning"></a></h4><p>
If
the
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
supports
post-manufacturing
provisioning
or
<del class="diff-old">update
</del>
<ins class="diff-chg">updates
</ins>
of
<del class="diff-old">WoT
</del>
scripts,
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
or
any
related
data
(including
security
credentials),
it
can
be
a
major
attack
vector.
An
attacker
can
try
to
modify
any
above
described
<del class="diff-old">part
</del>
<ins class="diff-chg">element
</ins>
during
the
update
or
provisioning
process
or
simply
provision
attacker's
code
and
data
directly.
<del class="diff-old">Therefore,
if
WoT
Runtime
supports
post-manufacturing
</del>
</p><dl>
<dt>
<ins class="diff-chg">Mitigation:
</ins></dt><dd><ins class="diff-chg">
Post-manufacturing
</ins>
provisioning
or
update
of
<del class="diff-old">WoT
</del>
scripts,
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
or
any
related
<del class="diff-old">data,
such
operations
<em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
<ins class="diff-chg">data
should
</ins>
be
done
in
a
secure
fashion.
A
set
of
recommendations
for
secure
update
and
post-manufacturing
provisioning
can
be
found
in
<del class="diff-old">[
WOT-SECURITY-BEST-PRACTICES
].
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-security-guidelines" title="Web of Things Security and Privacy Guidelines" data-link-type="biblio">WOT-SECURITY-GUIDELINES</a></cite>].
</ins></dd></dl></section><section id="sec-security-consideration-credentials-storage"><h4 id="x9-1-4-security-credentials-storage-security-and-privacy-risk"><bdi class="secno">9.1.4 </bdi><ins class="diff-chg">
Security
Credentials
Storage
Security
and
Privacy
Risk
</ins><a class="self-link" aria-label="§" href="#sec-security-consideration-credentials-storage"></a></h4><p>
Typically
the
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
needs
to
store
the
security
credentials
that
are
provisioned
to
a
WoT
device
to
operate
in
WoT
network.
<del class="diff-old">The
</del>
<ins class="diff-chg">If
an
attacker
can
compromise
the
</ins>
confidentiality
or
integrity
of
these
<del class="diff-old">credentials
should
not
be
compromised.
Therefore
</del>
<ins class="diff-chg">credentials,
then
it
can
obtain
access
to
</ins>
the
WoT
<del class="diff-old">runtime
<em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
<ins class="diff-chg">assets,
impersonate
WoT
things
or
devices
or
create
Denial-Of-Service
(DoS)
attacks.
</ins></p><dl><dt><ins class="diff-chg">
Mitigation:
</ins></dt><dd><ins class="diff-chg">
The
WoT
Scripting
Runtime
should
</ins>
securely
store
the
provisioned
security
credentials,
guaranteeing
their
integrity
and
confidentiality.
In
case
there
are
more
than
one
tenant
on
a
single
WoT-enabled
device,
a
WoT
<ins class="diff-new">Scripting
</ins>
Runtime
<del class="diff-old"><em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
<ins class="diff-chg">should
</ins>
guarantee
isolation
of
each
tenant
provisioned
security
credentials.
Additionally,
in
order
to
minimize
a
risk
that
provisioned
security
credentials
get
compromised,
the
WoT
<del class="diff-old">runtime
</del>
<ins class="diff-chg">Scripting
Runtime
</ins>
should
not
<del class="diff-old">have
any
way
for
WoT
scripts
to
query
these
credentials.
Therefore,
the
WoT
Runtime
<em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em>
</del>
expose
any
API
for
<del class="diff-old">WoT
</del>
scripts
to
query
the
provisioned
security
credentials.
</dd></dl></section></section><section id="sec-security-consideration-script" class="informative"><h3 id="x9-2-script-security-and-privacy-risks"><bdi class="secno">9.2 </bdi>
<ins class="diff-chg">Script
Security
and
Privacy
Risks
</ins><a class="self-link" aria-label="§" href="#sec-security-consideration-script"></a></h3><p><em>This section is non-normative.</em></p><p>
<del class="diff-old">Some
additional
</del>
<ins class="diff-chg">This
section
describes
</ins>
specific
<del class="diff-old">recommendations
</del>
<ins class="diff-chg">risks
</ins>
relevant
for
<del class="diff-old">WoT
</del>
script
<del class="diff-old">developers:
</del>
<ins class="diff-chg">developers.
</ins>
</p><section id="sec-security-consideration-script-input"><h4 id="x9-2-1-corrupted-script-input-security-and-privacy-risk"><bdi class="secno">9.2.1 </bdi>
<ins class="diff-chg">Corrupted
Script
Input
Security
and
Privacy
Risk
</ins><a class="self-link" aria-label="§" href="#sec-security-consideration-script-input"></a></h4><p>
A
<del class="diff-old">typical
way
to
compromise
any
process
is
to
send
it
a
corrupted
</del>
<ins class="diff-chg">script
instance
may
receive
data
formats
defined
by
the
TD,
or
data
formats
defined
by
the
applications.
While
the
WoT
Scripting
Runtime
<em class="rfc2119" title="SHOULD">SHOULD</em>
perform
validation
on
all
</ins>
input
<del class="diff-old">via
one
of
</del>
<ins class="diff-chg">fields
defined
by
</ins>
the
<del class="diff-old">exposed
interfaces.
Therefore
</del>
<ins class="diff-chg">TD,
scripts
may
be
still
exploited
by
input
data.
</ins></p><dl><dt><ins class="diff-chg">
Mitigation:
</ins></dt><dd><ins class="diff-chg">
Script
</ins>
developers
<del class="diff-old"><em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
<ins class="diff-chg">should
</ins>
perform
validation
on
all
<del class="diff-old">WoT
</del>
<ins class="diff-chg">application
defined
</ins>
script
<del class="diff-old">inputs,
including
</del>
<ins class="diff-chg">inputs.
In
addition
to
input
validation,
</ins>
<a href="https://en.wikipedia.org/wiki/Fuzzing">
fuzzing
<del class="diff-old">.
</del>
</a>
<ins class="diff-chg">could
be
used
to
verify
that
the
input
processing
is
done
correctly.
</ins>
There
are
many
<del class="diff-old">tool
</del>
<ins class="diff-chg">tools
</ins>
and
techniques
in
existence
to
do
such
validation.
More
details
can
be
found
in
<del class="diff-old">[
WOT-SECURITY-TESTING
].
As
any
software,
complex
scripts
with
a
lot
of
functionality
presents
a
higher
risk
of
development
mistakes.
Such
scripts
are
also
hard
to
verify
and
test
appropriately.
Therefore
developers
SHOUD
minimize
the
functionality
and
complexity
of
WoT
scripts.
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-security-testing" title="Web of Things Security Testing and Validation" data-link-type="biblio">WOT-SECURITY-TESTING</a></cite>].
</ins></dd></dl></section><section id="sec-security-consideration-script-processing"><h4 id="x9-2-2-denial-of-service-security-risk"><bdi class="secno">9.2.2 </bdi><ins class="diff-chg">
Denial
Of
Service
Security
Risk
</ins><a class="self-link" aria-label="§" href="#sec-security-consideration-script-processing"></a></h4><p>
If
a
<del class="diff-old">WoT
</del>
script
performs
a
heavy
functional
processing
on
received
requests
before
the
request
is
authenticated,
it
presents
a
great
risk
for
Denial-Of-Service
(DOS)
attacks.
<del class="diff-old">Therefore
WoT
scripts
<em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
</p><dl>
<dt>
<ins class="diff-chg">Mitigation:
</ins></dt><dd><ins class="diff-chg">
Scripts
should
</ins>
avoid
heavy
functional
processing
without
prior
successful
authentication
of
requestor.
The
set
of
recommended
authentication
mechanisms
can
be
found
in
<del class="diff-old">[
WOT-SECURITY-BEST-PRACTICES
].
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-security-best-practices" title="Web of Things Security and Privacy Best Practices" data-link-type="biblio">WOT-SECURITY-BEST-PRACTICES</a></cite>].
</ins></dd></dl></section><section id="sec-security-consideration-script-stale-td"><h4 id="x9-2-3-stale-td-security-risk"><bdi class="secno">9.2.3 </bdi><ins class="diff-chg">
Stale
TD
Security
Risk
</ins><a class="self-link" aria-label="§" href="#sec-security-consideration-script-stale-td"></a></h4><p><ins class="diff-chg">
During
the
lifetime
of
a
</ins>
WoT
<del class="diff-old">developers
should
remember
that
</del>
<ins class="diff-chg">network,
</ins>
a
content
of
a
TD
can
<del class="diff-old">change,
including
</del>
<ins class="diff-chg">change.
This
includes
</ins>
its
<del class="diff-old">identified,
id,
</del>
<ins class="diff-chg">identifier,
</ins>
which
<del class="diff-old">is
</del>
<ins class="diff-chg">might
</ins>
not
<ins class="diff-new">be
</ins>
an
immutable
<del class="diff-old">identifier.
Therefore
WoT
scripts
<em class="rfc2119" title="SHOULD">SHOULD</em>
</del>
<ins class="diff-chg">one
and
might
be
updated
periodically.
</ins></p><dl><dt><ins class="diff-chg">
Mitigation:
</ins></dt><dd><ins class="diff-chg">
Scripts
should
</ins>
use
<del class="diff-old">the
provided
WoT
script
</del>
<ins class="diff-chg">this
</ins>
API
to
subscribe
for
notifications
on
TD
<del class="diff-old">changes.
</del>
<ins class="diff-chg">changes
and
do
not
rely
on
TD
values
to
remain
persistent.
</ins></dd></dl><div class="note" id="issue-container-generatedID-10"><div role="heading" class="ednote-title marker" id="h-ednote-5" aria-level="5"><span>Editor's note</span></div><p class=""><ins class="diff-chg">
While
stale
TDs
can
present
a
potential
problem
for
WoT
network
operation,
it
might
not
be
a
security
risk.
</ins></p></div></section><del class="diff-old">10.
</del></section></section><section id="terminology-and-conventions"><h2 id="x10-terminology-and-conventions"><bdi class="secno">10. </bdi>
Terminology
and
conventions
<a class="self-link" aria-label="§" href="#terminology-and-conventions"></a></h2><p>
The
generic
WoT
terminology
is
defined
in
<del class="diff-old">[
WOT-ARCHITECTURE
]:
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-architecture" title="Web of Things Architecture" data-link-type="biblio">WOT-ARCHITECTURE</a></cite>]:
</ins><dfn data-lt="Things|Thing" data-dfn-type="dfn" data-plurals="things" id="dfn-things">
Thing
</dfn>,
<dfn data-lt="Thing Descriptions|Thing Description" data-dfn-type="dfn" id="dfn-thing-descriptions">
Thing
Description
</dfn>
(in
short
<dfn data-dfn-type="dfn" id="dfn-td">
TD
</dfn>
),
<dfn data-dfn-type="dfn" id="dfn-web-of-things">
Web
of
Things
</dfn>
(in
short
<b>
<i>
WoT
</i>
</b>
),
<dfn data-dfn-type="dfn" id="dfn-wot-interface">
WoT
Interface
<del class="diff-old">,
</del>
</dfn>
<ins class="diff-chg">(same
as
</ins><dfn data-dfn-type="dfn" id="dfn-wot-network-interface"><ins class="diff-chg">
WoT
network
interface
</ins></dfn><ins class="diff-chg">
),
</ins><dfn data-dfn-type="dfn" id="dfn-protocol-bindings">
Protocol
Bindings
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-wot-runtime">
WoT
Runtime
</dfn>,
<dfn data-lt="consume|consume a TD|consuming a TD|Consuming a Thing Description" data-dfn-type="dfn" id="dfn-consume">
Consuming
a
Thing
Description
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-thing-directory">
Thing
Directory
</dfn>,
<dfn data-dfn-type="dfn" id="dfn-wot-interactions">
WoT
Interactions
</dfn>,
<dfn data-lt="Properties|Property" data-dfn-type="dfn" data-plurals="properties" id="dfn-properties">
Property
</dfn>,
<dfn data-lt="Actions|Action" data-dfn-type="dfn" data-plurals="actions" id="dfn-actions">
Action
</dfn>,
<dfn data-lt="Events|WoT-Event|Event" data-dfn-type="dfn" data-plurals="events" id="dfn-events">
Event
</dfn>
etc.
</p><p>
<dfn data-dfn-type="dfn" id="dfn-json-ld">
JSON-LD
</dfn>
is
defined
in
<del class="diff-old">[
JSON-LD
]
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-json-ld" title="JSON-LD 1.0" data-link-type="biblio">JSON-LD</a></cite>]
</ins>
as
a
JSON
document
that
is
augmented
with
support
for
Linked
Data.
</p><p>
The
terms
<dfn data-dfn-type="dfn" id="dfn-url-and" data-no-export=""><a href="https://url.spec.whatwg.org/#concept-url">
URL
<del class="diff-old">and
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-url-scheme" data-no-export=""><a href="https://url.spec.whatwg.org/#concept-url-scheme">
<ins class="diff-chg">URL
scheme
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-url-host" data-no-export=""><a href="https://url.spec.whatwg.org/#concept-url-host"><ins class="diff-chg">
URL
host
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-url-path" data-no-export=""><a href="https://url.spec.whatwg.org/#concept-url-path">
URL
path
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-url-record" data-no-export=""><a href="https://url.spec.whatwg.org/#concept-url">
<ins class="diff-new">URL
record
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-parse-a-url" data-no-export=""><a href="https://url.spec.whatwg.org/#parse-a-url"><ins class="diff-new">
parse
a
URL
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-absolute-url-string" data-no-export=""><a href="https://url.spec.whatwg.org/#absolute-url-string"><ins class="diff-new">
absolute-URL
string
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-path-absolute-url-string" data-no-export=""><a href="https://url.spec.whatwg.org/#path-absolute-url-string"><ins class="diff-new">
path-absolute-URL
string
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-basic-url-parser" data-no-export=""><a href="https://url.spec.whatwg.org/#concept-basic-url-parser"><ins class="diff-new">
basic
URL
parser
</ins>
</a></dfn>
are
defined
in
<del class="diff-old">[
URL
].
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-url" title="URL Standard" data-link-type="biblio">URL</a></cite>].
</ins>
</p><p>
The
<del class="diff-old">following
</del>
terms
<dfn data-dfn-type="dfn" id="dfn-mime-type" data-no-export=""><a href="https://mimesniff.spec.whatwg.org/#mime-type">
<ins class="diff-new">MIME
type
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-parsing-a-mime-type" data-no-export=""><a href="https://mimesniff.spec.whatwg.org/#parsing-a-mime-type"><ins class="diff-new">
Parsing
a
MIME
type
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-serializing-a-mime-type" data-no-export=""><a href="https://mimesniff.spec.whatwg.org/#serializing-a-mime-type"><ins class="diff-new">
Serializing
a
MIME
type
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-valid-mime-type-string" data-no-export=""><a href="https://mimesniff.spec.whatwg.org/#valid-mime-type"><ins class="diff-new">
valid
MIME
type
string
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-json-mime-type" data-no-export=""><a href="https://mimesniff.spec.whatwg.org/#json-mime-type"><ins class="diff-new">
JSON
MIME
type
</ins></a></dfn>
are
defined
in
<del class="diff-old">[
HTML52
]
and
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-mimesniff" title="MIME Sniffing Standard" data-link-type="biblio">MIMESNIFF</a></cite>].
</ins></p><p><ins class="diff-chg">
The
terms
</ins><dfn data-dfn-type="dfn" id="dfn-utf-8-encoding" data-no-export=""><a href="https://encoding.spec.whatwg.org/#utf-8"><ins class="diff-chg">
UTF-8
encoding
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-utf-8-decode" data-no-export=""><a href="https://encoding.spec.whatwg.org/#utf-8-decode"><ins class="diff-chg">
UTF-8
decode
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-encode" data-no-export=""><a href="https://encoding.spec.whatwg.org/#encode"><ins class="diff-chg">
encode
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-decode" data-no-export=""><a href="https://encoding.spec.whatwg.org/#decode"><ins class="diff-chg">
decode
</ins></a></dfn>
are
<del class="diff-old">used
</del>
<ins class="diff-chg">defined
</ins>
in
<del class="diff-old">the
context
of
browser
implementations:
browsing
context
,
top-level
browsing
context
,
global
object
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-encoding" title="Encoding Standard" data-link-type="biblio">ENCODING</a></cite>].
</ins></p><p><dfn data-dfn-type="dfn" id="dfn-string" data-no-export=""><a href="https://infra.spec.whatwg.org/#string"><ins class="diff-chg">
string
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-parse-json-from-bytes" data-no-export=""><a href="https://infra.spec.whatwg.org/#parse-json-from-bytes"><ins class="diff-chg">
parse
JSON
from
bytes
</ins>
</a></dfn>
<ins class="diff-new">and
</ins><dfn data-dfn-type="dfn" id="dfn-serialize-json-to-bytes" data-no-export=""><a href="https://infra.spec.whatwg.org/#serialize-json-to-bytes"><ins class="diff-new">
serialize
JSON
to
bytes
</ins></a></dfn>,<ins class="diff-new">
are
defined
in
[<cite><a class="bibref" href="#bib-infra" title="Infra Standard" data-link-type="biblio">INFRA</a></cite>].
</ins></p><p><ins class="diff-new">
The
terms
</ins><dfn data-dfn-type="dfn" id="dfn-incumbent-settings-object-throw-document" data-no-export=""><a href="https://heycam.github.io/webidl/#dfn-throw">
<del class="diff-old">,
incumbent
settings
object
</del>
<code>
<ins class="diff-chg">throw
</ins></code>
<del class="diff-old">,
Document
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-document-base-url-creating-window" data-no-export=""><a href="https://heycam.github.io/webidl/#dfn-create-exception">
<del class="diff-old">,
document
base
URL
</del>
<code>
<ins class="diff-chg">creating
</ins></code>
<del class="diff-old">,
Window
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-windowproxy-domstring-origin" data-no-export=""><a href="https://heycam.github.io/webidl/#idl-DOMString">
<del class="diff-old">,
WindowProxy
</del>
<code>
<ins class="diff-chg">DOMString
</ins></code>
<del class="diff-old">,
origin
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-ascii-serialized-origin-dictionary-executing-algorithms-in-parallel" data-no-export=""><a href="https://heycam.github.io/webidl/#idl-dictionary">
<del class="diff-old">,
ASCII
serialized
origin
</del>
<code>
<ins class="diff-chg">Dictionary
</ins></code>
<del class="diff-old">,
executing
algorithms
in
parallel
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-queue-a-task-arraybuffer-task-source" data-no-export=""><a href="https://heycam.github.io/webidl/#idl-ArrayBuffer">
<del class="diff-old">,
queue
a
task
</del>
<code>
<ins class="diff-chg">ArrayBuffer
</ins></code>
<del class="diff-old">,
task
source
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-iframe-buffersource-valid-mime-type" data-no-export=""><a href="https://heycam.github.io/webidl/#common-BufferSource">
<del class="diff-old">,
iframe
</del>
<code>
<ins class="diff-chg">BufferSource
</ins></code>
<del class="diff-old">,
valid
MIME
type
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-a-browsing-context-refers-to-the-environment-in-which-document-objects-are-presented-to-the-user-a-given-browsing-context-has-a-single-any-windowproxy" data-no-export=""><a href="https://heycam.github.io/webidl/#idl-any">
<del class="diff-old">.
A
browsing
context
refers
to
the
environment
in
which
Document
objects
are
presented
to
the
user.
A
given
browsing
context
has
a
single
</del>
<code>
<ins class="diff-new">any
</ins></code>
<del class="diff-old">WindowProxy
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-not-present" data-no-export=""><a href="https://heycam.github.io/webidl/#dfn-present">
<ins class="diff-chg">not
present
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-object-but-it-can-have-many-domexception-document" data-no-export=""><a href="https://heycam.github.io/webidl/#idl-DOMException">
<del class="diff-old">object,
but
it
can
have
many
</del>
<code>
<ins class="diff-new">DOMException
</ins></code>
<del class="diff-old">Document
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-objects-with-their-associated-aborterror-window" data-no-export=""><a href="https://heycam.github.io/webidl/#aborterror">
<del class="diff-old">objects,
with
their
associated
</del>
<code>
<ins class="diff-new">AbortError
</ins></code>
<del class="diff-old">Window
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-syntaxerror-objects-the-script-execution-context-associated-with-the-browsing-context-identifies-the-entity-which-invokes-this-api-which-can-be-a-web-app-a-web-page-or-an-iframe-the-term-secure-context-is-defined-in" data-no-export=""><a href="https://heycam.github.io/webidl/#syntaxerror">
<code>
<ins class="diff-new">SyntaxError
</ins>
</code>
<del class="diff-old">objects.
The
script
execution
context
associated
with
the
browsing
context
identifies
the
entity
which
invokes
this
API,
which
can
be
a
web
app
,
a
web
page
,
or
an
iframe
.
The
term
secure
context
</del>
<del class="diff-old">is
defined
in
[
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-webappsec-notsupportederror" data-no-export=""><a href="https://heycam.github.io/webidl/#notsupportederror">
<del class="diff-old">WEBAPPSEC
</del>
<code>
<ins class="diff-chg">NotSupportedError
</ins></code>
<del class="diff-old">].
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-networkerror-error-evalerror-rangeerror-referenceerror-syntaxerror" data-no-export=""><a href="https://heycam.github.io/webidl/#networkerror">
<code>
<ins class="diff-chg">NetworkError
</ins></code>
<del class="diff-old">Error
,
EvalError
,
RangeError
,
ReferenceError
,
SyntaxError
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-typeerror" data-no-export=""><a href="https://heycam.github.io/webidl/#exceptiondef-typeerror">
<code>
TypeError
</code>
</a></dfn>,
<del class="diff-old">URIError
</del>
<dfn data-dfn-type="dfn" id="dfn-notreadableerror-script-execution-context" data-no-export=""><a href="https://heycam.github.io/webidl/#notreadableerror">
<del class="diff-old">,
</del>
<code>
<ins class="diff-chg">NotReadableError
</ins></code>
<del class="diff-old">script
execution
context
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-promise-timeouterror-json" data-no-export=""><a href="https://heycam.github.io/webidl/#timeouterror">
<del class="diff-old">,
Promise
</del>
<code>
<ins class="diff-chg">TimeoutError
</ins></code>
<del class="diff-old">,
JSON
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-json-stringify-nomodificationallowederror-and-json-parse" data-no-export=""><a href="https://heycam.github.io/webidl/#nomodificationallowederror">
<del class="diff-old">,
JSON.stringify
</del>
<code>
<ins class="diff-chg">NoModificationAllowedError
</ins></code>
<del class="diff-old">and
JSON.parse
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-securityerror" data-no-export=""><a href="https://heycam.github.io/webidl/#securityerror">
<code>
<ins class="diff-chg">SecurityError
</ins></code></a></dfn>,
are
defined
in
<del class="diff-old">[
ECMASCRIPT
].
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-webidl" title="Web IDL" data-link-type="biblio">WEBIDL</a></cite>].
</ins>
</p><p>
<dfn data-dfn-type="dfn" id="dfn-domstring-usvstring-arraybuffer-promise-buffersource" data-no-export=""><a href="https://tc39.github.io/ecma262/#sec-promise-objects">
<del class="diff-old">DOMString
,
USVString
,
ArrayBuffer
,
</del>
<a class="respec-offending-element" title="Error: No matching dfn found." id="respec-offender-error-no-matching-dfn-found-51">
<ins class="diff-chg">Promise
</ins></a>
<del class="diff-old">BufferSource
</del>
</a></dfn>,
<dfn data-dfn-type="dfn" id="dfn-error" data-no-export=""><a href="https://tc39.github.io/ecma262/#sec-error-objects">
<ins class="diff-chg">Error
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-json" data-no-export=""><a href="https://tc39.github.io/ecma262/#sec-json-object"><ins class="diff-chg">
JSON
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-json-stringify" data-no-export=""><a href="https://tc39.github.io/ecma262/#sec-json.stringify"><ins class="diff-chg">
JSON.stringify
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-json-parse" data-no-export=""><a href="https://tc39.github.io/ecma262/#sec-json.parse"><ins class="diff-chg">
JSON.parse
</ins>
</a></dfn>
and
<del class="diff-old">any
</del>
<dfn data-dfn-type="dfn" id="dfn-internal-slots" data-no-export=""><a href="https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots">
<ins class="diff-chg">internal
slots
</ins>
</a></dfn>
are
defined
in
<del class="diff-old">[
WEBIDL
].
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-ecmascript" title="ECMAScript Language Specification" data-link-type="biblio">ECMASCRIPT</a></cite>].
</ins>
</p><p>
The
<ins class="diff-new">terms
</ins><dfn data-dfn-type="dfn" id="dfn-browsing-context" data-no-export=""><a href="https://html.spec.whatwg.org/multipage/#browsing-context"><ins class="diff-new">
browsing
context
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-top-level-browsing-context" data-no-export=""><a href="https://html.spec.whatwg.org/multipage/#top-level-browsing-context"><ins class="diff-new">
top-level
browsing
context
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-global-object" data-no-export=""><a href="https://html.spec.whatwg.org/multipage/#global-object"><ins class="diff-new">
global
object
</ins></a></dfn>,<dfn data-dfn-type="dfn" id="dfn-current-settings-object" data-no-export=""><a href="https://html.spec.whatwg.org/multipage/#current-settings-object"><ins class="diff-new">
current
settings
object
</ins></a></dfn>,<ins class="diff-new">
executing
</ins>
algorithms
<del class="diff-old">utf-8
encode
</del>
<dfn data-dfn-type="dfn" id="dfn-in-parallel" data-no-export=""><a href="https://html.spec.whatwg.org/multipage/#in-parallel">
<ins class="diff-chg">in
parallel
</ins>
</a></dfn>
<del class="diff-old">,
</del>
<ins class="diff-chg">are
defined
in
[<cite><a class="bibref" href="#bib-html5" title="HTML5" data-link-type="biblio">HTML5</a></cite>]
</ins>
and
<del class="diff-old">utf-8
decode
</del>
<ins class="diff-chg">are
used
in
the
context
of
browser
implementations.
</ins></p><p><ins class="diff-chg">
The
term
</ins><a href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#secure-context"><dfn data-dfn-type="dfn" id="dfn-secure-context"><ins class="diff-chg">
secure
context
</ins>
</dfn>
</a>
<del class="diff-old">are
</del>
<ins class="diff-chg">is
</ins>
defined
in
<del class="diff-old">[
ENCODING
].
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-webappsec" title="Secure Contexts" data-link-type="biblio">WEBAPPSEC</a></cite>].
</ins>
</p><p>
<dfn data-dfn-type="dfn" id="dfn-iana-media-type">
IANA
media
type
</dfn>
s
(formerly
known
as
MIME
types)
are
defined
in
<a href="http://tools.ietf.org/html/rfc2046">
RFC2046
</a>.
</p><p>
The
terms
<dfn data-dfn-type="dfn" id="dfn-hyperlink-reference">
hyperlink
reference
</dfn>
and
<dfn data-dfn-type="dfn" id="dfn-relation-type">
relation
type
</dfn>
are
defined
in
<del class="diff-old">[
HTML52
]
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-html5" title="HTML5" data-link-type="biblio">HTML5</a></cite>]
</ins>
and
<a href="https://tools.ietf.org/html/rfc8288">
RFC8288
</a>.
</p></section><del class="diff-old">11.
Conformance
</del><section class="appendix" id="api-design-rationale"><h2 id="a-api-design-rationale"><bdi class="secno">A. </bdi>
<ins class="diff-chg">API
design
rationale
</ins>
<a class="self-link" aria-label="§" href="#api-design-rationale"></a></h2><p>
<del class="diff-old">As
well
as
sections
marked
as
non-normative,
all
authoring
guidelines,
diagrams,
examples,
and
notes
in
this
specification
are
non-normative.
Everything
else
</del>
<ins class="diff-chg">API
rationale
usually
belongs
to
a
separate
document,
but
</ins>
in
<del class="diff-old">this
specification
is
normative.
</del>
<ins class="diff-chg">the
WoT
case
the
complexity
of
the
context
justifies
including
basic
rationale
here.
</ins>
</p><section id="approaches-to-wot-application-development"><h3 id="a-1-approaches-to-wot-application-development"><bdi class="secno">A.1 </bdi>
<ins class="diff-chg">Approaches
to
WoT
application
development
</ins><a class="self-link" aria-label="§" href="#approaches-to-wot-application-development"></a></h3><p>
The
<del class="diff-old">key
words
<em class="rfc2119" title="MAY">MAY</em>
,
<em class="rfc2119" title="MUST">MUST</em>
,
<em class="rfc2119" title="SHOULD">SHOULD</em>
,
</del>
<ins class="diff-chg">WoT
Interest
Group
</ins>
and
<del class="diff-old"><em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em>
are
</del>
<ins class="diff-chg">Working
Group
have
explored
different
approaches
to
application
development
for
WoT
that
have
been
all
implemented
and
tested.
</ins></p><section id="no-scripting-api"><h4 id="a-1-1-no-scripting-api"><bdi class="secno">A.1.1 </bdi><ins class="diff-chg">
No
Scripting
API
</ins><a class="self-link" aria-label="§" href="#no-scripting-api"></a></h4><p><ins class="diff-chg">
It
is
possible
</ins>
to
<ins class="diff-new">develop
WoT
applications
that
only
use
the
</ins><a href="#dfn-wot-network-interface" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
WoT
network
interface
</ins></a>,<ins class="diff-new">
typically
exposed
by
a
WoT
gateway
that
presents
a
REST-ful
API
towards
clients
and
implements
IoT
protocol
plugins
that
communicate
with
supported
IoT
deployments.
One
such
implementation
is
the
</ins><a href="https://iot.mozilla.org/"><ins class="diff-new">
Mozilla
WebThings
</ins></a><ins class="diff-new">
platform.
</ins></p></section><section id="simple-scripting-api"><h4 id="a-1-2-simple-scripting-api"><bdi class="secno">A.1.2 </bdi><ins class="diff-new">
Simple
Scripting
API
</ins><a class="self-link" aria-label="§" href="#simple-scripting-api"></a></h4><p><ins class="diff-new">
WoT
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins></a><ins class="diff-new">
s
show
good
synergy
with
software
objects,
so
a
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins></a><ins class="diff-new">
can
</ins>
be
<del class="diff-old">interpreted
</del>
<ins class="diff-chg">represented
</ins>
as
<del class="diff-old">described
</del>
<ins class="diff-chg">a
software
object,
with
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Properties
</ins></a><ins class="diff-chg">
represented
as
object
properties,
</ins><a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Action
</ins></a><ins class="diff-chg">
s
as
methods,
and
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
s
as
events.
In
addition,
metadata
is
stored
</ins>
in
<del class="diff-old">[
RFC2119
</del>
<ins class="diff-chg">special
properties.
Consuming
and
exposing
is
done
with
factory
methods
that
produce
a
software
object
that
directly
represents
a
remote
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins>
</a>
<del class="diff-old">].
</del>
<ins class="diff-chg">and
its
interactions.
One
such
implementation
is
the
</ins><a href="https://github.com/draggett/arena-webhub"><ins class="diff-chg">
Arena
Web
Hub
</ins></a><ins class="diff-chg">
project.
</ins>
</p><p>
<del class="diff-old">This
document
defines
conformance
criteria
</del>
<ins class="diff-chg">In
the
next
example,
a
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a>
that
<del class="diff-old">apply
to
</del>
<ins class="diff-chg">represents
interactions
with
</ins>
a
<del class="diff-old">single
product:
</del>
<ins class="diff-chg">lock
would
look
like
</ins>
the
<del class="diff-old">UA
(user
agent)
that
implements
</del>
<ins class="diff-chg">following:
</ins>
the
<del class="diff-old">interfaces
it
contains.
</del>
<var>
<ins class="diff-chg">status
</ins></var><ins class="diff-chg">
property
and
the
</ins><code><ins class="diff-chg">
open()
</ins></code><ins class="diff-chg">
method
are
directly
exposed
on
the
object.
</ins>
</p><div class="example" id="example-8-open-a-lock-with-a-simple-api">
          <div class="marker">
      <a class="self-link" href="#example-8-open-a-lock-with-a-simple-api">Example<bdi> 8</bdi></a><span class="example-title">: Open a lock with a simple API</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">          <span class="hljs-keyword">let</span> lock = <span class="hljs-keyword">await</span> WoT.consume(‘https:<span class="hljs-comment">//td.my.com/lock-00123’);</span>
          <span class="hljs-built_in">console</span>.log(lock.status);
          lock.open(<span class="hljs-string">'withThisKey'</span>);
</code></pre>
        </div></section><section id="this-api-aligned-with-wot-td"><h4 id="a-1-3-this-api-aligned-with-wot-td"><bdi class="secno">A.1.3 </bdi>
This
<ins class="diff-new">API,
aligned
with
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
</ins><a class="self-link" aria-label="§" href="#this-api-aligned-with-wot-td"></a></h4><p><ins class="diff-new">
Since
the
direct
mapping
of
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Thing
</ins></a><ins class="diff-new">
s
to
software
objects
have
had
some
challenges,
this
</ins>
specification
<del class="diff-old">can
be
used
for
implementing
</del>
<ins class="diff-chg">takes
another
approach
that
exposes
software
objects
to
represent
the
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
metadata
as
data
property
and
</ins>
the
WoT
<del class="diff-old">Scripting
</del>
<ins class="diff-chg">interactions
as
methods.
One
implementation
is
</ins><a href="https://github.com/eclipse/thingweb.node-wot"><ins class="diff-chg">
node-wot
</ins></a><ins class="diff-chg">
in
the
the
</ins><a href="http://www.thingweb.io/"><ins class="diff-chg">
Eclipse
ThingWeb
</ins></a><ins class="diff-chg">
project,
which
is
the
current
reference
implementation
of
the
</ins>
API
<ins class="diff-new">specified
</ins>
in
<del class="diff-old">multiple
programming
languages.
</del>
<ins class="diff-chg">this
document.
</ins></p><p>
The
<del class="diff-old">interface
definitions
</del>
<ins class="diff-chg">same
example
now
would
look
like
the
following:
the
</ins><var><ins class="diff-chg">
status
</ins></var><ins class="diff-chg">
property
and
the
</ins><code><ins class="diff-chg">
open()
</ins></code><ins class="diff-chg">
method
</ins>
are
<del class="diff-old">specified
</del>
<ins class="diff-chg">represented
indirectly.
</ins></p><div class="example" id="example-9-open-a-lock">
          <div class="marker">
      <a class="self-link" href="#example-9-open-a-lock">Example<bdi> 9</bdi></a><span class="example-title">: Open a lock</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">          <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> fetch(‘https:<span class="hljs-comment">//td.my.com/lock-00123’);</span>
          <span class="hljs-keyword">let</span> td = <span class="hljs-keyword">await</span> res.json();
          <span class="hljs-keyword">let</span> lock = <span class="hljs-keyword">new</span> ConsumedThing(td);
          <span class="hljs-built_in">console</span>.log(lock.readProperty(‘status’));
          lock.invokeAction(‘open’, <span class="hljs-string">'withThisKey'</span>);
</code></pre>
        </div></section><p><ins class="diff-chg">
In
conclusion,
the
WoT
WG
decided
to
explore
the
third
option
that
closely
follows
the
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
specification.
Based
on
this,
a
simple
API
can
also
be
implemented.
Since
Scripting
is
an
optional
module
</ins>
in
<del class="diff-old">[
WEBIDL
].
</del>
<ins class="diff-chg">WoT,
this
leaves
room
for
applications
that
only
use
the
WoT
network
interface.
Therefore
all
three
approaches
above
are
supported
by
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>].
</ins>
</p><p>
<del class="diff-old">The
user
agent
(UA)
may
</del>
<ins class="diff-chg">Moreover,
the
WoT
network
interface
can
</ins>
be
implemented
in
<del class="diff-old">the
browser,
or
</del>
<ins class="diff-chg">many
languages
and
runtimes.
Consider
this
API
an
example
for
what
needs
to
be
taken
into
consideration
when
designing
a
Scripting
API
for
WoT.
</ins></p></section><section id="fetching-and-validating-a-td"><h3 id="a-2-fetching-and-validating-a-td"><bdi class="secno">A.2 </bdi><ins class="diff-chg">
Fetching
and
validating
a
TD
</ins><a class="self-link" aria-label="§" href="#fetching-and-validating-a-td"></a></h3><p><ins class="diff-chg">
The
</ins><code><ins class="diff-chg">
fetch(url)
</ins></code><ins class="diff-chg">
method
has
been
part
of
this
API
</ins>
in
<ins class="diff-new">earlier
versions.
However,
now
fetching
</ins>
a
<del class="diff-old">separate
runtime
environment,
</del>
<a href="#dfn-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">TD
</ins></a><ins class="diff-chg">
given
a
URL
should
be
done
with
an
external
method,
</ins>
such
as
<del class="diff-old">Node.js
</del>
<ins class="diff-chg">the
</ins><a href="https://fetch.spec.whatwg.org/#fetch-api"><ins class="diff-chg">
Fetch
API
</ins>
</a>
or
<del class="diff-old">small
embedded
runtimes.
Implementations
</del>
<ins class="diff-chg">a
HTTP
client
library,
which
offer
already
standardized
options
on
specifying
fetch
details.
The
reason
is
</ins>
that
<ins class="diff-new">while
simple
fetch
operations
(covering
most
</ins>
use
<del class="diff-old">ECMAScript
executed
</del>
<ins class="diff-chg">cases)
could
be
done
</ins>
in
<del class="diff-old">a
browser
</del>
<ins class="diff-chg">this
API,
when
various
fetch
options
were
needed,
there
was
no
point
in
duplicating
existing
work
</ins>
to
<del class="diff-old">implement
the
APIs
defined
</del>
<ins class="diff-chg">re-expose
those
options
</ins>
in
this
<del class="diff-old">document
<em class="rfc2119" title="MUST">MUST</em>
implement
them
in
</del>
<ins class="diff-chg">API.
</ins></p><p><ins class="diff-chg">
Since
fetching
</ins>
a
<del class="diff-old">manner
consistent
with
the
ECMAScript
Bindings
</del>
<a href="#dfn-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">TD
</ins></a><ins class="diff-chg">
has
been
scoped
out,
and
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a><ins class="diff-chg">
validation
is
</ins>
defined
<ins class="diff-new">externally
</ins>
in
<del class="diff-old">the
Web
IDL
</del>
<ins class="diff-chg">[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>],
that
is
scoped
out,
too.
This
</ins>
specification
<del class="diff-old">[
WEBIDL
</del>
<ins class="diff-chg">expects
a
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins>
</a>
<del class="diff-old">].
</del>
<ins class="diff-chg">as
</ins><a href="https://infra.spec.whatwg.org/#parse-json-from-bytes"><ins class="diff-chg">
parsed
JSON
object
</ins></a><ins class="diff-chg">
that
has
been
validated
according
to
the
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>]
specification.
</ins>
</p></section><section id="factory-vs-constructors"><h3 id="a-3-factory-vs-constructors"><bdi class="secno">A.3 </bdi>
<ins class="diff-new">Factory
vs
constructors
</ins><a class="self-link" aria-label="§" href="#factory-vs-constructors"></a></h3><p>
<del class="diff-old">Implementations
</del>
<ins class="diff-chg">The
factory
methods
for
consuming
and
exposing
</ins><a href="#dfn-things" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Thing
</ins></a><ins class="diff-chg">
s
are
asynchronous
and
fully
validate
the
input
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a>.<ins class="diff-chg">
In
addition,
one
can
also
construct
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ConsumedThing
</ins></a><ins class="diff-chg">
and
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
ExposedThing
</ins></a><ins class="diff-chg">
by
providing
a
parsed
and
validated
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
TD
</ins></a>.<ins class="diff-chg">
Platform
initialization
is
then
done
when
needed
during
the
WoT
interactions.
So
applications
</ins>
that
<del class="diff-old">use
TypeScript
or
ECMAScript
in
</del>
<ins class="diff-chg">prefer
validating
</ins>
a
<del class="diff-old">runtime
</del>
<a href="#dfn-td" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">TD
</ins></a><ins class="diff-chg">
themselves,
may
use
the
constructors,
whereas
applications
that
leave
validation
</ins>
to
<del class="diff-old">implement
</del>
<ins class="diff-chg">implementations
and
prefer
interactions
initialized
up
front
<em class="rfc2119" title="SHOULD">SHOULD</em>
use
</ins>
the
<del class="diff-old">APIs
defined
in
this
document
<em class="rfc2119" title="MUST">MUST</em>
implement
them
in
a
manner
consistent
with
</del>
<ins class="diff-chg">factory
methods
on
</ins>
the
<del class="diff-old">TypeScript
Bindings
defined
in
</del>
<a href="#dfn-wot-api-object" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">WoT
API
object
</ins></a>.</p></section><section id="observers"><h3 id="a-4-observers"><bdi class="secno">A.4 </bdi><ins class="diff-chg">
Observers
</ins><a class="self-link" aria-label="§" href="#observers"></a></h3><p><ins class="diff-chg">
Earlier
drafts
used
</ins>
the
<del class="diff-old">TypeScript
specification
[
TYPESCRIPT
</del>
<a href="https://github.com/tc39/proposal-observable">
<ins class="diff-chg">Observer
</ins>
</a>
<del class="diff-old">].
</del>
<ins class="diff-chg">construct,
but
since
it
has
not
become
standard,
a
new
design
was
needed
that
was
light
enough
for
embedded
implementations.
Therefore
observing
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
changes
and
handling
WoT
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
s
is
done
with
callback
registrations.
</ins>
</p></section><section id="using-events"><h3 id="a-5-using-events"><bdi class="secno">A.5 </bdi>
<ins class="diff-chg">Using
Events
</ins><a class="self-link" aria-label="§" href="#using-events"></a></h3><div><p>This
<del class="diff-old">document
serves
a
general
description
of
</del>
<ins class="diff-chg">API
ended
up
not
using
software
events
at
all,
for
</ins>
the
<ins class="diff-new">following
reasons:
</ins></p><ul><li><ins class="diff-new">
Subscription
to
</ins>
WoT
<del class="diff-old">Scripting
API.
Language
</del>
<a href="#dfn-events" class="internalDFN" data-link-type="dfn">
<ins class="diff-chg">Event
</ins></a><ins class="diff-chg">
s
may
be
different
from
handling
software
events
(subscription
might
need
parameters,
might
involve
security
tokens
etc).
</ins></li><li><ins class="diff-chg">
Most
implementations
are
for
Node.js
</ins>
and
<del class="diff-old">runtime
specific
</del>
<ins class="diff-chg">browser
implementations
will
likely
be
libraries
(because
possible
dependency
management
</ins>
issues
<del class="diff-old">are
discussed
</del>
in
<del class="diff-old">separate
extensions
</del>
<ins class="diff-chg">native
implementations),
using
Events
has
been
challenging.
</ins></li><li><ins class="diff-chg">
Observing
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Property
</ins></a><ins class="diff-chg">
changes
and
handling
WoT
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-chg">
Event
</ins></a><ins class="diff-chg">
s
is
done
with
the
solution
above.
</ins></li></ul>
</div></section><section id="polymorphic-functions"><h3 id="a-6-polymorphic-functions"><bdi class="secno">A.6 </bdi><ins class="diff-chg">
Polymorphic
functions
</ins><a class="self-link" aria-label="§" href="#polymorphic-functions"></a></h3><p><ins class="diff-chg">
The
reason
to
use
function
names
like
</ins><code><ins class="diff-chg">
readProperty()
</ins></code>,<code><ins class="diff-chg">
readMultipleProperties()
</ins></code><ins class="diff-chg">
etc.
instead
</ins>
of
<del class="diff-old">this
document.
</del>
<ins class="diff-chg">a
generic
polymorphic
</ins><code><ins class="diff-chg">
read()
</ins></code><ins class="diff-chg">
function
is
that
the
current
names
map
exactly
to
the
</ins><code><ins class="diff-chg">
"op"
</ins></code><ins class="diff-chg">
vocabulary
from
the
</ins><a href="https://w3c.github.io/wot-thing-description/#form"><ins class="diff-chg">
Form
</ins></a><ins class="diff-chg">
definition
in
[<cite><a class="bibref" href="#bib-wot-td" title="WoT Thing Description " data-link-type="biblio">WOT-TD</a></cite>].
</ins>
</p></section></section><section class="appendix" id="Changes"><h2 id="b-changes"><bdi class="secno">B. </bdi>
Changes
<a class="self-link" aria-label="§" href="#Changes"></a></h2><p><del class="diff-old">A.
</del></p><div><p>The
following
is
a
list
of
major
changes
to
the
document.
<ins class="diff-new">Major
versions
of
this
specification
are
the
following:
</ins></p><ul><li><ins class="diff-new">
First
Public
Working
Draft
</ins><a href="https://www.w3.org/TR/2017/WD-wot-scripting-api-20170914/"><ins class="diff-new">
September
2017
</ins></a>.</li><li><ins class="diff-new">
Working
Draft
</ins><a href="https://www.w3.org/TR/2018/WD-wot-scripting-api-20180405/"><ins class="diff-new">
April
2018
</ins></a>.</li><li><ins class="diff-new">
Working
Draft
</ins><a href="https://www.w3.org/TR/2018/WD-wot-scripting-api-20181129/"><ins class="diff-new">
November
2018
</ins></a>.</li><li><ins class="diff-new">
This
version,
introducing
the
following
major
changes:
</ins><ul><li><ins class="diff-new">
Remove
</ins><code><ins class="diff-new">
fetch()
</ins></code><ins class="diff-new">
for
fetching
a
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins></a><ins class="diff-new">
(delegated
to
external
API).
</ins></li><li><ins class="diff-new">
Remove
</ins><code><ins class="diff-new">
Observer
</ins></code><ins class="diff-new">
and
use
</ins><a href="https://w3ctag.github.io/design-principles/"><ins class="diff-new">
<abbr title="World Wide Web Consortium">W3C</abbr>
TAG
recommended
design
patterns
</ins></a>.</li><li><ins class="diff-new">
Align
the
discovery
API
to
other
similar
APIs
(such
as
</ins><a href="https://www.w3.org/TR/generic-sensor/#the-sensor-interface"><ins class="diff-new">
<abbr title="World Wide Web Consortium">W3C</abbr>
Generic
Sensor
API
</ins></a><ins class="diff-new">
).
</ins></li><li><ins class="diff-new">
Remove
the
large
data
definition
API
for
constructing
</ins><a href="#dfn-td" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
TD
</ins></a><ins class="diff-new">
s
and
leverage
using
</ins><a href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
ThingDescription
</ins></a><ins class="diff-new">
instead.
</ins></li><li><ins class="diff-new">
Add
missing
algorithms
and
rework
most
existing
ones.
</ins></li><li><ins class="diff-new">
Allow
constructors
for
</ins><a href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
ConsumedThing
</ins></a><ins class="diff-new">
and
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
ExposedThing
</ins></a>.</li><li><ins class="diff-new">
Add
API
rationale
as
an
appendix
to
this
document.
</ins></li></ul></li></ul>
</div><p>
For
a
complete
list
of
changes,
see
the
<a href="https://github.com/w3c/wot-scripting-api/commits/master">
github
change
log
</a>.
You
can
also
view
the
<a href="https://github.com/w3c/wot-scripting-api/issues?page=1&amp;state=closed">
recently
closed
issues
</a>.
</p><del class="diff-old">Make
the
Scripting
API
refer
to
(rather
then
locally
re-define)
the
data
structures
defined
in
the
Thing
Description
specification
.
</del></section><section id="open-issues"><h2 class="appendix" id="openissues"><bdi class="secno">C. </bdi>
Open
issues
<a class="self-link" aria-label="§" href="#open-issues"></a></h2><p><del class="diff-old">B.
</del></p><div><p>The
following
problems
are
being
discussed
and
need
most
attention:</p>
<ul>
<li>
<del class="diff-old">Security
related
metadata
(https://github.com/w3c/wot-scripting-api/issues/91).
Providing
Protocol
Binding
for
ExposedThing
(https://github.com/w3c/wot-scripting-api/issues/45).
</del>
Script
management
and
runtime
related
issues
(https://github.com/w3c/wot-scripting-api/issues/)
</li>
<li>
<ins class="diff-new">An
explicit
API
for
adding
and
removing
</ins><a href="#dfn-properties" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Property
</ins></a>,<a href="#dfn-actions" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Action
</ins></a><ins class="diff-new">
and
</ins><a href="#dfn-events" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
Event
</ins></a><ins class="diff-new">
definitions
on
</ins><a href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn"><ins class="diff-new">
ExposedThing
</ins></a><ins class="diff-new">
(it
was
present
in
earlier
versions,
but
removed
for
complexity
and
a
simpler
way
to
do
it.
</ins></li>
</ul>
</div></section><del class="diff-old">C.
Acknowledgments
</del><section class="appendix" id="idl-index"><h2 id="d-full-web-idl"><bdi class="secno">D. </bdi>
<ins class="diff-chg">Full
Web
IDL
</ins><a class="self-link" aria-label="§" href="#idl-index"></a></h2><pre class="idl def" id="actual-idl-index"><span data-idl="" class="idlTypedef" data-title="ThingDescription">typedef<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-object">object</a></span> <dfn data-export="" data-dfn-type="typedef" data-idl="typedef" data-title="ThingDescription" class="idlID" data-dfn-for="ThingDescription"><code>ThingDescription</code></dfn>;</span>

<span data-idl="" class="idlInterface" data-title="WOT">      [<span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface" data-cite-path="window-object.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface" data-lt="WorkerGlobalScope" data-cite-path="workers.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
      interface <dfn data-export="" data-dfn-type="interface" data-idl="interface" data-title="WOT" class="idlID" data-dfn-for="WOT"><code>WOT</code></dfn> {<span class="idlSectionComment">
        // methods defined in UA conformance classes
      </span>};</span>

<span data-idl="" class="idlInterface" data-title="WOT">      partial interface <a class="internalDFN idlID" data-link-for="" data-link-type="interface" href="#dom-wot"><code>WOT</code></a> {<span data-idl="" class="idlMethod" data-title="consume" data-dfn-for="WOT"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn">ConsumedThing</a>&gt;</span> <a class="internalDFN idlName" data-link-for="WOT" data-link-type="method" href="#dom-wot-consume"><code>consume</code></a>(<span class="idlType"><a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a></span> <span class="idlParamName">td</span>);</span>
      };</span>

<span data-idl="" class="idlInterface" data-title="WOT">      partial interface <a class="internalDFN idlID" data-link-for="" data-link-type="interface" href="#dom-wot"><code>WOT</code></a> {<span data-idl="" class="idlMethod" data-title="produce" data-dfn-for="WOT"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">ExposedThing</a>&gt;</span> <a class="internalDFN idlName" data-link-for="WOT" data-link-type="method" href="#dom-wot-produce"><code>produce</code></a>(<span class="idlType"><a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a></span> <span class="idlParamName">td</span>);</span>
      };</span>

<span data-idl="" class="idlInterface" data-title="WOT">      partial interface <a class="internalDFN idlID" data-link-for="" data-link-type="interface" href="#dom-wot"><code>WOT</code></a> {<span data-idl="" class="idlMethod" data-title="discover" data-dfn-for="WOT"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-thingdiscovery" class="internalDFN" data-link-type="dfn">ThingDiscovery</a></span> <a class="internalDFN idlName" data-link-for="WOT" data-link-type="method" href="#dom-wot-discover"><code>discover</code></a>(optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-thingfilter" class="internalDFN" data-link-type="dfn">ThingFilter</a></span> <span class="idlParamName">filter</span> = null);</span>
      };</span>

<span data-idl="" class="idlInterface" data-title="ConsumedThing">      [<span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface" data-cite-path="window-object.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface" data-lt="WorkerGlobalScope" data-cite-path="workers.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
      interface <dfn data-export="" data-dfn-type="interface" data-idl="interface" data-title="ConsumedThing" class="idlID" data-dfn-for="ConsumedThing"><code>ConsumedThing</code></dfn> {<span data-idl="" class="idlConstructor" data-title="constructor" data-dfn-for="ConsumedThing">
        <dfn data-export="" data-dfn-type="constructor" data-idl="constructor" data-title="constructor" data-dfn-for="ConsumedThing" data-lt="ConsumedThing.constructor()|ConsumedThing.constructor|constructor()|constructor"><code>constructor</code></dfn>(<span class="idlType"><a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a></span> <span class="idlParamName">td</span>);</span><span data-idl="" class="idlMethod" data-title="readProperty" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-readproperty"><code>readProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">propertyName</span>,
                                  optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" data-title="readAllProperties" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-propertymap" class="internalDFN" data-link-type="dfn">PropertyMap</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-readallproperties"><code>readAllProperties</code></a>(optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" data-title="readMultipleProperties" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-propertymap" class="internalDFN" data-link-type="dfn">PropertyMap</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-readmultipleproperties"><code>readMultipleProperties</code></a>(<span class="idlType">
                                  <a data-xref-type="dfn" data-cite-path="" data-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence">sequence</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>&gt;</span> <span class="idlParamName">propertyNames</span>,
                                  optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" data-title="writeProperty" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-writeproperty"><code>writeProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">propertyName</span>,<span class="idlType">
                                    <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">value</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" data-title="writeMultipleProperties" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-writemultipleproperties"><code>writeMultipleProperties</code></a>(<span class="idlType"><a data-xref-type="_IDL_" href="#dfn-propertymap" class="internalDFN" data-link-type="dfn">PropertyMap</a></span> <span class="idlParamName">valueMap</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" data-title="invokeAction" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-invokeaction"><code>invokeAction</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">actionName</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">params</span> = null,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" data-title="observeProperty" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-observeproperty"><code>observeProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType">
                                    <a data-xref-type="_IDL_" href="#dfn-wotlistener" class="internalDFN" data-link-type="dfn">WotListener</a></span> <span class="idlParamName">listener</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" data-title="unobserveProperty" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-unobserveproperty"><code>unobserveProperty</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>);</span><span data-idl="" class="idlMethod" data-title="subscribeEvent" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-subscribeevent"><code>subscribeEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType">
                                    <a data-xref-type="_IDL_" href="#dfn-wotlistener" class="internalDFN" data-link-type="dfn">WotListener</a></span> <span class="idlParamName">listener</span>,
                                    optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlMethod" data-title="unsubscribeEvent" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-unsubscribeevent"><code>unsubscribeEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>);</span><span data-idl="" class="idlMethod" data-title="getThingDescription" data-dfn-for="ConsumedThing"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a></span> <a class="internalDFN idlName" data-link-for="ConsumedThing" data-link-type="method" href="#dom-consumedthing-getthingdescription"><code>getThingDescription</code></a>();</span>
      };</span><span data-idl="" class="idlDictionary" data-title="InteractionOptions">
      dictionary <dfn data-export="" data-dfn-type="dictionary" data-idl="dictionary" data-title="InteractionOptions" class="idlID" data-dfn-for="InteractionOptions"><code>InteractionOptions</code></dfn> {<span data-idl="" class="idlMember" data-title="uriVariables" data-dfn-for="InteractionOptions"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-object">object</a></span> <dfn data-export="" data-dfn-type="dict-member" data-idl="field" data-title="uriVariables" data-dfn-for="InteractionOptions" data-type="object" class="idlName"><code>uriVariables</code></dfn>;</span>
      };</span><span data-idl="" class="idlTypedef" data-title="PropertyMap">
      typedef<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-object">object</a></span> <dfn data-export="" data-dfn-type="typedef" data-idl="typedef" data-title="PropertyMap" class="idlID" data-dfn-for="PropertyMap"><code>PropertyMap</code></dfn>;</span><span data-idl="" class="idlCallback" data-title="WotListener">
      callback <dfn data-export="" data-dfn-type="callback" data-idl="callback" data-title="WotListener" class="idlID" data-dfn-for="WotListener"><code>WotListener</code></dfn> =<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">data</span>);</span>

<span data-idl="" class="idlInterface" data-title="ExposedThing">      [<span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface" data-cite-path="window-object.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface" data-lt="WorkerGlobalScope" data-cite-path="workers.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
      interface <dfn data-export="" data-dfn-type="interface" data-idl="interface" data-title="ExposedThing" class="idlID" data-dfn-for="ExposedThing"><code>ExposedThing</code></dfn>: <span class="idlSuperclass"><a data-xref-type="_IDL_" href="#dfn-consumedthing" class="internalDFN" data-link-type="dfn">ConsumedThing</a></span> {<span data-idl="" class="idlMethod" data-title="setPropertyReadHandler" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">ExposedThing</a></span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-setpropertyreadhandler"><code>setPropertyReadHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType">
                <a data-xref-type="_IDL_" href="#dfn-propertyreadhandler" class="internalDFN" data-link-type="dfn">PropertyReadHandler</a></span> <span class="idlParamName">readHandler</span>);</span><span data-idl="" class="idlMethod" data-title="setPropertyWriteHandler" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">ExposedThing</a></span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-setpropertywritehandler"><code>setPropertyWriteHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType">
                <a data-xref-type="_IDL_" href="#dfn-propertywritehandler" class="internalDFN" data-link-type="dfn">PropertyWriteHandler</a></span> <span class="idlParamName">writeHandler</span>);</span><span data-idl="" class="idlMethod" data-title="setActionHandler" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="_IDL_" href="#dfn-exposedthing" class="internalDFN" data-link-type="dfn">ExposedThing</a></span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-setactionhandler"><code>setActionHandler</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-actionhandler" class="internalDFN" data-link-type="dfn">ActionHandler</a></span> <span class="idlParamName">action</span>);</span><span data-idl="" class="idlMethod" data-title="emitEvent" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-emitevent"><code>emitEvent</code></a>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <span class="idlParamName">name</span>,<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">data</span>);</span><span data-idl="" class="idlMethod" data-title="expose" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-expose"><code>expose</code></a>();</span><span data-idl="" class="idlMethod" data-title="destroy" data-dfn-for="ExposedThing"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ExposedThing" data-link-type="method" href="#dom-exposedthing-destroy"><code>destroy</code></a>();</span>
      };</span><span data-idl="" class="idlCallback" data-title="PropertyReadHandler">
      callback <dfn data-export="" data-dfn-type="callback" data-idl="callback" data-title="PropertyReadHandler" class="idlID" data-dfn-for="PropertyReadHandler"><code>PropertyReadHandler</code></dfn> =<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a>&gt;</span>(
              optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlCallback" data-title="PropertyWriteHandler">
      callback <dfn data-export="" data-dfn-type="callback" data-idl="callback" data-title="PropertyWriteHandler" class="idlID" data-dfn-for="PropertyWriteHandler"><code>PropertyWriteHandler</code></dfn> =<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a>&gt;</span>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">value</span>,
              optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span><span data-idl="" class="idlCallback" data-title="ActionHandler">
      callback <dfn data-export="" data-dfn-type="callback" data-idl="callback" data-title="ActionHandler" class="idlID" data-dfn-for="ActionHandler"><code>ActionHandler</code></dfn> =<span class="idlType"> <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a>&gt;</span>(<span class="idlType"><a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-any">any</a></span> <span class="idlParamName">params</span>,
              optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-interactionoptions" class="internalDFN" data-link-type="dfn">InteractionOptions</a></span> <span class="idlParamName">options</span> = null);</span>

<span data-idl="" class="idlInterface" data-title="ThingDiscovery">      [<span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#SecureContext">SecureContext</a></span>, <span class="extAttr"><a data-xref-type="extended-attribute" data-cite-path="" data-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed">Exposed</a>=(<a data-xref-type="interface" data-cite-path="window-object.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/window-object.html#window">Window</a>,<a data-xref-type="interface" data-lt="WorkerGlobalScope" data-cite-path="workers.html" data-type="interface" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">Worker</a>)</span>]
      interface <dfn data-export="" data-dfn-type="interface" data-idl="interface" data-title="ThingDiscovery" class="idlID" data-dfn-for="ThingDiscovery"><code>ThingDiscovery</code></dfn> {<span data-idl="" class="idlConstructor" data-title="constructor" data-dfn-for="ThingDiscovery">
        <dfn data-export="" data-dfn-type="constructor" data-idl="constructor" data-title="constructor" data-dfn-for="ThingDiscovery" data-lt="ThingDiscovery.constructor()|ThingDiscovery.constructor|constructor()|constructor"><code>constructor</code></dfn>(optional<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-thingfilter" class="internalDFN" data-link-type="dfn">ThingFilter</a></span> <span class="idlParamName">filter</span> = null);</span><span data-idl="" class="idlAttribute" data-title="filter" data-dfn-for="ThingDiscovery">
        readonly attribute<span class="idlType"> <a data-xref-type="_IDL_" href="#dfn-thingfilter" class="internalDFN" data-link-type="dfn">ThingFilter</a>?</span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="attribute" href="#dom-thingdiscovery-filter"><code>filter</code></a>;</span><span data-idl="" class="idlAttribute" data-title="active" data-dfn-for="ThingDiscovery">
        readonly attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="attribute" href="#dom-thingdiscovery-active"><code>active</code></a>;</span><span data-idl="" class="idlAttribute" data-title="done" data-dfn-for="ThingDiscovery">
        readonly attribute<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-boolean">boolean</a></span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="attribute" href="#dom-thingdiscovery-done"><code>done</code></a>;</span><span data-idl="" class="idlAttribute" data-title="error" data-dfn-for="ThingDiscovery">
        readonly attribute<span class="idlType"> <a data-xref-type="_IDL_" data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-error-objects">Error</a>?</span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="attribute" href="#dom-thingdiscovery-error"><code>error</code></a>;</span><span data-idl="" class="idlMethod" data-title="start" data-dfn-for="ThingDiscovery"><span class="idlType">
        <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="method" href="#dom-thingdiscovery-start"><code>start</code></a>();</span><span data-idl="" class="idlMethod" data-title="next" data-dfn-for="ThingDiscovery"><span class="idlType">
        <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-promise">Promise</a>&lt;<a data-xref-type="_IDL_" href="#dfn-thingdescription" class="internalDFN" data-link-type="dfn">ThingDescription</a>&gt;</span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="method" href="#dom-thingdiscovery-next"><code>next</code></a>();</span><span data-idl="" class="idlMethod" data-title="stop" data-dfn-for="ThingDiscovery"><span class="idlType">
        <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-void">void</a></span> <a class="internalDFN idlName" data-link-for="ThingDiscovery" data-link-type="method" href="#dom-thingdiscovery-stop"><code>stop</code></a>();</span>
      };</span>

<span data-idl="" class="idlTypedef" data-title="DiscoveryMethod">typedef<span class="idlType"> <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></span> <dfn data-export="" data-dfn-type="typedef" data-idl="typedef" data-title="DiscoveryMethod" class="idlID" data-dfn-for="DiscoveryMethod"><code>DiscoveryMethod</code></dfn>;</span>

<span data-idl="" class="idlDictionary" data-title="ThingFilter">        dictionary <dfn data-export="" data-dfn-type="dictionary" data-idl="dictionary" data-title="ThingFilter" class="idlID" data-dfn-for="ThingFilter"><code>ThingFilter</code></dfn> {<span data-idl="" class="idlMember" data-title="method" data-dfn-for="ThingFilter"><span class="idlType">
          (<a data-xref-type="_IDL_" href="#dfn-discoverymethod" class="internalDFN" data-link-type="dfn">DiscoveryMethod</a> or <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>)</span> <dfn data-export="" data-dfn-type="dict-member" data-idl="field" data-title="method" data-dfn-for="ThingFilter" data-type="DiscoveryMethod|DOMString" class="idlName"><code>method</code></dfn> = "any";</span><span data-idl="" class="idlMember" data-title="url" data-dfn-for="ThingFilter"><span class="idlType">
          <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>?</span> <a class="internalDFN idlName" data-link-for="ThingFilter" data-link-type="dict-member" href="#dom-thingfilter-url"><code>url</code></a>;</span><span data-idl="" class="idlMember" data-title="query" data-dfn-for="ThingFilter"><span class="idlType">
          <a data-xref-type="_IDL_" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>?</span> <a class="internalDFN idlName" data-link-for="ThingFilter" data-link-type="dict-member" href="#dom-thingfilter-query"><code>query</code></a>;</span><span data-idl="" class="idlMember" data-title="fragment" data-dfn-for="ThingFilter"><span class="idlType">
          <a data-xref-type="interface" data-cite-path="" data-type="interface" href="https://heycam.github.io/webidl/#idl-object">object</a>?</span> <a class="internalDFN idlName" data-link-for="ThingFilter" data-link-type="dict-member" href="#dom-thingfilter-fragment"><code>fragment</code></a>;</span>
        };</span></pre></section><section class="appendix" id="acknowledgements"><h2 id="e-acknowledgements"><bdi class="secno">E. </bdi><ins class="diff-chg">
Acknowledgements
</ins>
<a class="self-link" aria-label="§" href="#acknowledgements"></a></h2><p>
Special
thanks
to
former
editor
Johannes
Hund
(until
August
2017,
when
at
Siemens
AG)
<ins class="diff-new">and
Kazuaki
Nimura
(until
December
2018)
</ins>
for
developing
this
specification.
Also,
the
editors
would
like
to
thank
Dave
Raggett,
Matthias
Kovatsch,
Michael
<del class="diff-old">Koster
and
</del>
<ins class="diff-chg">Koster,
Elena
Reshetova,
</ins>
Michael
McCool
<ins class="diff-new">as
well
as
the
other
WoT
WG
members
</ins>
for
their
<del class="diff-old">comments
</del>
<ins class="diff-chg">comments,
contributions
</ins>
and
guidance.
</p></section><del class="diff-old">D.
References
D.1
Normative
references
[ECMASCRIPT]
ECMAScript
Language
Specification
.
Ecma
International.
URL:
https://tc39.github.io/ecma262/
[ENCODING]
Encoding
.
Anne
van
Kesteren;
Joshua
Bell;
Addison
Phillips.
<abbr title="World Wide Web Consortium">W3C</abbr>.
15
December
2016.
<abbr title="World Wide Web Consortium">W3C</abbr>
Candidate
Recommendation.
URL:
https://www.w3.org/TR/encoding/
[HTML52]
HTML
5.2
.
Steve
Faulkner;
Arron
Eicholz;
Travis
Leithead;
Alex
Danilo;
Sangwhan
Moon;
Erika
Doyle
Navara;
Theresa
O'Connor;
Robin
Berjon.
<abbr title="World Wide Web Consortium">W3C</abbr>.
14
December
2017.
<abbr title="World Wide Web Consortium">W3C</abbr>
Recommendation.
URL:
https://www.w3.org/TR/html52/
[JSON-LD]
JSON-LD
1.0
.
Manu
Sporny;
Gregg
Kellogg;
Markus
Lanthaler.
<abbr title="World Wide Web Consortium">W3C</abbr>.
16
January
2014.
<abbr title="World Wide Web Consortium">W3C</abbr>
Recommendation.
URL:
https://www.w3.org/TR/json-ld/
[RFC2119]
Key
words
for
use
in
RFCs
to
Indicate
Requirement
Levels
.
S.
Bradner.
IETF.
March
1997.
Best
Current
Practice.
URL:
https://tools.ietf.org/html/rfc2119
[TYPESCRIPT]
TypeScript
Language
Specification
.
Microsoft.
1
October
2012.
URL:
https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md
[URL]
URL
Standard
.
Anne
van
Kesteren.
WHATWG.
Living
Standard.
URL:
https://url.spec.whatwg.org/
[WEBAPPSEC]
Secure
Contexts
.
<abbr title="World Wide Web Consortium">W3C</abbr>.
17
July
2015.
URL:
https://w3c.github.io/webappsec/specs/powerfulfeatures
[WEBIDL]
Web
IDL
.
Cameron
McCormack;
Boris
Zbarsky;
Tobie
Langel.
<abbr title="World Wide Web Consortium">W3C</abbr>.
15
December
2016.
<abbr title="World Wide Web Consortium">W3C</abbr>
Editor's
Draft.
URL:
https://heycam.github.io/webidl/
[WOT-ARCHITECTURE]
Web
of
Things
Architecture
.
<abbr title="World Wide Web Consortium">W3C</abbr>.
20
August
2017.
URL:
https://w3c.github.io/wot-architecture/
[WOT-SECURITY-BEST-PRACTICES]
Web
of
Things
Security
and
Privacy
Best
Practices
(WIP)
.
<abbr title="World Wide Web Consortium">W3C</abbr>.
WIP.
URL:
https://github.com/w3c/wot-security/blob/master/wot-security-best-practices.md
[WOT-SECURITY-CONSIDERATIONS]
Web
of
Things
Security
and
Privacy
Considerations
.
<abbr title="World Wide Web Consortium">W3C</abbr>.
28
August
2017.
URL:
https://w3c.github.io/wot-security/
[WOT-SECURITY-TESTING]
Web
of
Things
Security
Testing
and
Validation
.
<abbr title="World Wide Web Consortium">W3C</abbr>.
WIP.
URL:
https://github.com/w3c/wot-security/blob/master/wot-security-testing.md
[WOT-TD]
WoT
Thing
Description
.
<abbr title="World Wide Web Consortium">W3C</abbr>.
21
October
2018.
URL:
https://www.w3.org/TR/2018/WD-wot-thing-description-20181021/
D.2
Informative
references
[HTML]
HTML
Standard
.
Anne
van
Kesteren;
Domenic
Denicola;
Ian
Hickson;
Philip
Jägenstedt;
Simon
Pieters.
WHATWG.
Living
Standard.
URL:
https://html.spec.whatwg.org/multipage/
↑
</del><div class="" style="background-image: linear-gradient(transparent, rgba(0, 0, 0, 0.05) 40%, rgba(0, 0, 0, 0.1)); font: 12px sans-serif; color: rgb(102, 102, 102); border-top: 1px solid rgb(153, 153, 153); border-right: 1px solid rgb(153, 153, 153); border-left: 1px solid rgb(153, 153, 153); position: fixed; bottom: 0px; right: 25px; border-radius: 3px 3px 0px 0px; background-color: rgb(238, 238, 238); z-index: 2147483647;"><div style="float: left; padding: 5px;"><span style="background-color: rgb(255, 255, 255); border: 1px solid rgb(153, 153, 153); padding: 1px 5px; box-shadow: rgb(221, 221, 221) 0px 1px 3px inset; border-radius: 2px;">0 of 3546</span></div><div title="Keyboard nav: use &quot;k&quot; to jump to previous change." style="float: left; padding: 5px 15px; border-left: 1px solid rgb(153, 153, 153); cursor: pointer;">‹ previous</div><div title="Keyboard nav: use &quot;j&quot; to jump to next change." style="float: left; padding: 5px 15px; border-left: 1px solid rgb(153, 153, 153); cursor: pointer;">next ›</div></div><section id="references" class="appendix">
      <h2 id="f-references"><bdi class="secno">F. </bdi>References<a class="self-link" aria-label="§" href="#references"></a></h2>
      
    <section id="normative-references">
        <h3 id="f-1-normative-references"><bdi class="secno">F.1 </bdi>Normative references<a class="self-link" aria-label="§" href="#normative-references"></a></h3>
      <dl class="bibliography">
        <dt id="bib-ecmascript">[ECMASCRIPT]</dt><dd><a href="https://tc39.github.io/ecma262/"><cite>ECMAScript Language Specification</cite></a>.  Ecma International. URL: <a href="https://tc39.github.io/ecma262/">https://tc39.github.io/ecma262/</a></dd><dt id="bib-encoding">[ENCODING]</dt><dd><a href="https://encoding.spec.whatwg.org/"><cite>Encoding Standard</cite></a>. Anne van Kesteren.  WHATWG. Living Standard. URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a></dd><dt id="bib-html">[HTML]</dt><dd><a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van Kesteren; Domenic Denicola; Ian Hickson; Philip Jägenstedt; Simon Pieters.  WHATWG. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a></dd><dt id="bib-html5">[HTML5]</dt><dd><a href="https://www.w3.org/TR/html5/"><cite>HTML5</cite></a>. Ian Hickson; Robin Berjon; Steve Faulkner; Travis Leithead; Erika Doyle Navara; Theresa O'Connor; Silvia Pfeiffer.  W3C. 27 March 2018. W3C Recommendation. URL: <a href="https://www.w3.org/TR/html5/">https://www.w3.org/TR/html5/</a></dd><dt id="bib-infra">[INFRA]</dt><dd><a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Anne van Kesteren; Domenic Denicola.  WHATWG. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a></dd><dt id="bib-json-ld">[JSON-LD]</dt><dd><a href="https://www.w3.org/TR/json-ld/"><cite>JSON-LD 1.0</cite></a>. Manu Sporny; Gregg Kellogg; Markus Lanthaler.  W3C. 16 January 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld/">https://www.w3.org/TR/json-ld/</a></dd><dt id="bib-mimesniff">[MIMESNIFF]</dt><dd><a href="https://mimesniff.spec.whatwg.org/"><cite>MIME Sniffing Standard</cite></a>. Gordon P. Hemsley.  WHATWG. Living Standard. URL: <a href="https://mimesniff.spec.whatwg.org/">https://mimesniff.spec.whatwg.org/</a></dd><dt id="bib-rfc2119">[RFC2119]</dt><dd><a href="https://tools.ietf.org/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a></dd><dt id="bib-rfc8174">[RFC8174]</dt><dd><a href="https://tools.ietf.org/html/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc8174">https://tools.ietf.org/html/rfc8174</a></dd><dt id="bib-typescript">[TYPESCRIPT]</dt><dd><a href="https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md"><cite>TypeScript Language Specification</cite></a>.  Microsoft. 1 October 2012. URL: <a href="https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md">https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md</a></dd><dt id="bib-url">[URL]</dt><dd><a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Anne van Kesteren.  WHATWG. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a></dd><dt id="bib-webappsec">[WEBAPPSEC]</dt><dd><a href="https://w3c.github.io/webappsec/specs/powerfulfeatures"><cite>Secure Contexts</cite></a>.  W3C. 17 July 2015. URL: <a href="https://w3c.github.io/webappsec/specs/powerfulfeatures">https://w3c.github.io/webappsec/specs/powerfulfeatures</a></dd><dt id="bib-webidl">[WEBIDL]</dt><dd><a href="https://heycam.github.io/webidl/"><cite>Web IDL</cite></a>. Boris Zbarsky.  W3C. 15 December 2016. W3C Editor's Draft. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a></dd><dt id="bib-wot-architecture">[WOT-ARCHITECTURE]</dt><dd><a href="https://w3c.github.io/wot-architecture/"><cite>Web of Things Architecture</cite></a>.  W3C. 20 August 2017. URL: <a href="https://w3c.github.io/wot-architecture/">https://w3c.github.io/wot-architecture/</a></dd><dt id="bib-wot-protocol-bindings">[WOT-PROTOCOL-BINDINGS]</dt><dd><a href="https://w3c.github.io/wot-binding-templates/"><cite>Web of Things Protocol Binding Templates</cite></a>.  W3C. 20 August 2017. URL: <a href="https://w3c.github.io/wot-binding-templates/">https://w3c.github.io/wot-binding-templates/</a></dd><dt id="bib-wot-security-best-practices">[WOT-SECURITY-BEST-PRACTICES]</dt><dd><a href="https://github.com/w3c/wot-security/blob/master/wot-security-best-practices.md"><cite>Web of Things Security and Privacy Best Practices</cite></a>.  W3C. WIP. URL: <a href="https://github.com/w3c/wot-security/blob/master/wot-security-best-practices.md">https://github.com/w3c/wot-security/blob/master/wot-security-best-practices.md</a></dd><dt id="bib-wot-security-guidelines">[WOT-SECURITY-GUIDELINES]</dt><dd><a href="https://w3c.github.io/wot-security/"><cite>Web of Things Security and Privacy Guidelines</cite></a>.  W3C. 28 August 2017. URL: <a href="https://w3c.github.io/wot-security/">https://w3c.github.io/wot-security/</a></dd><dt id="bib-wot-security-testing">[WOT-SECURITY-TESTING]</dt><dd><a href="https://github.com/w3c/wot-security/blob/master/wot-security-testing.md"><cite>Web of Things Security Testing and Validation</cite></a>.  W3C. WIP. URL: <a href="https://github.com/w3c/wot-security/blob/master/wot-security-testing.md">https://github.com/w3c/wot-security/blob/master/wot-security-testing.md</a></dd><dt id="bib-wot-td">[WOT-TD]</dt><dd><a href="https://w3c.github.io/wot-thing-description/"><cite>WoT Thing Description </cite></a>.  W3C. 20 August 2017. URL: <a href="https://w3c.github.io/wot-thing-description/">https://w3c.github.io/wot-thing-description/</a></dd>
      </dl></section></section><p role="navigation" id="back-to-top"><a href="#title"><abbr title="Back to Top">↑</abbr></a></p><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script></body></html>